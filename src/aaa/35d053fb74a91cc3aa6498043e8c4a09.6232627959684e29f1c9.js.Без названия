(self.webpackChunkvk=self.webpackChunkvk||[]).push([[30892],{270448:(e,t,a)=>{"use strict";function n(){return{icon:'<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path d="M7 10.75c0-.41.34-.75.75-.75h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1-.75-.75z"/><path clip-rule="evenodd" d="M14.58 2H5.42c-.53 0-.98 0-1.34.03-.38.03-.74.1-1.08.27-.52.26-.94.68-1.2 1.2-.17.34-.24.7-.27 1.08-.03.36-.03.8-.03 1.34v.42c.02.13.05.3.14.48a1.25 1.25 0 0 0 1.02.67L3 7.5v4.98c0 .81 0 1.47.04 2 .05.55.14 1.03.37 1.47.36.7.93 1.28 1.64 1.64.44.23.92.32 1.47.37.53.04 1.19.04 2 .04h2.96c.81 0 1.47 0 2-.04a3.84 3.84 0 0 0 1.47-.37c.7-.36 1.28-.93 1.64-1.64.23-.44.32-.92.37-1.47.04-.53.04-1.19.04-2V7.5h.34c.13-.02.3-.05.48-.14a1.25 1.25 0 0 0 .67-1.02l.01-.37v-.05c0-.53 0-.98-.03-1.34-.03-.38-.1-.74-.27-1.08A2.75 2.75 0 0 0 17 2.3a2.8 2.8 0 0 0-1.08-.27C15.56 2 15.12 2 14.58 2zm.92 5.5h-11v4.95c0 .85 0 1.45.04 1.9.04.46.1.72.2.92.22.42.57.77.99.98.2.1.46.17.91.21.46.04 1.06.04 1.91.04h2.9c.85 0 1.45 0 1.9-.04.46-.04.72-.1.92-.2.42-.22.77-.57.98-.99.1-.2.17-.46.21-.91.04-.46.04-1.06.04-1.91zM17 6v-.05c0-.57 0-.96-.02-1.25a1.36 1.36 0 0 0-.12-.52 1.25 1.25 0 0 0-.54-.54c-.1-.05-.23-.1-.52-.12-.3-.02-.68-.02-1.25-.02h-9.1c-.57 0-.96 0-1.25.02-.29.03-.43.07-.52.12-.23.12-.42.3-.54.54-.05.1-.1.23-.12.52C3 5 3 5.38 3 5.95V6z" fill-rule="evenodd"/></g></svg>',name:"archive_outline_20"}}a.d(t,{getIcon20ArchiveOutline:()=>n})},18892:(e,t,a)=>{"use strict";function n(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10 18.5a8.5 8.5 0 1 0 0-17 8.5 8.5 0 0 0 0 17Zm4.4-3.05a7 7 0 0 1-9.84-9.84l9.83 9.84Zm1.05-1.06L5.61 4.55a7 7 0 0 1 9.84 9.84Z" fill="currentColor"/></svg>',name:"block_outline_20"}}a.d(t,{getIcon20BlockOutline:()=>n})},839323:(e,t,a)=>{"use strict";function n(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M6.84 4H2.75a.75.75 0 0 0 0 1.5h.55l.9 9.25c.05.52.1.96.16 1.31.06.37.16.71.35 1.03a2.9 2.9 0 0 0 1.25 1.13c.33.16.68.22 1.06.25.36.03.8.03 1.32.03h3.32c.53 0 .96 0 1.32-.03.38-.03.73-.1 1.06-.25a2.9 2.9 0 0 0 1.25-1.13c.19-.32.29-.66.35-1.03.06-.35.1-.79.16-1.31l.9-9.25h.55a.75.75 0 0 0 0-1.5h-4.09a3.25 3.25 0 0 0-6.32 0Zm1.58 0h3.16a1.75 1.75 0 0 0-3.16 0Zm6.78 1.5H4.8l.9 9.07c.05.56.08.94.13 1.23.05.28.1.42.17.52a1.4 1.4 0 0 0 .6.55c.1.04.25.08.53.1.3.03.68.03 1.24.03h3.26c.56 0 .94 0 1.23-.02.29-.03.43-.07.54-.11a1.4 1.4 0 0 0 .6-.55c.06-.1.11-.24.16-.52.05-.3.1-.67.15-1.23l.89-9.07Zm-2.89 2a.75.75 0 0 1 .69.81l-.5 6a.75.75 0 0 1-1.5-.12l.5-6a.75.75 0 0 1 .81-.69Zm-4.62 0a.75.75 0 0 1 .8.69l.5 6a.75.75 0 0 1-1.49.13l-.5-6a.75.75 0 0 1 .69-.82Z" clip-rule="evenodd"/></svg>',name:"delete_outline_20"}}a.d(t,{getIcon20DeleteOutline:()=>n})},779633:(e,t,a)=>{"use strict";function n(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path d="M3.5 10c0-3.21 2.87-6 6.75-6 .42 0 .8-.3.8-.75.01-.44-.38-.75-.8-.75C5.68 2.5 2 5.83 2 10a7 7 0 0 0 1.26 4c-.1.6-.47 1.52-1.12 2.73a1.2 1.2 0 0 0 1.1 1.77c1.9-.06 3.35-.51 4.35-1.4.85.27 1.74.4 2.66.4 4.57 0 8.25-3.33 8.25-7.5 0-.36-.03-.72-.08-1.07a.75.75 0 0 0-1.49.23c.05.28.07.56.07.84 0 3.21-2.87 6-6.75 6a7.58 7.58 0 0 1-2.22-.33l-.4-.12a.75.75 0 0 0-.72.15l-.31.28c-.57.5-1.48.88-2.9 1 .53-1.05.9-1.98 1.04-2.71l.05-.3a.75.75 0 0 0-.12-.57l-.17-.25a5.51 5.51 0 0 1-1-3.15ZM17 5.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0Z"/></svg>',name:"message_unread_top_outline_20"}}a.d(t,{getIcon20MessageUnreadTopOutline:()=>n})},939474:(e,t,a)=>{"use strict";function n(){return{icon:'<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M4.89 3.55c.29-.29.76-.29 1.06 0L16.1 13.72a.75.75 0 0 1-1.06 1.06L13 12.73v2.53c0 .83-.7 1.4-1.46 1.4-.63 0-1.25-.23-1.72-.66L6.3 12.72h-1.5c-.94 0-1.79-.71-1.79-1.7V8.98c0-1 .85-1.71 1.78-1.71h1.5l.66-.6L4.9 4.6a.75.75 0 0 1 0-1.06zM8 7.74l-.92.84a.75.75 0 0 1-.5.2h-1.8c-.1 0-.18.03-.23.08a.17.17 0 0 0-.06.13V11c0 .04.02.09.06.13.05.05.13.08.22.08h1.8c.2 0 .37.07.51.2l3.75 3.48c.17.16.4.26.66.27v-3.94zm3.53-4.4c.75 0 1.46.57 1.46 1.4v1.94a.75.75 0 0 1-1.5 0V4.83c-.26.01-.49.11-.66.27l-.1.1A.75.75 0 0 1 9.7 4.1l.11-.1a2.53 2.53 0 0 1 1.72-.67z" fill="currentColor"/></svg>',name:"mute_outline_20"}}a.d(t,{getIcon20MuteOutline:()=>n})},318516:(e,t,a)=>{"use strict";function n(){return{icon:'<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M5.5 8a4.5 4.5 0 0 1 9 0v1.67c0 .3.1.58.3.8l1.52 1.8a.75.75 0 0 1-.57 1.23H4.25a.75.75 0 0 1-.57-1.24l1.52-1.78c.2-.23.3-.52.3-.81V8zm-1.49-.39A6 6 0 0 1 16 7.75v1.82l1.46 1.72c1.25 1.46.21 3.71-1.7 3.71h-2.08a3.75 3.75 0 0 1-7.35 0H4.25a2.25 2.25 0 0 1-1.71-3.7L4 9.56V7.75l.01-.14zM10 16.5c-.98 0-1.81-.63-2.12-1.5h4.24c-.3.87-1.14 1.5-2.12 1.5z" fill="currentColor" fill-rule="evenodd"/></svg>',name:"notification_outline_20"}}a.d(t,{getIcon20NotificationOutline:()=>n})},545892:(e,t,a)=>{"use strict";function n(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="pin_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="pin_outline_20__Icons-20/pin_outline_20"><g id="pin_outline_20__pin_outline_20"><path d="M0 0h20v20H0z"/><path d="M11.33 2.6a.75.75 0 0 1 1.27-.38l5.18 5.18a.75.75 0 0 1-.38 1.27l-1.54.3a.3.3 0 0 0-.15.09l-2.47 2.46a.3.3 0 0 0-.08.19l-.3 3.86a1.01 1.01 0 0 1-1.72.63L8 13.07l-4.72 4.71a.75.75 0 0 1-1.13-.98l.07-.08L6.93 12 3.8 8.87c-.37-.37-.4-.94-.09-1.34l.09-.1c.17-.17.4-.27.63-.29l3.86-.3a.3.3 0 0 0 .19-.08l2.46-2.46a.3.3 0 0 0 .08-.16Zm1.2 1.67-.03.17a1.8 1.8 0 0 1-.5.92L9.54 7.82c-.3.3-.7.49-1.13.52l-2.8.22 5.83 5.83.22-2.8c.03-.37.17-.73.41-1.01l.11-.12L14.64 8c.26-.25.58-.42.92-.5l.17-.03-3.2-3.2Z" id="pin_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg>',name:"pin_outline_20"}}a.d(t,{getIcon20PinOutline:()=>n})},179799:(e,t,a)=>{"use strict";function n(){return{icon:'<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><g clip-rule="evenodd" fill="currentColor" fill-rule="evenodd"><path d="M17.96 8.15a.75.75 0 0 1-.57.52l-1.56.31a.25.25 0 0 0-.14.08c-.22.24-.45.47-.69.7a.75.75 0 0 1-1.06-1.06l.65-.66c.25-.27.58-.45.94-.53l.2-.04-3.2-3.2-.04.19c-.07.34-.23.65-.48.9l-.7.7A.75.75 0 0 1 10.23 5l.7-.7a.25.25 0 0 0 .08-.13l.3-1.56a.75.75 0 0 1 1.27-.39l5.19 5.18c.2.2.26.49.18.75zM8 13.06l3.14 3.14c.6.61 1.61.23 1.71-.58.09-.84.13-1.68.2-2.51l1.67 1.67a.75.75 0 1 0 1.06-1.06l-9.5-9.5a.75.75 0 1 0-1.06 1.06l1.67 1.67c-.85.07-1.72.08-2.56.2a1.01 1.01 0 0 0-.53 1.72L6.94 12l-4.8 4.8a.75.75 0 0 0 1.14.98zm3.44 1.33.21-2.68-3.37-3.37-2.67.22z"/></g></svg>',name:"pin_slash_outline_20"}}a.d(t,{getIcon20PinSlashOutline:()=>n})},609506:(e,t,a)=>{"use strict";function n(){return{icon:'<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path d="m10.75 11.56.97.97a.75.75 0 1 0 1.06-1.06l-2.25-2.25a.75.75 0 0 0-1.06 0l-2.25 2.25a.75.75 0 1 0 1.06 1.06l.97-.97v2.69a.75.75 0 0 0 1.5 0z"/><path clip-rule="evenodd" d="M14.58 2H5.42c-.53 0-.98 0-1.34.03-.38.03-.74.1-1.08.27-.52.26-.94.68-1.2 1.2-.17.34-.24.7-.27 1.08-.03.36-.03.8-.03 1.34v.42c.02.13.05.3.14.48a1.25 1.25 0 0 0 1.02.67L3 7.5v4.98c0 .81 0 1.47.04 2 .05.55.14 1.03.37 1.47.36.7.93 1.28 1.64 1.64.44.23.92.32 1.47.37.53.04 1.19.04 2 .04h2.96c.81 0 1.47 0 2-.04a3.84 3.84 0 0 0 1.47-.37c.7-.36 1.28-.93 1.64-1.64.23-.44.32-.92.37-1.47.04-.53.04-1.19.04-2V7.5h.34c.13-.02.3-.05.48-.14a1.25 1.25 0 0 0 .67-1.02l.01-.37v-.05c0-.53 0-.98-.03-1.34-.03-.38-.1-.74-.27-1.08A2.75 2.75 0 0 0 17 2.3a2.8 2.8 0 0 0-1.08-.27C15.56 2 15.12 2 14.58 2zm.92 5.5h-11v4.95c0 .85 0 1.45.04 1.9.04.46.1.72.2.92.22.42.57.77.99.98.2.1.46.17.91.21.46.04 1.06.04 1.91.04h2.9c.85 0 1.45 0 1.9-.04.46-.04.72-.1.92-.2.42-.22.77-.57.98-.99.1-.2.17-.46.21-.91.04-.46.04-1.06.04-1.91zM17 6v-.05c0-.57 0-.96-.02-1.25a1.36 1.36 0 0 0-.12-.52 1.25 1.25 0 0 0-.54-.54c-.1-.05-.23-.1-.52-.12-.3-.02-.68-.02-1.25-.02h-9.1c-.57 0-.96 0-1.25.02-.29.03-.43.07-.52.12-.23.12-.42.3-.54.54-.05.1-.1.23-.12.52C3 5 3 5.38 3 5.95V6z" fill-rule="evenodd"/></g></svg>',name:"unarchive_outline_20"}}a.d(t,{getIcon20UnarchiveOutline:()=>n})},656067:(e,t,a)=>{"use strict";function n(){return{icon:'<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M11.54 3.33c.75 0 1.46.58 1.46 1.41v10.52c0 .83-.7 1.4-1.46 1.4-.63 0-1.25-.23-1.72-.66L6.3 12.72h-1.5c-.94 0-1.79-.71-1.79-1.7V8.98c0-1 .85-1.71 1.78-1.71h1.5L9.83 4a2.53 2.53 0 0 1 1.72-.67zm-.04 1.5c-.26.01-.49.11-.66.27L7.1 8.58a.75.75 0 0 1-.5.2h-1.8c-.12 0-.29.07-.29.2v2.03c0 .14.17.21.28.21h1.8c.2 0 .37.07.51.2l3.75 3.48c.17.16.4.26.66.27zm6.12.4A6.76 6.76 0 0 1 19.67 10c0 1.84-.79 3.5-2.05 4.78a.75.75 0 1 1-1.07-1.06A5.26 5.26 0 0 0 18.17 10c0-1.4-.6-2.7-1.62-3.72a.75.75 0 1 1 1.07-1.06zm-2.13 2.54c.52.61.84 1.38.84 2.23 0 .85-.32 1.62-.84 2.23a.75.75 0 0 1-1.15-.96c.32-.38.5-.82.5-1.27 0-.45-.18-.89-.5-1.27a.75.75 0 0 1 1.15-.96z" fill="currentColor"/></svg>',name:"volume_outline_20"}}a.d(t,{getIcon20VolumeOutline:()=>n})},564452:(e,t,a)=>{"use strict";function n(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="work_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="work_outline_20__Icons-20/work_outline_20"><g id="work_outline_20__work_outline_20"><path opacity=".4" d="M0 0h20v20H0z"/><path d="M10.8 2c1.11 0 1.51.12 1.92.33.4.22.73.54.95.95.2.38.31.76.33 1.71v.51h1.36c1.04 0 1.45.12 1.86.33.4.22.73.54.95.95.21.4.33.82.33 1.86v1.8c0 .89-.1 1.21-.27 1.54-.17.31-.41.57-.73.74v1.53a3.25 3.25 0 0 1-3.07 3.24l-.18.01h-8.5a3.25 3.25 0 0 1-3.24-3.07l-.01-.18v-1.53l-.13-.08c-.26-.17-.46-.4-.6-.66-.16-.3-.26-.6-.27-1.35v-2c0-1.03.12-1.44.33-1.85.22-.4.54-.73.95-.95.38-.2.76-.31 1.64-.33H6v-.3c0-1.11.12-1.51.33-1.92.22-.4.54-.73.95-.95.38-.2.76-.31 1.71-.33h1.8ZM16 13H4v1.25c0 .92.7 1.67 1.6 1.74l.15.01h8.5c.92 0 1.67-.7 1.74-1.6l.01-.15V13Zm-.47-6H4.47l-.31.01c-.36.02-.52.06-.67.15a.77.77 0 0 0-.33.33c-.1.2-.15.39-.16.98V10.82c.01.2.03.3.06.38l.03.07c.03.06.08.1.14.14l.07.03c.11.04.28.06.76.06h11.88c.48 0 .65-.02.76-.06l.07-.03c.06-.03.1-.08.14-.14l.03-.07c.04-.11.06-.28.06-.76v-1.8c0-.72-.04-.94-.16-1.15a.77.77 0 0 0-.33-.33c-.2-.1-.39-.15-.98-.16Zm-4.56-3.5H8.72c-.33.02-.5.05-.63.1l-.1.06a.77.77 0 0 0-.33.33l-.05.1c-.07.17-.1.4-.1.94l-.01.47h5v-.78a1.82 1.82 0 0 0-.1-.63l-.06-.1a.77.77 0 0 0-.33-.33l-.1-.05a2.6 2.6 0 0 0-.94-.1Z" id="work_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg>',name:"work_outline_20"}}a.d(t,{getIcon20WorkOutline:()=>n})},668742:(e,t,a)=>{"use strict";function n(){return{icon:'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g id="phone_24__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="phone_24__phone_24"><path id="phone_24__Bounds" d="M0 0h24v24H0z"/><path d="M14.61 14.76a3.64 3.64 0 0 1 4.9-.29l1.03.86a2.8 2.8 0 0 1 .26 3.96 3.32 3.32 0 0 1-2.2 1.14c-3.27.44-6.7-1.14-10.3-4.73-3.6-3.6-5.17-7.04-4.73-10.3a3.25 3.25 0 0 1 1.14-2.2 2.8 2.8 0 0 1 3.95.26l.87 1.03a3.63 3.63 0 0 1-.29 4.9l-.73.73c-.2.2-.26.5-.17.75.27.73.95 1.65 2.05 2.74a8.6 8.6 0 0 0 2.74 2.05c.26.1.55.03.75-.17l.73-.73Z" id="phone_24__2x" fill="currentColor"/></g></g></svg>',name:"phone_24"}}a.d(t,{getIcon24Phone:()=>n})},68421:(e,t,a)=>{"use strict";function n(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M11.18 3.9h1.64c1.1 0 1.8 0 2.35.05.52.04.73.11.84.17a2 2 0 0 1 .87.87c.06.11.13.32.17.84.05.54.05 1.26.05 2.35v7.64c0 1.1 0 1.8-.05 2.35-.04.52-.11.73-.17.84a2 2 0 0 1-.87.87c-.11.06-.32.13-.84.17-.54.05-1.26.05-2.35.05h-1.64c-1.1 0-1.8 0-2.35-.05a2.24 2.24 0 0 1-.84-.17 2 2 0 0 1-.87-.87 2.24 2.24 0 0 1-.17-.84c-.05-.54-.05-1.26-.05-2.35V8.18c0-1.1 0-1.8.05-2.35.04-.52.11-.73.17-.84a2 2 0 0 1 .87-.87c.11-.06.32-.13.84-.17.54-.05 1.26-.05 2.35-.05ZM5.1 8.18c0-2.13 0-3.2.41-4a3.8 3.8 0 0 1 1.66-1.66C8 2.1 9.05 2.1 11.18 2.1h1.64c2.13 0 3.2 0 4 .41a3.8 3.8 0 0 1 1.66 1.66c.42.82.42 1.88.42 4.01v7.64c0 2.13 0 3.2-.41 4a3.8 3.8 0 0 1-1.66 1.66c-.82.42-1.88.42-4.01.42h-1.64c-2.13 0-3.2 0-4-.41a3.8 3.8 0 0 1-1.67-1.66c-.41-.82-.41-1.88-.41-4.01V8.18Zm6.15 8.02a.9.9 0 1 0 0 1.8h1.5a.9.9 0 0 0 0-1.8h-1.5Z" clip-rule="evenodd"/></svg>',name:"smartphone_outline_24"}}a.d(t,{getIcon24SmartphoneOutline:()=>n})},122779:(e,t,a)=>{"use strict";function n(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M14.85 7.95A2.85 2.85 0 0 0 12 5.1a2.85 2.85 0 0 0-2.85 2.85A2.85 2.85 0 0 0 12 10.8a2.85 2.85 0 0 0 2.85-2.85Zm1.8 0A4.65 4.65 0 0 1 12 12.6a4.65 4.65 0 0 1-4.65-4.65A4.65 4.65 0 0 1 12 3.3a4.65 4.65 0 0 1 4.65 4.65ZM5.9 18.43c0 .77-.09.67.34.67h11.52c.43 0 .34.1.34-.67 0-1.9-2.78-3.03-6.1-3.03s-6.1 1.14-6.1 3.03Zm-1.8 0c0-3.33 3.67-4.83 7.9-4.83s7.9 1.5 7.9 4.83c0 1.73-.69 2.47-2.13 2.47H6.23c-1.45 0-2.13-.74-2.13-2.47Z"/></svg>',name:"user_outline_24"}}a.d(t,{getIcon24UserOutline:()=>n})},428549:(e,t,a)=>{"use strict";function n(){return{icon:'<svg width="56" height="56" viewBox="0 0 56 56" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M22.03 10c-8.48 0-14.97 5.92-14.97 12.8 0 2.47.82 4.79 2.25 6.74a1.5 1.5 0 0 1 .3.9c0 1.63-.43 3.22-.96 4.67a41.9 41.9 0 0 1-1.17 2.8c3.31-.33 5.5-1.4 6.8-2.96a1.5 1.5 0 0 1 1.69-.43 17.06 17.06 0 0 0 6.06 1.1C30.5 35.61 37 29.68 37 22.8 37 15.93 30.5 10 22.03 10zM4.06 22.8C4.06 13.9 12.3 7 22.03 7 31.75 7 40 13.88 40 22.8c0 8.93-8.25 15.81-17.97 15.81-2.17 0-4.25-.33-6.17-.95-2.26 2.14-5.55 3.18-9.6 3.34a2.2 2.2 0 0 1-2.07-3.08l.42-.95c.43-.96.86-1.9 1.22-2.9.41-1.11.69-2.18.76-3.18a14.28 14.28 0 0 1-2.53-8.08z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="M43.01 18.77a1.5 1.5 0 0 0 .38 2.09c3.44 2.38 5.55 5.98 5.55 9.95 0 2.47-.81 4.78-2.25 6.73a1.5 1.5 0 0 0-.3.9c0 1.63.43 3.22.96 4.67.35.96.77 1.92 1.17 2.8-3.31-.33-5.5-1.4-6.8-2.96a1.5 1.5 0 0 0-1.69-.43 17.06 17.06 0 0 1-6.06 1.1c-2.98 0-5.75-.76-8.08-2.03a1.5 1.5 0 0 0-1.44 2.63 20.19 20.19 0 0 0 15.7 1.44c2.25 2.14 5.54 3.18 9.59 3.34a2.2 2.2 0 0 0 2.07-3.08l-.42-.95c-.44-.96-.86-1.9-1.22-2.9a11.65 11.65 0 0 1-.76-3.18 14.28 14.28 0 0 0 2.53-8.08c0-5.1-2.72-9.56-6.84-12.42a1.5 1.5 0 0 0-2.09.38z" fill="currentColor"/></svg>',name:"messages_outline_56"}}a.d(t,{getIcon56MessagesOutline:()=>n})},774846:(e,t,a)=>{"use strict";a.d(t,{ONLINE_SEEN_RECENTLY:()=>n,ONLINE_SEEN_LAST_WEEK:()=>r,ONLINE_SEEN_LAST_MONTH:()=>s,ONLINE_SEEN_LONG_AGO:()=>i});var n="recently",r="last_week",s="last_month",i="long_ago"},35916:(e,t,a)=>{"use strict";a.d(t,{WIDGET_ACTIONS:()=>i,initWidgets:()=>_});a(66992),a(454747),a(333948);var n=a(189798),r=a(70162),s=a(69935),i="_im_widget_action",o=".SAKWidget__scrollButton--left",l=".SAKWidget__scrollButton--right";var c=(e,t)=>{switch(e.type){case"open_url":window.open((0,s.wrapAwayIfExternal)(e.url,!0));break;case"open_mini_app":case"open_game":var a=e.app_launch_params.webview_url||e.url;if(!a){var i=[...t.mini_apps,...t.games].find(((t,a)=>t.id===e.app_launch_params.app_id));a=null==i?void 0:i.webview_url}a&&window.open(a);break;case"send_message":o=e.peer_id,l=e.message.text,c=e.message.payload,d=e.message.show_confirmation,(0,n.api)("messages.send",{peer_id:o,random_id:Math.round(2e9*Math.random()),payload:c,message:l}).then((()=>{d&&Notifier.showEvent({text:(0,r.getLang)("mail_send3")})}))}var o,l,c,d},d=(e,t)=>{var a=e.querySelector(o),n=e.querySelector(l),r=t.scrollLeft,s=r>0,i=r<t.scrollWidth-t.clientWidth;a.style.display=s?"":"none",n.style.display=i?"":"none"},u=e=>{if(!e.widgetInitialized){e.widgetInitialized="1";var t=JSON.parse(e.dataset.meta);e.querySelectorAll(".SAKWidget__tappable--vkcom").forEach((e=>{var a=JSON.parse(e.dataset.action);e.onclick=e=>{e.stopPropagation(),c(a,t)}})),e.querySelectorAll(".SAKWidget__scrollBox").forEach((e=>{var t=e.querySelector(".SAKWidget__scrollBoxInner")||e;d(e,t),t.onscroll=()=>d(e,t),e.querySelector(o).onclick=e=>{e.stopPropagation(),t.scroll({left:t.scrollLeft-50,behavior:"smooth"})},e.querySelector(l).onclick=e=>{e.stopPropagation(),t.scroll({left:t.scrollLeft+50,behavior:"smooth"})}}))}},_=e=>{e&&e.querySelectorAll(".SAKWidget__container").forEach(u)}},69935:(e,t,a)=>{"use strict";a.d(t,{wrapAwayIfExternal:()=>s});a(324603),a(339714);var n=a(961540),r=new RegExp(`^(https?:\\/\\/)?([a-z0-9_\\-.]+\\.)?${n.VK_SITE_REGEX_SOURCE_UNSAFE}(\\/.*)?`);function s(e,t){var a=decodeURIComponent(e);return/^\/[^/]/.test(a)||r.test(a)?e:"/away.php?to="+encodeURIComponent(a)+(t?"&utf=1":"")}},777529:(e,t,a)=>{"use strict";a.d(t,{getLastSeenByStatus:()=>s});var n=a(774846),r=a(70162);function s(e,t){var a;switch(e){case n.ONLINE_SEEN_RECENTLY:a=getLang("global_online_was_recently","raw");break;case n.ONLINE_SEEN_LAST_WEEK:a=getLang("global_online_was_week","raw");break;case n.ONLINE_SEEN_LAST_MONTH:a=getLang("global_online_this_month","raw");break;case n.ONLINE_SEEN_LONG_AGO:a=getLang("global_online_long_ago","raw");break;default:return""}return(0,r.langSex)(t,a)}},384032:(e,t,a)=>{"use strict";a.d(t,{CONTROLLER:()=>A.CONTROLLER,loadHashes:()=>k.loadHashes,addNewMember:()=>M.addNewMember,searchHints:()=>N.searchHints,updateBlockStates:()=>P.updateBlockStates,mergeTabs:()=>D.mergeTabs,localIndexToDialog:()=>F.getConvoInfoFromLocalIndex,filterFromTab:()=>F.getFilterFnForConvoListFolder,setActions:()=>D.setActions,ACTIVITY_PERIOD:()=>ee,ACTIVITY_TYPE_TYPING:()=>te,ACTIVITY_TYPE_RECORDING_AUDIO:()=>ae,ACTION_PRIORITIES:()=>oe,strHistory:()=>le,setCallAvailability:()=>ce,removeFailed:()=>de,removeExpiredFailed:()=>ue,syncMessagesEditableStatus:()=>_e,selectPeer:()=>me,selectPeerOnMessage:()=>he,changePeer:()=>fe,updateMentions:()=>be,loadMoreHistory:()=>Ce,loadLessHistory:()=>Te,readTillSpecificMessage:()=>Ie,loadLongPollKey:()=>Le,loadLongPollTs:()=>ye,setMessageErrored:()=>Ae,resendMessage:()=>Se,addDialog:()=>Re,updateVideoThumb:()=>we,editMessage:()=>Ne,addMessage:()=>Oe,markInboundMessagesAsRead:()=>xe,markOutboundMessagesAsRead:()=>De,initTextStore:()=>Fe,processFwd:()=>He,updateOnline:()=>Ue,setActivity:()=>Be,updateActivity:()=>je,waitActivity:()=>Ge,sendMessage:()=>Ve,deliverMessage:()=>Ye,deliverEditedMessage:()=>Ke,addSelection:()=>ze,cleanSelected:()=>$e,replaceMessage:()=>We,loadMedia:()=>Qe,addCarouselTemplateToStore:()=>Ze,addAttachmentsToStoreData:()=>Je,addMessageReactionsToHistory:()=>Xe,setCurrentSearchDate:()=>et,setInplaceSearch:()=>tt,setCurrentSearch:()=>at,searchHintsIndex:()=>nt,searchTopConv:()=>st,searchImTopConv:()=>it,searchLocalHints:()=>ot,preloadSearchIndex:()=>lt,loadDialogs:()=>ct,searchMessages:()=>dt,isSearchAllLoaded:()=>ut,isSearchingInplace:()=>_t,cancelSearch:()=>gt,clearDate:()=>mt,searchMessagesInplace:()=>ht,loadImportant:()=>ft,loadActualLastMessage:()=>vt,removeMessagesMarkDeleted:()=>bt,removeMessages:()=>Ct,removeMessageSend:()=>Tt,removeMessagesWithRestore:()=>Et,restoreMessage:()=>It,restoreMessageSend:()=>Lt,acceptMessageRequest:()=>At,rejectMessageRequest:()=>St,sendTyping:()=>kt,sendRecordingAudio:()=>Mt,forwardMessages:()=>Rt,prepareForward:()=>wt,deletedDialog:()=>Nt,flushHistory:()=>Ot,updateChatTopic:()=>Pt,loadChatInfo:()=>xt,loadChatMember:()=>Dt,checkNewPeople:()=>Ft,loadNewPeople:()=>Ht,updateChatPhoto:()=>Ut,leaveChat:()=>jt,returnToChat:()=>Gt,toggleMutePeer:()=>qt,toggleMuteMentionsPeer:()=>Vt,setMutedPeer:()=>Yt,setExecStack:()=>Kt,favMessage:()=>zt,updateFavMessage:()=>$t,updateImportant:()=>Wt,loadSpam:()=>Qt,flushSpam:()=>Zt,setCreationType:()=>Jt,getOwnerPhoto:()=>Xt,getContactsList:()=>ea,presetAvatar:()=>ta,resync:()=>aa,toggleSendingAbility:()=>na,setDelayedMessage:()=>ra,isAnythingLoading:()=>sa,updateFavAndTitle:()=>ia,saveHistoryScroll:()=>oa,changeDialogsTab:()=>la,shouldIncludeDialog:()=>ca,updateFolderState:()=>da,toggleDialogImportant:()=>ua,markDialogAnswered:()=>_a,markDialogUnread:()=>ga,markDialogRead:()=>ma,getMutexQueue:()=>pa,releaseBlock:()=>ha,toggleCommunityMute:()=>fa,deleteDialog:()=>va,restoreDialog:()=>ba,spamDialog:()=>Ca,updateTabbedPeers:()=>Ta,isEverythingLoaded:()=>Ea,cleanTab:()=>Ia,stringifyTab:()=>La,updateGoToEndVisibility:()=>ya,updateGoToMentionVisibility:()=>Aa,updateGoToReactionAvailability:()=>Sa,toggleCommunityMessages:()=>ka,syncHistory:()=>Ma,cancelRecording:()=>Ra,setVoiceMessageAvail:()=>wa,toggleConversation:()=>Na,updateSearchQuery:()=>Oa,initializeChatResize:()=>Pa,joinChat:()=>xa,getInviteLink:()=>Da,resetInviteLink:()=>Fa,leaveInvitation:()=>Ha,saveRecentSearchPeer:()=>Ua,resetRecentSearch:()=>Ba,removeFromRecentSearch:()=>ja,pinMessageOptimistic:()=>Ga,unpinMessageOptimistic:()=>qa,pinMessage:()=>Va,unpinMessage:()=>Ya,getPinnedMessage:()=>Ka,getMessageLocalId:()=>za,getChatDetails:()=>$a,updateFlags:()=>Wa,removeChatPhoto:()=>Qa,toggleAdminOptimisticly:()=>Za,toggleAdmin:()=>Ja,checkChatMember:()=>Xa,hidePromoTooltip:()=>en,hideTopBannerAction:()=>tn,callbackTopBannerAction:()=>an,loadBanner:()=>nn,setKeyboard:()=>rn,deleteKeyboard:()=>sn,toggleKeyboard:()=>on,loadKeyboard:()=>ln,changeCommunityAccess:()=>cn,deleteTemplate:()=>dn,createTemplate:()=>un,updateTemplate:()=>_n,resetTabAll:()=>gn,updateMessageRequestsCounter:()=>mn,updateCasperMessageExpiringStatus:()=>pn,prepareCasperMessagesFromMessages:()=>hn,peerProfileToggleTag:()=>fn,peerProfileManageTags:()=>vn,peerProfileSaveNote:()=>bn,reloadMessage:()=>Cn,getPeerActiveCallData:()=>Tn,removePeerActiveCallData:()=>En,updatePeerTagsFilter:()=>In,updatePeerTags:()=>Ln,updatePeerTagsFilterFolder:()=>yn,updatePeerProfileTags:()=>An});a(892222),a(57327),a(226699),a(682772),a(66992),a(821249),a(747042),a(702707),a(140561),a(556977),a(319601),a(241539),a(426833),a(788674),a(292087),a(339714),a(132023),a(864765),a(454747),a(333948);var n=a(887294),r=a(372650),s=a(70162),i=a(733164),o=a(342269),l=a(283303),c=a(663825),d=a(511492),u=a(826338),_=a(67328),g=a(879346),m=a(661711),p=a(891326),h=a(722199),f=a(284863),v=a(43229),b=a(238283),C=a(145072),T=a(376473),E=a(516703),I=a(873589),L=a(712439),y=a(592380),A=a(179288),S=a(653736),k=a(121074),M=a(179203),R=a(645523),w=a(375053),N=a(917791),O=a(459554),P=a(475234),x=a(306151),D=a(407381),F=a(923876),H=a(826542),U=a(315720),B=a(993421),j=a(352111),G=a(283536),q=a(588870),V=a(827749),Y=a(506770),K=a(419672),z=a(578843),$=a(820696),W=a(49241),Q=a(844142);function Z(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return J(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return J(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function X(){return X=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},X.apply(this,arguments)}var ee=5,te="typing",ae="audiomessage",ne=(0,l.updateLazyLocation)(),re=ne.scheduleNav,se=ne.commitNav,ie=ne.scheduleNavWithTimeOut,oe={[A.ConvoAction.SEARCH]:0,[A.ConvoAction.MEDIA]:1,[A.ConvoAction.CHAT_INVITE]:2,[A.ConvoAction.USER_INVITE]:2,[A.ConvoAction.CREATE_CHAT]:2,[A.ConvoAction.ADD_FRIEND]:3,[A.ConvoAction.SETTINGS]:3,[A.ConvoAction.PIN_HIDE]:10,[A.ConvoAction.PIN_UNHIDE]:10,[A.ConvoAction.UNPIN]:11,[A.ConvoAction.UNREAD]:20,[A.ConvoAction.MUTE]:21,[A.ConvoAction.UNMUTE]:21,[A.ConvoAction.PIN_CONVO]:22,[A.ConvoAction.UNPIN_CONVO]:22,[A.ConvoAction.ARCHIVE]:30,[A.ConvoAction.UNARCHIVE]:30,[A.ConvoAction.CLEAR]:31,[A.ConvoAction.CALL_FINISH]:31,[A.ConvoAction.ENABLE_BUSINESS_NOTIFY]:32,[A.ConvoAction.DISABLE_BUSINESS_NOTIFY]:32,[A.ConvoAction.BLOCK]:32,[A.ConvoAction.BLOCK_COMMUNITY]:33,[A.ConvoAction.ALLOW_COMMUNITY]:33,[A.ConvoAction.BLOCK_NOTIFY]:34,[A.ConvoAction.LEAVE]:35,[A.ConvoAction.RETURN]:35};function le(e){return"string"==typeof e?e:e.innerHTML}function ce(e,t){return t.tabs[e].can_start_call=(0,C.canStartGroupCall)(t,e),Promise.resolve(t)}function de(e,t,a,n,r){var s=r.imQueue(a),i=[],o=[];s.forEach((e=>{e.failed&&n&&e.mess.messageId!==n&&o.push(e),!e.failed||n&&e.mess.messageId!==n||i.push("rid"+e.rid)})),r.imQueueSet(a,o);var l=(0,f.getTab)(r,a);if(!l)return Promise.resolve(r);var c=o.length?o[o.length-1].mess:(0,f.getLastMessage)(e,a,i[0]);return l.lastmsg=c&&c.messageId,l.lastmsg_meta=c,i.forEach((e=>delete l.msgs[e])),l.history=(0,m.removeMessages)(i,(0,K.unpackHistory)(l.history)),(0,m.removeMessages)(i,t),Promise.resolve(r)}function ue(e,t,a){var n=864e5,r=a.imQueue(t),s=[],i=[],o=Date.now();return r.forEach((e=>{e.failed&&o-e.ts<n&&i.push(e),e.failed&&o-e.ts>=n&&s.push("rid"+e.rid)})),a.imQueueSet(t,i),a.tabs[t].history=(0,m.removeMessages)(s,(0,K.unpackHistory)(a.tabs[t].history)),(0,m.removeMessages)(s,e),Promise.resolve(a)}function _e(e,t){if((0,Y.partConfigEnabled)("im_message_editable_sync")){var a=(0,f.getTab)(e,t);if(!a)return Promise.resolve(e);for(var n=(0,K.unpackHistory)(a.history),r=Object.values(a.msgs),s=r.length-1;s>=0;s-=1){var i=(0,f.parserMessage)(r[s]);if((0,W.isOutOfMessageEditingTime)(e,i.date))break;var o=n.querySelector(`._im_mess_${i.messageId}`);o&&(0,m.updateMessageEditableStatus)(e,t,n,o)}return Promise.resolve(e)}}function ge(e,t){return!1===(t.block_states[e]||{}).free?Promise.resolve(t):(0,n.post)(A.CONTROLLER,{act:"a_block",peer:e,prevPeer:t.prevPeer,gid:t.gid}).then((e=>{var a=e[0];return(0,P.updateBlockStates)(a,t)}))}function me(e,t){var a=t.peer;return Promise.resolve(t).then((t=>(t.tabHistoryNotChanged=!1,(0,m.isFullyLoadedTab)(t,a)&&!t.tabs[a].msgid?(t.gid&&ge(a,t),Promise.resolve(t).then(D.setActions)):((0,m.isFullyLoadedTab)(t,a)&&(t.tabs[a].msgid=!1),(0,N.loadPeer)(t,a,0,e,!0,"selectPeer"))))).then(D.setActions).then(pe.bind(null,a))}function pe(e,t,a){return void 0===a&&(a=!1),(0,m.isTabLoaded)(t,e)&&(t.tabs[e].last_touched=Date.now()),(0,m.isTabLoaded)(t,e)&&a&&(t.tabs[e].last_visited=Date.now()),t}function he(e,t,a){var n=a.msgid,r=a.peer;return!e&&(0,m.isFullyLoadedTab)(a,r)&&a.tabs[r].msgs[n]?(t===a.peer?a.tabHistoryNotChanged=!0:a.tabHistoryNotChanged=!1,a.gid&&ge(r,a),Promise.resolve(a).then(D.setActions).then(pe.bind(null,r))):(0,N.loadPeer)(a,r,n,!0,!0,"selectOnMessage").then(D.setActions).then((()=>((0,f.getTab)(a,r).msgid=n,a))).then(pe.bind(null,r))}function fe(e,t,a,n){if(sa(n))throw(0,m.showWaitUntilUploadedBox)(),new Error("Cant change peer while loading something");var r=n.gid?"gim"+n.gid:"im";if(n.prevPeer=n.peer,n.peer=e,n.msgid=t||"",n.currentEntryPoint=a,cur.peer=e,re({sel:e?(0,m.convertPeerToUrl)(e):null,msgid:n.msgid,email:"",0:r}),0!==n.prevPeer&&pe(n.prevPeer,n,!0),0!==e){(0,m.isTabLoaded)(n,e)&&pe(e,n,!0),Ta(n.tabbedPeers.map((e=>e.peer)).indexOf(e)<0?[{peer:e,type:"perm"}].concat(n.tabbedPeers):n.tabbedPeers.map((t=>(t.peer===e&&"perm"!==t.type&&(t.type="perm"),t))),!1,n);var s=(0,f.getTab)(n,e);s&&(0,O.tabIsMessageRequest)(s)&&(0,V.collectOpenMessageRequestStats)(e)}else Ta(n.tabbedPeers,!1,n);return se(),(0,G.updateCounters)(location.href,document.referrer),gt(n.prevPeer,n)}var ve=(0,S.wrapHashAction)((function(e,t){var a=t.tabs[e];return a.membersLoaded?Promise.resolve(t):(0,n.post)(A.CONTROLLER,{act:"a_get_chat_members",chat:e,gid:t.gid,hash:a.hash}).then((e=>{var n=e[0],r=n[0],s=n[1],i=n[2];return a.memberIds=r,a.adminIds=s,i.forEach((e=>(0,b.oCacheAdd)(t,e))),a.membersLoaded=!0,t}))}));function be(e){var t=e.isMassMentionsMessageAllowed;cur.wallMentions=()=>new Promise(((a,n)=>{if(cur.wallMentions=[],!Q.Ranges.isChatOrChannelPeer(e.peer)||!(0,m.isFullyLoadedTab)(e,e.peer)||(0,m.isFvkcomgroup)(e,e.peer))return n();var r=e.tabs[e.peer];function i(){var n=[];Object.keys(r.msgs||{}).reverse().forEach((e=>{var t=(0,f.parserMessage)(r.msgs[e]),a=t&&t.userId;a&&a!=vk.id&&-1===n.indexOf(a)&&(0,m.isUserAliveInChat)(r,a)&&n.push(a)})),(r.memberIds||[]).forEach((e=>{-1===n.indexOf(e)&&n.push(e)}));var i=[];n.forEach((t=>{if((0,b.oCacheExists)(e,t)){var a=(0,b.oCacheGet)(e,t),n=a.link.substring(1);i.push([a.id,a.name,"@"+n,a.photo,void 0,void 0,void 0,n,a.first_name,"",a.note])}}));var o=(0,s.getLang)("mail_im_mention_all"),l=(0,s.getLang)("mail_im_mention_online");t&&(0,C.canMassMention)(e)&&i&&i.length>1&&(h.MASS_MENTION_ALIASES.online.forEach((e=>i.push(["online",l,"@"+e,"/images/mention_online.svg",void 0,void 0,void 0,e,e,""]))),h.MASS_MENTION_ALIASES.all.forEach((e=>i.push(["all",o,"@"+e,"/images/mention_all.svg",void 0,void 0,void 0,e,e,""])))),a(i)}r.membersLoaded?i():ve(e.peer,e).then(i)}))}function Ce(e,t,a){var r=a.tabs[a.peer];return(0,n.post)(A.CONTROLLER,{peer:a.peer,whole:e,act:"a_history",offset:r.offset+(r.skipped||0),toend:t,gid:a.gid}).then((e=>{var t=e[0],n=e[1],s=e[2],i=e[3];return r.allShown=s,a.admins=(0,o.extend)(a.admins,i),r.history=t+le(r.history),r.historyToAppend=t,r.offset+=Object.keys(n).length,r.msgs=(0,o.extend)(r.msgs,n),a}))}function Te(e){var t=e.tabs[e.peer];return(0,n.post)(A.CONTROLLER,{peer:e.peer,act:"a_history",rev:1,offset:t.skipped,gid:e.gid}).then((a=>{var n=a[0],r=a[1],s=a[2];a[3],a[4];t.allShown=t.allShown||s,t.history=le(t.history)+n,t.historyToAppend=n;var i=Object.keys(r).length;return t.skipped-=i,t.offset+=i,t.msgs=(0,o.extend)(t.msgs,r),e}))}function Ee(e,t,a,n,r){var s=e.tabs[t];if((0,Y.partConfigEnabled)("me_web_read_by_cmid")){if(r===c.FLAG_OUTBOUND&&s.out_up_to_cmid>n)return e;r===c.FLAG_OUTBOUND?s.out_up_to_cmid=n:s.in_up_to_cmid=n}else{if(r===c.FLAG_OUTBOUND&&s.out_up_to>a)return e;r===c.FLAG_OUTBOUND?s.out_up_to=a:s.in_up_to=a}return e}var Ie=(0,S.wrapHashAction)((function(e,t,a){var r=a.tabs[t];if(!(0,Y.partConfigEnabled)("simplified_start_conversation")&&(0,O.tabIsMessageRequest)(r)||(0,m.tabIsOutgoingMessageRequest)(r))return Promise.resolve(a);var s=(0,f.getMessage)(a,t,e);if(!(0,v.isUnread)(r,s))return Promise.resolve(a);var i={};return(0,Y.partConfigEnabled)("me_web_read_by_cmid")?(a.longpoll.push([c.readInboundByCmidEvent([10006,t,s.chat_local_id,null])]),i.start_cmid=s.chat_local_id):(a.longpoll.push([c.readInboundEvent([6,t,s.messageId,null])]),i.ids=[s.messageId]),(0,n.post)(A.CONTROLLER,X({peer:t,hash:r.hash,act:"a_mark_read",gid:a.gid},i)).then((()=>Ee(a,t,e,s.chat_local_id,c.FLAG_OUTBOUND)))}));function Le(e){return(0,n.post)(A.CONTROLLER,{act:"a_get_key",uid:e.id,gid:e.gid}).then((t=>{var a=t[0],n=t[1],r=t[2];return(0,o.extend)({},e,{imKey:a,imUrl:n,imPart:r})}))}function ye(e){return(0,n.post)(A.CONTROLLER,{act:"a_get_ts",gid:e.gid}).then((t=>{var a=t[0];return(0,o.extend)({},e,{imTs:a})}))}function Ae(e,t,a){var n=a.tabs[e];return n.msgs[t.messageId]&&(n.msgs[t.messageId].errored=1,n.history=(0,m.setMessageError)(e,t,(0,K.unpackHistory)(n.history))),Promise.resolve(a)}function Se(e,t,a,n){var r=n.tabs[e];return r.msgs[t]&&(r.msgs[t].errored=0,r.lastmsg_meta=a,r.lastmsg=t,r.history=(0,m.startResendMessage)(e,t,(0,K.unpackHistory)(r.history))),Promise.resolve(n)}function ke(e,t){return 0===e.length?Promise.resolve(t):(0,n.post)(A.CONTROLLER,{act:"a_get_admin",admins:e.join(","),gid:t.gid}).then((e=>{var a=e[0];return t.admins=(0,o.extend)(t.admins,a),t}))}function Me(e,t){if(!(0,o.inArray)(e,t.tabbedPeers.map((e=>e.peer)))&&(0!==t.peer||t.searchText)&&!(0,o.inArray)(e,t.mutedPeers)){var a={peer:e,type:"temp"};Ta(t.tabbedPeers.concat([a]),!1,t)}}function Re(e,t,a){return(0,O.isBusinessNotifyPeer)(a,e)?t:(0,m.isReversedDialogs)(a)?t.concat([e]):[e].concat(t)}function we(e,t){var a=e.get().peer,n=(0,f.getTab)(e,a);if((0,m.isFullyLoadedTab)(e,a)){var r=(0,K.unpackHistory)(n.history);n.history=(0,m.updateMessageInCache)(e,r,t)}}function Ne(e,t){var a=e.peerId;if((0,m.isTabLoaded)(t,a)){var n=t.tabs[a];if((0,m.isFullyLoadedTab)(t,a)){var r=(0,K.unpackHistory)(n.history);n.msgs[e.messageId]=(0,o.extend)(!0,{},e),n.history=(0,m.editAndReplaceMessage)(t,e,r)}n.lastmsg===e.messageId&&(n.lastmsg_meta=e);var s=n.pinned&&(0,f.parserMessage)(n.pinned);if(s&&s.messageId===e.messageId&&(n.pinned=e),!(0,v.isOut)(e)&&(0,v.isUnread)(n,e)){var i=(0,w.hasUserMentions)(e,t.id),l=(0,Y.partConfigEnabled)("me_web_read_by_cmid")?n.mention_cmids&&n.mention_cmids.includes(e.chat_local_id):n.mentions&&n.mentions.includes(e.messageId);i&&!l?(0,Y.partConfigEnabled)("me_web_read_by_cmid")?(n.mention_cmids||(n.mention_cmids=[]),n.mention_cmids.push(e.chat_local_id)):(n.mentions||(n.mentions=[]),n.mentions.push(e.messageId)):!i&&l&&((0,Y.partConfigEnabled)("me_web_read_by_cmid")?(0,D.setFilteredMentionsData)(a,(t=>t!==e.chat_local_id),t):(0,D.setFilteredMentionsData)(a,(t=>t!==e.messageId),t))}return Promise.resolve(t)}return(0,N.loadPeer)(t,a,0,!1,!1,"editMessage").then((t=>{var n=t.tabs[a];return(0,D.updateListedConvos)(t,n,!1,(e=>Re(a,e,t)),((e,a,n)=>ca(t,e,a,n))),pe(e.peerId,t),t}))}function Oe(e,t){var a=e.flags&c.FLAG_OUTBOUND,n=e.peerId,r=X({},e);if(delete r.minorSortId,(0,m.isTabLoaded)(t,n)){var s=t.tabs[n];if("number"==typeof e.messageId&&s.lastmsg>e.messageId)return Promise.resolve(t);s.deletedDialog=!1,e.local&&(0,O.isChatConvo)(s)&&(s.data.closed=0),e.local&&(t.msg_local_ids_sort=t.msg_local_ids_sort||{lastSortId:0},t.msg_local_ids_sort[e.messageId]=++t.msg_local_ids_sort.lastSortId);var i=(0,Y.partConfigEnabled)("simplified_start_conversation")?!(0,O.tabIsNotImportantMessageRequest)(s):!(0,O.tabIsMessageRequest)(s);if(!a&&i)((0,Y.partConfigEnabled)("me_web_read_by_cmid")?e.chat_local_id>s.in_up_to_cmid:e.messageId>s.in_up_to)&&(s.lastmsg===e.messageId&&s.unread?Pe(t,1,e.peerId):(!s.unread&&Pe(t,1,e.peerId),s.unread++)),y.casperMessagesStore.has(e.chat_local_id)&&!(0,f.isCasperChatTab)(s)&&((0,Y.partConfigEnabled)("me_web_read_by_cmid")?(s.expiring_cmids||(s.expiring_cmids=[]),s.expiring_cmids.push(e.chat_local_id)):(s.expiring_messages||(s.expiring_messages=[]),s.expiring_messages.push(e.messageId))),(0,w.hasUserMentions)(e,t.id)&&((0,Y.partConfigEnabled)("me_web_read_by_cmid")?(s.mention_cmids||(s.mention_cmids=[]),s.mention_cmids.push(e.chat_local_id)):(s.mentions||(s.mentions=[]),s.mentions.push(e.messageId))),Me(e.peerId,t);else s.unread=0;if((0,m.isFullyLoadedTab)(t,n)){var o=(0,v.isMessageToBlockedCommunity)(s,e),l=o||0===s.offset;o&&(s.blocked_community=0),s.skipped>0&&s.skipped++,s.offset++,s.msgs[e.messageId]=r;var d=(0,K.unpackHistory)(s.history);s.history=(0,K.appendMessageToHistory)(t,e,d,!0,!0),l&&(0,D.setActions)(t)}if(s.typing){var u=s.typing.userIds.indexOf(e.userId);u>=0&&s.typing.userIds.splice(u,1)}return s.lastmsg=e.messageId,s.lastmsg_meta=r,s.minor_sort_id=e.minorSortId,pe(e.peerId,t),(0,D.updateListedConvos)(t,s,!1,(e=>Re(n,e,t)),((e,a,n)=>ca(t,e,a,n))),Promise.resolve(t)}return e.flags&c.FLAG_STEALTH?Promise.resolve(t):(0,N.loadPeer)(t,n,0,!1,!1,"addMessage").then((t=>{var r=t.tabs[n];return(0,D.updateListedConvos)(t,r,!1,(e=>Re(n,e,t)),((e,a,n)=>ca(t,e,a,n))),pe(e.peerId,t),a||Me(e.peerId,t),t}))}function Pe(e,t,a){e.cur_unread_cnt||(e.cur_unread_cnt={}),-1===t&&delete e.cur_unread_cnt[a],(0,P.addToUnreadCounter)(t,a,e).then(j.updateUnreadCounter)}function xe(e,t){var a=(0,f.getTab)(t,e.peerId);if((0,m.isFullyLoadedTab)(t,e.peerId)){var n=a.unread;if(t=Ee(t,e.peerId,e.upToId,e.upToCmid,0),null!==e.unread?a.unread=e.unread:a.unread=(0,f.countUnread)(e.peerId,t)+(a.unread>0?+a.skipped:0),n>0&&!a.unread&&Pe(t,-1,e.peerId),!a.skipped){var r=(0,K.unpackHistory)(a.history);a.history=(0,K.removeNewUnreadBarAndMerge)(t,r,e.peerId)}}else(0,m.isTabLoaded)(t,e.peerId)&&(t.tabs[e.peerId].unread>0&&0===e.unread&&Pe(t,-1,e.peerId),t.tabs[e.peerId].unread=e.unread||0,(0,Y.partConfigEnabled)("me_web_read_by_cmid")?t.tabs[e.peerId].in_up_to_cmid=e.upToCmid:t.tabs[e.peerId].in_up_to=e.upToId);return(0,m.isTabLoaded)(t,e.peerId)&&0===a.unread&&(t.dialog_tabs[p.FOLDER_UNREAD]=t.dialog_tabs[p.FOLDER_UNREAD].filter((t=>(0,o.intval)(t)!==e.peerId))),(0,m.isTabLoaded)(t,e.peerId)&&((0,Y.partConfigEnabled)("me_web_read_by_cmid")?((0,D.setFilteredExpiringMessagesData)(e.peerId,(t=>t>e.upToCmid),t),(0,D.setFilteredMentionsData)(e.peerId,(t=>t>e.upToCmid),t)):((0,D.setFilteredExpiringMessagesData)(e.peerId,(t=>t>e.upToId),t),(0,D.setFilteredMentionsData)(e.peerId,(t=>t>e.upToId),t))),0!==(0,B.getUnreadCountWithMuted)(t)||t.active_tab!==p.FOLDER_UNREAD||t.gid?Promise.resolve(t):la(p.FOLDER_ALL,t)}function De(e,t){var a=t.tabs[e.peerId];if((0,m.isTabLoaded)(t,e.peerId)&&Ee(t,e.peerId,e.upToId,e.upToCmid,c.FLAG_OUTBOUND),(0,m.isFullyLoadedTab)(t,e.peerId)){var n=(0,K.unpackHistory)(a.history);a.history=(0,m.markMessagesAsRead)(t,e.peerId,n)}return Promise.resolve(t)}function Fe(e,t,a,n,r){return r.text={},r.imQueue=e,r.imQueueResend=t,r.imQueueSet=a,r.imQueueComplete=n,Promise.resolve(r)}function He(e,t,a){function n(e,t){return{id:e.messageId,text:e.text,date:e.date,kludges:e.kludges,authorName:t}}if(1===e.length){var r=e[0],s=(0,f.getMessage)(a,t,r),i=(0,f.getAuthorFullName)(a,t,r);return!1===i?a.set(Dt.bind(null,{[t]:[s.userId]})).then((a=>{var i=(0,f.getAuthorFullName)(a,t,r);return{msgIds:e,object:n(s,i)}})):Promise.resolve({msgIds:e,object:n(s,i)})}return Promise.resolve({msgIds:e})}function Ue(e,t,a,n){var r=(0,f.getTab)(n,e);if(r&&r.last_seen&&r.last_seen.can_see){var s=!1!==t?mobPlatforms[t]?1:0:r.last_seen.mobile;r.online=t,r.last_seen={platform:t,time:a||r.last_seen.time,mobile:s,can_see:r.last_seen.can_see}}var i=(0,m.convertLegacyOnlineToAPIFlags)(t),o=i.is_online,l=i.is_mobile;return(0,D.updateRecommendedListItemOnline)(n,e,o,l)}function Be(e,t,a){var n=(0,f.getTab)(a,e.peerId);return n&&(e.ts=Date.now()/1e3,n.activity||(n.activity={}),n.activity[t]=e,n.typing===te&&(n.typing=e)),Promise.resolve(a)}function je(e,t){var a=(0,f.getTab)(t,e.peerId),n=(0,v.isAudioMsg)(e)?"audiomessage":"typing";return a&&a.activity&&a.activity[n]&&(a.activity[n].userIds=a.activity[n].userIds.filter((t=>t!==e.userId))),Promise.resolve(t)}function Ge(e,t,a){var n=e.peerId;return(0,d.pause)(ee+2).then((()=>{if((0,m.isTabLoaded)(a,n)){var e=a.tabs[n];if((e.activity||{})[t])Date.now()-1e3*e.activity[t].ts>=1e3*ee&&(delete e.activity[t],0===Object.keys(e.activity).length&&delete e.activity);if(e.typing)Date.now()-1e3*e.typing.ts>=1e3*ee&&(e.typing=void 0)}return a}))}function qe(e){var t={},a=e.find((e=>"poll"===e[0]));if(a){var n=a[2];Object.assign(t,n)}return t}var Ve=function(e,t,a,r){var s=Date.now()+(0,i.rand)(0,100).toFixed(0),o=r.ref_id,l=r.ref_source;r.ref_source=void 0,r.ref_id=void 0,(l||o)&&(re({ref_source:null,ref:null}),se()),(0,E.statlogsSendingQueueLength)(r);var c="send",d=t.attaches.length>0,_=(0,E.statlogsSendingTime)(r,c,"server",d),g=Object.assign({act:"a_send",to:e,hash:a.hash,ref_source:l,ref:o,msg:t.message,payload:t.payload,media:(0,u.convertAttachesToPhpMedia)(t.attaches),guid:s,share_url:t.share_url,cancelled_shares:t.cancelled_shares,random_id:t.rid,gid:a.hidegid?void 0:r.gid,entrypoint:r.currentEntryPoint||"",sticker_referrer:t.sticker_referrer,module:cur.module},a.external,qe(t.attaches));return(0,Y.partConfigEnabled)("im_chasiky_debug")&&window.meBufferLog[t.rid].push("sending message",g),(0,n.post)(A.CONTROLLER,g,2e4).then((e=>{var a=e[0];return(0,Y.partConfigEnabled)("im_chasiky_debug")&&window.meBufferLog[t.rid]&&window.meBufferLog[t.rid].push("message sent",a),_(),r.version!==a.version&&nav.reload({force:!0}),r})).catch((e=>{throw(0,Y.partConfigEnabled)("im_chasiky_debug")&&window.meBufferLog[t.rid]&&window.meBufferLog[t.rid].push("sending failed",e),(0,E.statlogsSendingError)(r,e,c,"server_send"),e}))},Ye=(0,S.wrapHashAction)((function(e,t,a,n){void 0===a&&(a={});var r=n.tabs[e];return Ve(e,t,X({hash:r.hash},a),n)})),Ke=(0,S.wrapHashAction)((function(e,t,a){var r="edit",s=t.attaches.length>0,i=(0,E.statlogsSendingTime)(a,r,"server",s);return(0,n.post)(A.CONTROLLER,Object.assign({act:"a_edit_message",module:cur.module,hash:e.hash,id:t.messageId,peerId:e.peerId,gid:a.gid,msg:t.origText,media:(0,u.convertAttachesToPhpMedia)(t.attaches),share_url:t.share_url,cancelled_shares:t.cancelled_shares},qe(t.attaches)),2e4).then((e=>{e[0];return i(),a})).catch((e=>{throw(0,E.statlogsSendingError)(a,e,r,"server_send"),e}))}));function ze(e,t){if(t.selectedMessages||(t.selectedMessages=[]),1===e.length&&(0,o.inArray)(e[0],t.selectedMessages))t.selectedMessages=t.selectedMessages.filter((t=>t!==e[0]));else{var a=t.selectedMessages.concat(e);t.selectedMessages=(0,_.arrayUnique)(a).sort(((e,t)=>e-t))}return Promise.resolve(t)}function $e(e){return e.selectedMessages=[],Promise.resolve(e)}function We(e,t){if((0,Y.partConfigEnabled)("im_chasiky_debug")&&delete window.meBufferLog[e.randomId],(0,m.isFullyLoadedTab)(t,e.peerId)){var a=t.tabs[e.peerId],n=X({},e);delete n.minorSortId;var r=t.imQueue(e.peerId).filter((t=>t.failed&&t.rid!==e.randomId));t.imQueueSet(e.peerId,r),t.imQueueComplete(e.peerId,e.randomId),a.lastmsg_meta=n,a.lastmsg=e.messageId,a.minor_sort_id=e.minorSortId,a.msgs["rid"+e.randomId]&&(a.msgs[e.messageId]=n,delete a.msgs["rid"+e.randomId]),t.msg_local_ids_sort&&delete t.msg_local_ids_sort["rid"+e.randomId],a.history=(0,m.replaceMessageAttrs)(t,(0,K.unpackHistory)(a.history),n)}else console.error(new Error(`Tab ${e.peerId} not loaded on local message replace`));return Promise.resolve(t)}function Qe(e,t){var a="unknown",r=(0,E.statlogsSendingTime)(t,a,"attach"),s={act:"a_get_media",id:e.messageId,gid:t.gid};return(0,d.retryFn)(n.post,3,(e=>e*e))(A.CONTROLLER,s).then((a=>(r(),Je(e,a,t)))).catch((n=>((0,E.statlogsSendingError)(t,n,a,"server_load_attach"),Je(e,null,t))))}function Ze(e,t){return(0,q.getFullMessage)(e.peerId,e.chat_local_id).then((a=>{var n=t.tabs[e.peerId],r=a.items[0].template;return r&&n.msgs&&(n.msgs[e.messageId].kludges.template=r),Promise.resolve(t)})).then((t=>function(e,t){var a=t.tabs[e.peerId];a.history&&(a.history=(0,m.replaceCarousel)((0,K.unpackHistory)(a.history),e,t));return Promise.resolve(t)}(e,t)))}function Je(e,t,a){var n=a.tabs[e.peerId],r=t&&t[2];return n.mediacontent||(n.mediacontent={}),n.mediacontent[e.messageId]=t||[(0,o.getTemplate)("im_retry_link")],r&&(r.no_forward&&(n.msgs[e.messageId].kludges.no_forward=!0),r.no_pin&&(n.msgs[e.messageId].kludges.no_pin=!0)),function(e,t){var a=t.tabs[e.peerId];return a.history=(0,m.replaceAttaches)((0,K.unpackHistory)(a.history),e,t),Promise.resolve(t)}(e,a)}function Xe(e,t,a){var n,r=(0,L.unpackStore)(a),s=null==(n=r.tabs)?void 0:n[e];return(null==s?void 0:s.history)&&(s.history=(0,m.replaceMessageReactions)((0,K.unpackHistory)(s.history),e,t,r)),Promise.resolve(r)}function et(e,t,a){var n=(0,m.dayFromVal)(t),r=a.tabs[e];return r.searchDay=n,r.searchOffset=0,r.searchAllLoaded=!1,r.searchMsgs=[],Promise.resolve(a)}function tt(e,t,a){return a.tabs[t].searchText=e,pt(t,a),a}function at(e,t,a){if(t){var n=a.tabs[t];n.searchText=e,n.searchOffset=0,n.searchAllLoaded=!1}else a.searchText=e,a.searchOffset=0,a.searchAllLoaded=!1;return Promise.resolve(a)}function nt(e,t,a,n){return(0,N.searchHints)(e,t,a,{},n).then((e=>e.map((e=>({peerId:e.peerId,name:e.tab,photo:e.photo,online:e.online,is_friend:"friends"===a})))))}function rt(e){return(t,a)=>e(a).then((e=>{var n=(t?e.search(t):e.list).map(F.getConvoInfoFromLocalIndex);return a.mapped_index||(a.mapped_index={}),n.forEach((e=>{a.mapped_index[e.peerId]=e})),n}))}var st=rt((e=>e.topConvTree)),it=rt((e=>e.imTopConvTree)),ot=rt((e=>e.hintsTree));function lt(e,t){var a,r,s;t.topConvTree=new Promise((e=>{a=e})),t.hintsTree=new Promise((e=>{r=e})),t.imTopConvTree=new Promise((e=>{s=e}));var i=e?e.select(g.RECENT_SEARCH_OP):[];return(0,d.retryFn)(n.post,1,(()=>4))(A.CONTROLLER,{act:"a_dialogs_preload",rs:i.join(","),gid:t.gid}).catch((e=>[[],[],[]])).then((e=>{var n=e[0],i=e[1],o=e[2],l=e[3];return t.popular_sugg=o,new U.vkIndexer(n,(e=>e[1]),a),new U.vkIndexer(i,(e=>e[1]),r),l&&l.length>0?new U.vkIndexer(l,(e=>e[1]),s):s(),t}))}function ct(e){var t,a,r=e.active_tab,s=e.dialog_tabs[r];return s.length>0?s.forEach((n=>{var r=e.tabs[n],s=r.minor_sort_id,i=r.major_sort_id;(s||i)&&(void 0===t||t>i?(t=i,a=s):t===i&&a>s&&(a=s))})):(t=0,a=0),(0,n.post)(A.CONTROLLER,{act:"a_get_dialogs",start_message_id:a,major_sort_id:t,tab:r,gid:e.gid,tags:r===p.FOLDER_PEER_TAGS&&e.peer_tags_filter?e.peer_tags_filter.mask:null}).then((t=>{var a=t[0],n=t[1],i=t[2],l=t[3];return i.forEach((t=>(0,b.oCacheAdd)(e,t))),(0,P.updateBlockStates)(l,e),(0,D.mergeTabs)(e,n),e.dialog_tabs[r]=s.filter((e=>!n[e])).concat(Object.keys(n).map(o.intval)),(0,f.isCommunityInterface)(e)||(e.dialog_tabs[r]=(0,$.getFilteredConvoList)(e,e.dialog_tabs[r],r)),e.dialog_tabs_all[r]=!a.has_more,Promise.resolve(e)}))}var dt=(0,S.wrapHashAction)((function(e,t){return(0,n.post)(A.CONTROLLER,{act:"a_search",q:e,from:"all",gid:t.gid,hash:t.writeHash,offset:t.searchOffset||0}).then((a=>{var n=a[0],r=a[1],s=a[2],i=a[3],o=a[4];return r.forEach((e=>(0,b.oCacheAdd)(t,e))),(0,m.normalizeTabsGotFromServer)(t,n),e===t.searchText&&(t.searchOffset=i,t.searchAllLoaded=o),Object.keys(n).filter((e=>!t.tabs[e])).forEach((e=>{t.tabs[e]=n[e]})),[n,s]}))}));function ut(e,t){return t.tabs[e].searchAllLoaded}function _t(e,t){return!(t.peer!==e||!(0,m.isFullyLoadedTab)(t,e))&&t.tabs[e].inplaceSearch}function gt(e,t){if((0,m.isFullyLoadedTab)(t,e)){var a=t.tabs[e];delete a.inplaceSearch,delete a.searchOffset,delete a.searchAllLoaded,delete a.searchText,delete a.searchDay,delete a.searchMsgs,re({st:""}),se()}return Promise.resolve(t)}function mt(e,t){if((0,m.isFullyLoadedTab)(t,e)){var a=t.tabs[e];delete a.searchDay,a.searchOffset=0,a.searchAllLoaded=!1,a.searchMsgs=[]}return Promise.resolve(t)}function pt(e,t){return t.tabs[e].inplaceSearch=!0,Promise.resolve(t)}var ht=(0,S.wrapHashAction)((function(e,t){var a=t.tabs[e],r="";if(pt(e,t),a.searchDay&&(r=`day:${a.searchDay}`),!r&&!a.searchText)return Promise.reject();var s=`in:${e} ${r} ${a.searchText||""}`;return re({st:a.searchText}),se(),(0,n.post)(A.CONTROLLER,{act:"a_search",q:s,from:"in",gid:t.gid,hash:t.writeHash,offset:a.searchOffset||0}).then((e=>{var t=e[0],n=e[1],r=e[2],s=e[3];return a.searchOffset=n,a.searchAllLoaded=r,a.searchMsgs=(a.searchMsgs||[]).concat(s),t}))}));function ft(e){return(0,n.post)(A.CONTROLLER,{act:"a_important",offset:e,part:e>0})}function vt(e,t){var a=(0,f.getTab)(e,t);return(0,n.post)(A.CONTROLLER,{act:"a_load_lastmsg",peerId:t,gid:e.get().gid}).then((n=>{var r=n[0],s=n[1],i=n[2],l=n[3],c=(0,o.intval)(r[0]),d=(0,L.unpackStore)(e);!c&&(0,O.isBusinessNotifyTab)(a)&&(d.dialog_tabs[p.FOLDER_BUSINESS_NOTIFY]=d.dialog_tabs[p.FOLDER_BUSINESS_NOTIFY].filter((e=>e!==t))),!(0,m.isLastMsgDebugEnabled)(e)||c||!1===a.lastmsg||(0,O.isBusinessNotifyTab)(a)||(console.log(X({},a)),(0,m.showDebugAlert)(!0)),a.lastmsg=c||!1,a.lastmsg_meta=r,a.unread=s[0],a.in_up_to=s[1],a.out_up_to=s[2],a.in_up_to_cmid=s[3],a.out_up_to_cmid=s[4],(0,Y.partConfigEnabled)("me_web_read_by_cmid")?(i?a.mention_cmids=i:a.mention_cmids&&delete a.mention_cmids,l?a.expiring_cmids=l:a.expiring_cmids&&delete a.expiring_cmids):(i?a.mentions=i:a.mentions&&delete a.mentions,l?a.expiring_messages=l:a.expiring_messages&&delete a.expiring_messages),a.unread||(d.dialog_tabs[p.FOLDER_UNREAD]=d.dialog_tabs[p.FOLDER_UNREAD].filter((e=>(0,o.intval)(e)!==t))),(0,D.updateListedConvos)(d,a,!1,(e=>Re(t,e,d)),((e,t,a)=>ca(d,e,t,a)))}))}function bt(e,t,a){if((0,m.isFullyLoadedTab)(a,t)){var n=a.tabs[t];n.deleted=n.deleted?n.deleted.concat(e):e}return Promise.resolve(a)}function Ct(e,t,a){if((0,m.isFullyLoadedTab)(a,t)){var n=a.tabs[t];if(n.history=(0,m.removeMessages)(e,(0,K.unpackHistory)(n.history)),n.offset-=e.filter((e=>n.msgs[e])).length,e.forEach((e=>delete n.msgs[e])),e.forEach((e=>{var t=(a.selectedMessages||[]).indexOf(e);-1!=t&&a.selectedMessages.splice(t,1)})),n.inplaceSearch){var r=e.reduce(((e,t)=>(e[t]=!0,e)),{});n.searchMsgs=n.searchMsgs.filter((e=>!r[e])),n.searchOffset=n.searchMsgs.length}}return Promise.resolve(a)}var Tt=(0,S.wrapHashAction)((function(e,t,a,r,s){return(0,n.post)(A.CONTROLLER,{act:"a_mark",peer:t,hash:a||s.tabs[t].hash,gid:s.gid,msgs_ids:e.join(","),mark:r})}));function Et(e,t,a,n){if((0,m.isFullyLoadedTab)(n,t)){var r=n.tabs[t];r.deleted=r.deleted?r.deleted.concat(e):e,r.history=(0,m.removeMessagesWithRestore)(e,t,a,(0,K.unpackHistory)(r.history)),r.offset-=e.filter((e=>r.msgs[e])).length}return Promise.resolve(n)}function It(e,t,a){if((0,m.isFullyLoadedTab)(a,t)){var n=a.tabs[t];n.deleted&&(n.deleted=n.deleted.filter((t=>t!==e))),n.history=(0,m.restoreMessage)(e,t,(0,K.unpackHistory)(n.history)),n.offset++}return Promise.resolve(a)}function Lt(e,t,a,r){return(0,n.post)(A.CONTROLLER,{act:"a_restore",id:e,peer:t,hash:a,gid:r})}var yt=(0,S.wrapHashAction)((function(e,t,a){return(0,O.tabIsMessageRequest)(a.tabs[e])?Promise.resolve(a):(a.tabs[e].lastTyping=Date.now(),(0,n.post)(A.CONTROLLER,{act:"a_activity",type:t,peer:e,gid:a.gid,hash:a.tabs[e].hash}).then((()=>a),(()=>a)))})),At=(0,S.wrapHashAction)(((e,t)=>(0,n.post)(A.CONTROLLER,{act:"a_accept_message_request",peer_id:e,hash:t.tabs[e].hash}).then((()=>{var a=t.tabs[e];return a.is_message_request=!1,a.folders=(0,f.removeMessageRequestFolderFlags)(a.folders),t})))),St=(0,S.wrapHashAction)(((e,t,a)=>(0,n.post)(A.CONTROLLER,{act:"a_reject_message_request",peer_id:e,is_spam:Number(t),hash:a.tabs[e].hash}).then((()=>((0,D.updateListedConvos)(a,a.tabs[e],!0,(t=>t.filter((t=>t!==Number(e))))),Ta(a.tabbedPeers.filter((t=>t.peer!==e)),!0,a),a))))),kt=(0,S.wrapHashAction)((function(e,t){return yt(e,te,t)})),Mt=(0,S.wrapHashAction)((function(e,t){return yt(e,ae,t)}));function Rt(e,t,a,n){return t&&(n.pendingForward=null,e||(e={msgIds:[]}),t.addAttach(a?"reply":"mail",e.msgIds.join(";"),e.object||null)),Promise.resolve(n)}function wt(e,t){return t.pendingForward=e,Promise.resolve(t)}function Nt(e,t,a){if(!(0,m.isTabLoaded)(a,e))return Promise.resolve(a);a.blockedFlagUpdates||(a.blockedFlagUpdates={}),a.blockedFlagUpdates[e]=!0;var n=a.tabs[e];return(0,D.updateListedConvos)(a,n,!0,(t=>t.filter((t=>t!==e)))),n.unread>0&&((0,Y.partConfigEnabled)("simplified_start_conversation")?!(0,O.tabIsNotImportantMessageRequest)(n):!(0,O.tabIsMessageRequest)(n))&&!(0,O.isBusinessNotifyTab)(n)&&Pe(a,-1,e),n.deletedDialog=!0,Ta(a.tabbedPeers.filter((t=>t.peer!==e)),!0,a),t.then((t=>{t[0],t[1];return delete a.blockedFlagUpdates[e],n.msgs=null,n.history=null,n.unread=0,n.lastmsg=!1,n.lastmsg_meta=null,a}))}var Ot=(0,S.wrapHashAction)((function(e,t){return Nt(e,(0,n.post)(A.CONTROLLER,{act:"a_flush_history",id:e,from:"im",gid:t.gid,hash:t.tabs[e].hash}),t)})),Pt=(0,S.wrapHashAction)((function(e,t,a){return(0,n.post)(A.CONTROLLER,{act:"a_set_chat_title",peer:e,new_title:t,gid:a.gid,hash:a.tabs[e].hash}).then((()=>(a.onUpdate&&a.onUpdate(),a)))})),xt=(0,S.wrapHashAction)((function(e,t){return(0,n.post)(A.CONTROLLER,{act:"a_load_chat_info",peer:e,gid:t.gid,hash:t.tabs[e].hash}).then((a=>{var n=a[0];return t.tabs[e]=(0,o.extend)(t.tabs[e],n),t}))}));function Dt(e,t){if((0,i.isEmpty)(e))return Promise.resolve(t);var a=Object.keys(e).map((t=>`${t}:${e[t].join(",")}`)).join(";");return(0,n.post)(A.CONTROLLER,{act:"a_load_member",need:a,gid:t.gid}).then((e=>(e[0].forEach((e=>(0,b.oCacheAdd)(t,e))),t)))}function Ft(e,t,a){var n={},r=a.get();function s(e,t){Q.Ranges.isChatOrChannelPeer(e)&&t&&!(0,b.oCacheExists)(r,t)&&(n[e]?-1===n[e].indexOf(t)&&n[e].push(t):n[e]=[t])}var i=t.filter((e=>!(0,m.isTabLoaded)(r,e.peerId))).map((e=>e.peerId));t.forEach((e=>{s(e.peerId,e.userId)})),e.forEach((e=>{s(e.peerId,Number(e.kludges.source_mid)),s(e.peerId,Number(e.kludges.from))}));var o=t.filter((e=>e.flags&c.FLAG_OUTBOUND&&!e.local)).map((e=>e.kludges.from_admin)).filter((e=>e&&!r.admins[e]));return 0===Object.keys(n).length&&0===o.length&&0===i.length?Promise.resolve(r):{shouldLoad:Object.keys(n).length>0||o.length>0||i.length>0,needMembers:n,needAdminIds:o,needPeers:i}}function Ht(e,t,a){var n=e.needMembers,r=e.needAdminIds,s=e.needPeers;return t.pause(),Promise.all([Dt(n,a),ke(r,a),Promise.all(s.map((e=>(0,N.loadPeer)(a,e,0,!1,!1,"loadPeople"))))]).catch((()=>a)).then((()=>t.resume())).then((()=>a))}var Ut=(0,S.wrapHashAction)((function(e,t){return e.kludges.source_act===m.CHAT_PHOTO_REMOVE?(delete t.tabs[e.peerId].photo,delete t.tabs[e.peerId].photoLarge,Promise.resolve(t)):(t.onUpdate&&t.onUpdate(),(0,n.post)(A.CONTROLLER,{act:"a_get_chat_photo",msg_id:e.messageId}).then((a=>{var n=a[0],r=a[1];t.chat_photo_msg=r;var s=t.tabs[e.peerId];if(t.tabs[e.peerId].photo=n[0],t.tabs[e.peerId].photoLarge=n[1],(0,m.isFullyLoadedTab)(t,e.peerId)){var i=e.kludges.source_act;s.history=(0,m.addChatPhotoToUpdate)(e,i,t,(0,K.unpackHistory)(s.history))}return t})))}));function Bt(e,t,a,n){return t!==vk.id||(0,m.isTabLoaded)(n,a)&&n.peer==a&&(n=(0,D.setActions)(n)),Promise.resolve(n)}var jt=(0,S.wrapHashAction)((function(e,t){return(0,n.post)(A.CONTROLLER,{act:"a_leave_chat",chat:Q.Ranges.convertChatPeerIdToChatId(e),gid:t.gid,hash:t.tabs[e].hash}).then(Bt.bind(null,m.CHAT_KICK_USER,vk.id,e,t))})),Gt=(0,S.wrapHashAction)((function(e,t){return(0,n.post)(A.CONTROLLER,{act:"a_return_to_chat",chat:Q.Ranges.convertChatPeerIdToChatId(e),gid:t.gid,hash:t.tabs[e].hash}).then(Bt.bind(null,m.CHAT_INVITE_USER,vk.id,e,t))})),qt=(0,S.wrapHashAction)((function(e,t,a,r){return(0,n.post)(A.CONTROLLER,{act:"a_mute",peer:e,hash:r.tabs[e].hash,gid:r.gid,value:Number(t),until:a}).then((()=>{var a=t?"mute":"unmute";return window.Notifier&&Notifier.lcSend("im",{act:a,peer:e}),r})).then(Yt.bind(null,e,t))})),Vt=(0,S.wrapHashAction)((function(e,t,a){return(0,n.post)(A.CONTROLLER,{act:"a_mute_mentions",peer:e,hash:a.tabs[e].hash,gid:a.gid,value:Number(t)}).then((()=>a))}));function Yt(e,t,a){var n=a.mutedPeers.filter((t=>t!==e));return t&&n.push(e),a.mutedPeers=n,cur.mutedPeers=a.mutedPeers,(0,D.setActions)(a)}function Kt(e,t){return t.stack=e,Promise.resolve(t)}var zt=(0,S.wrapHashAction)((function(e,t,a,r){return $t(e,a,t,r),(0,n.post)(A.CONTROLLER,{act:"a_mark_important",ids:e,val:t?1:0,from:"im",gid:r.gid,peer:a,hash:r.tabs[a].hash}).then((()=>r))}));function $t(e,t,a,n){if((0,m.isFullyLoadedTab)(n,t)){var r=n.tabs[t];e.filter((e=>r.msgs[e])).forEach((e=>{var s=(0,f.getMessage)(n,t,e),i=a?s.flags|c.FLAG_IMPORTANT:s.flags&~c.FLAG_IMPORTANT;s.flags=i,r.msgs[e]=s,r.history=(0,m.updateStar)(e,a,(0,K.unpackHistory)(r.history))}))}return Promise.resolve(n)}function Wt(e,t,a){return a.importants||(a.importants={}),(a.importants[t]||0)!==e&&(a.important_cnt+=e,a.importants[t]=e),Promise.resolve(a)}function Qt(e,t){return(0,n.post)(A.CONTROLLER,{act:"a_spam",offset:e,gid:t,part:e>0})}function Zt(e,t){return(0,n.post)(A.CONTROLLER,{act:"a_flush_spam",gid:t,hash:e})}function Jt(e,t,a){return a.creationType=e,a.creationFilter=t,Promise.resolve(a)}function Xt(e,t){return(0,H.ownerPhoto)(JSON.parse(e).data[0],t)}function ea(e){return(0,n.post)(A.CONTROLLER,{act:"a_get_contacts"}).then((t=>{var a=t[0];return e.contactsList=a,e}))}function ta(e,t){return t.next_chat_avatar=e,Promise.resolve(t)}function aa(e){var t;e.resync_in_process=new Promise((e=>{t=e}));var a=Object.keys(e.tabs).length,r=e.active_tab;return(0,_.lplog)("Resync started"),(0,Y.partConfigEnabled)("im_chasiky_debug")&&window.meBufferLog&&(window.meBufferLog.resync={timestamp:Date.now(),ts:window.lpConnect.options.ts}),(0,n.post)(A.CONTROLLER,{act:"a_resync",sel:e.peer,gid:e.gid,loaded:a,tab:r,add_peers:e.tabbedPeers.map((e=>e.peer)).join(",")}).then((a=>{var n=a[0],s=a[1],i=a[2],l=a[3],c=a[4];s.forEach((t=>(0,b.oCacheAdd)(e,t))),(0,m.normalizeTabsGotFromServer)(e,n),(0,_.lplog)("Resync success","success");var d,u=e.peer;if(Q.Ranges.isZeroOwner(u))d=Promise.resolve(!1);else{var g={tabs:{[u]:e.tabs[u]},oCache:{},imQueueComplete:e.imQueueComplete};d=(0,D.mergeTabs)(g,{[u]:n[u]})}return d.then((a=>{e.tabs=n,e.admins=(0,o.extend)(e.admins,l),a&&(e.tabs[u]=a.tabs[u],e.tabs[u].history=(0,N.restoreQueuedMessagesInDom)(e,u,(0,K.unpackHistory)(e.tabs[u].history))),e.loadingDialogs=!1,e.mutedPeers=i.mutedPeers,e.lastDialogsOptions={has_more:i.has_more},e.dialog_tab_cts=i.folder_cts,e.dialog_tabs[r]=c.map(o.intval),e.dialog_tabs_all[r]=!1;for(var s=e.dialog_tabs[r].map((t=>e.tabs[t])),d=0,_=Object.keys(e.dialog_tabs);d<_.length;d++){var g=_[d];if(r!==g){var m=[];if(r===p.FOLDER_ALL)for(var h,f=Z(s);!(h=f()).done;){var v=h.value;(0,F.getFilterFnForConvoListFolder)(g)(v)&&m.push(v.peerId)}e.dialog_tabs_all[g]=!1,e.dialog_tabs[g]=m}}return delete e.resync_in_process,setTimeout(t.bind(null,!0),0),(0,P.setUnreadCounters)(i,e)}))})).then((e=>((0,j.updateUnreadCounter)(e),e))).catch((t=>((0,_.lplog)("Resync error: "+t.message+" "+t.stack,"error"),(0,d.pause)(2).then(aa.bind(null,e)))))}function na(e,t){return t.lockedSending=e,Promise.resolve(t)}function ra(e,t,a){return e&&!a.delayed_message?(a.delayed_message=e,a.delayed_ts=t):e||(a.delayed_message=e,a.delayed_ts=t),Promise.resolve(a)}function sa(e){return!!e.textMediaSelector.urlAttachmentLoading||!!(window.Upload&&Upload.options&&Upload.isSomethingUploading)&&Object.keys(Upload.options).filter((e=>Upload.isSomethingUploading(e))).length>0}function ia(e,t,a){a.cur_unread_cnt||(a.cur_unread_cnt={}),t&&!(0,o.inArray)(e,a.mutedPeers)&&(a.cur_unread_cnt[e]=!0);var n=document.title,l=window.devicePixelRatio>=2?"_2x":"";if(t&&!a.update_title_to){var c=function(e,t,a){return function(){a.update_old_title=e;var n=Object.keys(a.cur_unread_cnt).length;if(0===n)return(0,I.setDocumentTitle)(e||document.title),(0,r.setFavIcon)("/images/icons/favicons/fav_im"+t+".ico"),clearInterval(a.update_title_to),void(a.update_title_to=!1);if(e)(0,I.setDocumentTitle)(e),(0,r.setFavIcon)("/images/icons/favicons/fav_im"+t+".ico"),e=!1;else{e=document.title;var o=n>9?10:n;(0,r.setFavIcon)("/images/icons/favicons/fav_im"+o+t+".ico"),(0,I.setDocumentTitle)((0,i.winToUtf)((0,s.getLang)("mail_im_new_messages",n)))}}}(n,l,a);a.update_title_to=setInterval(c,1e3),c()}else!t&&a.update_old_title&&((0,I.setDocumentTitle)(a.update_old_title),a.cur_unread_cnt={},n=!1,a.update_old_title=!1,(0,r.setFavIcon)("/images/icons/favicons/fav_im"+l+".ico"),clearInterval(a.update_title_to),a.update_title_to=!1);return Promise.resolve(a)}function oa(e,t,a,n,r){return(0,m.isFullyLoadedTab)(r,e)&&(r.tabs[e].scrollTop=(0,o.intval)(t),r.tabs[e].scrollBottom=(0,o.intval)(a),r.tabs[e].contHeight=(0,o.intval)(n)),Promise.resolve(r)}function la(e,t){var a=t.active_tab;if(t.active_tab=e,(0,l.updateLocation)({tab:e===p.FOLDER_ALL?null:e,tags:e===p.FOLDER_PEER_TAGS&&t.peer_tags_filter?t.peer_tags_filter.mask:null}),e!==p.FOLDER_ALL&&!(0,m.isReversedDialogs)(t)){var n=t.dialog_tabs[e],r=(0,$.getFilteredConvoList)(t,t.dialog_tabs[p.FOLDER_ALL],e);t.dialog_tabs[e]=n.length>=r.length?n:r}return a===p.FOLDER_PEER_TAGS&&e!==a&&(t.peer_tags_filter.ids=[],(0,x.renderPeerTagsFilter)(t),(0,x.renderPeerTagsFilterPane)(t)),Promise.resolve(t)}function ca(e,t,a,n){var r=e.dialog_tabs_all;return(0!==n.minor_sort_id||0!==n.major_sort_id)&&(!(t===p.FOLDER_BUSINESS_NOTIFY&&!n.lastmsg)&&(!(!r[p.FOLDER_ALL]&&!r[t])||(!!a.includes(n.peerId)||("r"===n.lastmsg[0]||a.map((t=>e.tabs[t.toString()])).filter((t=>(0,m.isReversedDialogs)(e)?t.major_sort_id>n.major_sort_id||t.minor_sort_id>n.minor_sort_id:t.major_sort_id<n.major_sort_id||t.minor_sort_id<n.minor_sort_id)).length>0))))}function da(e,t,a,n,r,s){if((0,m.isTabLoaded)(s,e)&&!r){var i=s.tabs[e];return a===c.REPLACE_DIRECTORIES&&(t^=i.folders),function(e,t,a){return!(e===c.SET_DIRECTORIES&&a.folders&t||!(e!==c.RESET_DIRECTORIES||a.folders&t)||((0,Y.partConfigEnabled)("simplified_start_conversation")?(0,O.tabIsNotImportantMessageRequest)(a):(0,O.tabIsMessageRequest)(a)))}(a,t,i)&&Object.keys(p.FOLDER_MASKS).filter((e=>p.FOLDER_MASKS[e]&t)).forEach((e=>{var t=s.dialog_tab_cts[e];t&&(t.total=(0,z.getConvoListFolderCounterDisplayed)(s,e)+function(e,t,a){return t!==c.RESET_DIRECTORIES||e.folders&p.FOLDER_MASKS[a]?t===c.REPLACE_DIRECTORIES?e.folders&p.FOLDER_MASKS[a]?-1:1:t===c.SET_DIRECTORIES?1:-1:0}(i,a,e))})),a===c.SET_DIRECTORIES?s.tabs[e].folders|=t:a===c.RESET_DIRECTORIES?s.tabs[e].folders&=~t:s.tabs[e].folders=t^=i.folders,(0,D.updateListedConvos)(s,s.tabs[e],!0,((t,a)=>a===p.FOLDER_PEER_TAGS?t:(0,$.getFilteredConvoList)(s,[...t,e],a)),((e,t,a)=>ca(s,e,t,a))),Promise.resolve(s)}return(0,N.loadPeer)(s,e,0,!1,!1,"updateFolders").then((()=>da(e,t,a,null,!1,s)))}var ua=(0,S.wrapHashAction)((function(e,t){var a=p.FOLDER_MASKS[p.FOLDER_IMPORTANT],r=t.tabs[e].folders&a,s=r?c.resetDirectoriesEvent:c.setDirectoriesEvent;return t.longpoll.push([s([0,e,a,!0])]),(0,n.post)(A.CONTROLLER,{act:"a_dialog_star",val:r?0:1,peer:e,hash:t.tabs[e].hash,gid:t.gid}).then((()=>t))})),_a=(0,S.wrapHashAction)((function(e,t){var a=p.FOLDER_MASKS[p.FOLDER_UNRESPOND],r=t.tabs[e];if(r)return(0,Y.partConfigEnabled)("me_web_read_by_cmid")?t.longpoll.push([c.resetDirectoriesEvent([0,e,a,!0]),c.readInboundByCmidEvent([10006,e,r.lastmsg_meta.chat_local_id,null])]):t.longpoll.push([c.resetDirectoriesEvent([0,e,a,!0]),c.readInboundEvent([6,e,r.lastmsg,null])]),(0,n.post)(A.CONTROLLER,{act:"a_mark_answered",peer:e,lastmsg:r.lastmsg,hash:t.tabs[e].hash,gid:t.gid}).then((()=>t))})),ga=(0,S.wrapHashAction)(((e,t)=>(t.longpoll.push([(0,R.resetPeer)(),c.setDirectoriesEvent([0,e,p.FOLDER_MASKS[p.FOLDER_MARKED_UNREAD],!0])]),(0,n.post)(A.CONTROLLER,{act:"a_mark_conversation_as_unread",peer_id:e,hash:t.tabs[e].hash,gid:t.gid})))),ma=(0,S.wrapHashAction)(((e,t)=>{t.longpoll.push([c.resetDirectoriesEvent([0,e,p.FOLDER_MASKS[p.FOLDER_MARKED_UNREAD],!0])]);var a=t.tabs[e],r=(0,Y.partConfigEnabled)("me_web_read_by_cmid")?{start_cmid:(0,T.getLastMeta)(t,e).chat_local_id}:{ids:[a.lastmsg]};return(0,n.post)(A.CONTROLLER,X({peer:e,mark_conversation_as_read:!0,hash:a.hash,act:"a_mark_read",gid:t.gid},r)).then((()=>t))}));function pa(e){return(0,n.post)(A.CONTROLLER,{act:"a_get_mutex_key",gid:e})}function ha(e,t){return(0,P.updateBlockStates)({[e]:{free:!0}},t),(0,n.post)(A.CONTROLLER,{act:"a_block_release",peer:e,gid:t.gid}).then((()=>t))}function fa(e,t){var a=ls.get("comm_mute_"+t.gid)?1:0;return e&&(a^=1),ls.set("comm_mute_"+t.gid,a),t.mute=a,Promise.resolve(t)}var va=(0,S.wrapHashAction)((function(e,t){return(0,D.updateListedConvos)(t,t.tabs[e],!0,(t=>t.filter((t=>t!==e)))),t.tabs[e].deletedDialog=!0,(0,n.post)(A.CONTROLLER,{act:"a_delete_dialog",peer:e,gid:t.gid,hash:t.tabs[e].hash}).then((a=>(a[0]?(Ta(t.tabbedPeers.filter((t=>t.peer!==e)),!0,t),t.tabs[e].unread=0,t.tabs[e].lastmsg=!1,t.tabs[e].lastmsg_meta=null):(t.tabs[e].deletedDialog=!1,(0,D.updateListedConvos)(t,t.tabs[e],!1,(a=>Re(e,a,t)),((e,a,n)=>ca(t,e,a,n)))),a)))}));function ba(e,t,a,r){return(0,n.post)(A.CONTROLLER,{act:"a_restore_dialog",hash:t,gid:r.gid,spam:a?1:0,peer:e}).then((t=>(r.tabs[e].deletedDialog=!1,(0,D.updateListedConvos)(r,r.tabs[e],!1,(t=>[e].concat(t))),r.tabs[e].unread=t,r)))}function Ca(e,t,a){return(0,n.post)(A.CONTROLLER,{act:"a_spam_dialog",peer:e,gid:a.gid,hash:t})}function Ta(e,t,a){return a.tabbedPeers=e,(0,m.isClassicInterface)(a)&&(re({peers:a.tabbedPeers.filter((e=>{var t=e.peer,n=e.type;return t!==a.peer&&"perm"===n})).map((e=>(0,m.getBareTab)(e.peer,a))).filter((e=>!e.deletedDialog)).map((e=>e.peerId)).map(m.convertPeerToUrl).join("_"),to:""}),t&&se()),Promise.resolve(a)}function Ea(e){return!e.peer||(_t(e.peer,e)?ut(e.peer,e):!!(0,m.isFullyLoadedTab)(e,e.peer)&&e.tabs[e.peer].allShown)}function Ia(e,t){var a=t.tabs[e];return(0,m.isFullyLoadedTab)(t,e)&&(a.skipped=null,a.msgs=null,a.offset=null,a.allShown=null,a.history=null),Promise.resolve(t)}function La(e,t){var a=t.tabs[e];return(0,m.isFullyLoadedTab)(t,e)&&(a.history=le(a.history)),Promise.resolve(t)}function ya(e,t){return t.go_to_end_visible=e,Promise.resolve(t)}function Aa(e,t){return t.go_to_mentions_visible=e,Promise.resolve(t)}function Sa(e,t){return t.go_to_reactions_available=e,Promise.resolve(t)}function ka(e,t,a){if(!Q.Ranges.isGroupId(t))return Promise.resolve(a);var r=(0,f.getTab)(a,t);return r.blocked_community=!e,!1===e&&(r.can_send_notify=!1),(0,n.post)(A.CONTROLLER,{act:"a_toggle_community",peer_id:t,hash:r.hash,state:e?1:0}).then((()=>(0,D.setActions)(a)))}function Ma(e){if(0!==e.peer&&(0,m.isFullyLoadedTab)(e,e.peer)){var t=(0,f.getTab)(e,e.peer),a=(0,I.geByClass1)("_im_peer_history");a&&(t.history=(0,K.unpackHistory)(a.innerHTML))}return Promise.resolve(e)}function Ra(e){return e.audio_msg.isRecording=!1,Promise.resolve(e)}function wa(e,t){return t.voice_message_available=e,Promise.resolve(t)}function Na(e){re({act:e?"create":null}),se()}function Oa(e){void 0===e&&(e=null),re({q:e}),se()}function Pa(e){return void 0===e.chatResizeInitialized&&(e.chatResizeInitialized=!0,(0,m.getClassicChatHeight)()>(0,I.clientHeight)()&&(0,m.setClassicChatHeight)(0)),Promise.resolve(e)}var xa=(0,S.wrapHashAction)((function(e,t,a,r){return(0,n.post)(A.CONTROLLER,{act:"a_join_chat",chat_id:e,hash:t,invite_link:a,write_hash:r.writeHash}).then((e=>{var t=e[0],a=e[1],n=e[2],s=e[3];return n.forEach((e=>(0,b.oCacheAdd)(r,e))),r.tabs[t]=a,(0,D.updateListedConvos)(r,a,!1,(e=>Re(t,e,r)),((e,t,a)=>ca(r,e,t,a))),r.admins=(0,o.extend)(r.admins,s),[t]}))}));function Da(e,t){return(0,n.post)(A.CONTROLLER,{act:"a_get_link",gid:t.gid,chat_id:e})}var Fa=(0,S.wrapHashAction)((function(e,t){var a=t.tabs[e];return(0,n.post)(A.CONTROLLER,{act:"a_reset_link",chat_id:e-2e9,write_hash:t.writeHash,gid:t.gid}).then((e=>(a.inviteLink=e[0],e)))}));function Ha(e){return ie({invite_chat_id:null,invite_hash:null,mr:null,invite_link:null}),e.invitation=void 0,Promise.resolve(e)}function Ua(e,t){var a=(0,_.arrayUnique)([e].concat(t.select(g.RECENT_SEARCH_OP))).slice(0,500);t.update(g.RECENT_SEARCH_OP,a)}function Ba(e){e.update(g.RECENT_SEARCH_OP,[])}function ja(e,t){var a=t.select(g.RECENT_SEARCH_OP).filter((t=>t!==e));return t.update(g.RECENT_SEARCH_OP,a),a}function Ga(e,t,a){var n=a.tabs[t],r=(0,f.getMessage)(a,t,e);return(0,f.isChatActive)(n)&&!r.kludges.source_act&&(n.pinned=r),Promise.resolve(a)}function qa(e,t){return t.tabs[e].pinned=null,Promise.resolve(t)}var Va=(0,S.wrapHashAction)((function(e,t,a){var r=a.tabs[t];return(0,f.isChatActive)(r)?(0,n.post)(A.CONTROLLER,{act:"a_pin_message",msgid:e,chat:t,gid:a.gid,hash:a.tabs[t].hash}).then((e=>{var n=e[0];return a.tabs[t]=Object.assign({},r,n),a})):Promise.resolve(a)})),Ya=(0,S.wrapHashAction)((function(e,t){var a=t.tabs[e];return(0,f.isChatActive)(a)?(0,n.post)(A.CONTROLLER,{act:"a_unpin_message",chat:e,gid:t.gid,hash:t.tabs[e].hash}).then((n=>{var r=n[0];return t.tabs[e]=Object.assign({},a,r),t})):Promise.resolve(t)})),Ka=(0,S.wrapHashAction)((function(e,t){var a=t.tabs[e];return(0,n.post)(A.CONTROLLER,{act:"a_get_pinned_message",chat:e,gid:t.gid,hash:t.tabs[e].hash}).then((e=>{var n=e[0];return a.pinned=n||null,t}))})),za=(0,S.wrapHashAction)((function(e,t,a){var r=a.tabs[e];return(0,n.post)(A.CONTROLLER,{act:"a_get_message_local_id",chat:e,chat_local_id:t,hash:r.hash})})),$a=(0,S.wrapHashAction)((function(e,t){return Promise.all([ve(e,t),function(e,t){var a=t.tabs[e];return(0,n.post)(A.CONTROLLER,{act:"a_get_chat_details",chat:e,gid:t.gid,hash:a.hash}).then((e=>{var n=e[0];return a.photoGrid=n.grid,a.photoLarge=n.photo,a.membersLastSeen=n.lastSeen||null,a.inviters=n.inviters,a.caccess=n.caccess,a.invitedByMe=n.invitedByMe||[],a.inviteLinks=n.links||null,a.invitedByMessageRequest=n.invitedByMessageRequest,a.canRestore=n.canRestore,a.serverSettings=n.serverSettings||null,a.isDefaultPhotoOwner=n.isDefaultPhotoOwner||null,a.owner=n.owner||null,a.allowedUpdateFlags=n.allowedUpdateFlags,a.canInvite=n.canInvite||null,a.notifications=n.notifications,t}))}(e,t),(0,N.getCustomChatMemberSearch)(t,e)||Promise.resolve()]).then((()=>t))})),Wa=(0,S.wrapHashAction)((function(e,t,a){var r=a.tabs[e];return(0,n.post)(A.CONTROLLER,{act:"a_update_flags",chat:e,gid:a.gid,hash:r.hash,flags:t}).then((e=>(a.onUpdate&&a.onUpdate(),e)))})),Qa=(0,S.wrapHashAction)((function(e,t){var a=t.tabs[e];return(0,n.post)("al_page.php",{act:"owner_photo_remove",oid:e,gid:t.gid,hash:a.photoHash}).then((()=>(a.photo=null,a.photoLarge=null,t.onUpdate&&t.onUpdate(),t)))}));function Za(e,t,a,n){var r=n.tabs[e];return r.adminIds=a?[].concat(r.adminIds,t).filter(((e,t,a)=>a.indexOf(e)===t)):r.adminIds.filter((e=>e!==t)),Promise.resolve(n)}var Ja=(0,S.wrapHashAction)((function(e,t,a,r){var s=r.tabs[e];return(0,n.post)(A.CONTROLLER,{act:"a_toggle_admin",chat:e,hash:s.hash,mid:t,is_admin:+a,gid:r.gid}).then((()=>Za(e,t,a,r)))}));function Xa(e,t,a,n){var r=(0,f.getMessage)(e,a,t).userId;return(0,b.oCacheGet)(n,r)?Promise.resolve(n):Dt({[a]:[r]},n)}function en(){ajax.post("al_im.php",{act:"a_hide_promo_tooltip"})}var tn=(0,S.wrapHashAction)((function(e,t){return t.tabs[e].top_banner=void 0,(0,n.post)(A.CONTROLLER,{act:"a_hide_banner",peer_id:e,gid:t.gid,hash:t.tabs[e].hash}).then((()=>t))})),an=(0,S.wrapHashAction)((function(e,t,a){a.tabs[e].top_banner=void 0;var r=a.tabs[e];return(0,n.post)(A.CONTROLLER,{act:"a_callback_banner",peer_id:e,callback_data:t,hash:r.hash}).then((()=>a))}));function nn(e,t){return(0,n.post)(A.CONTROLLER,{act:"a_load_banner",peer_id:e,gid:t.gid}).then((a=>{var n=a[0];return t.tabs[e].top_banner=n,t}))}function rn(e,t,a){return a.tabs[e].keyboard=t&&t.buttons?t:null,on(e,!1,!0,a)}function sn(e,t){return rn(e,null,t)}function on(e,t,a,n){return((n.tabs||{})[e]||{}).keyboard&&(n.tabs[e].keyboard.hide=t,a&&ls.set("is_keyboards_hide",Object.assign(ls.get("is_keyboards_hide")||{},{[e]:t}))),Promise.resolve(n)}var ln=(0,S.wrapHashAction)((function(e,t){var a=t.tabs[e];return(0,n.post)(A.CONTROLLER,{act:"a_get_keyboard",peer_id:e,hash:a.hash}).then((a=>{var n=a[0];return rn(e,n,t)}))}));function cn(e,t,a,r){var s=r.tabs[e];return s.caccess[t]=a,(0,n.post)(A.CONTROLLER,{act:"a_change_caccess",peer_id:e,member_id:t,hash:s.hash,access:a?1:0,gid:r.gid}).then((()=>r)).catch((e=>{throw s.caccess[t]=!a,e}))}var dn=(0,S.wrapHashAction)((function(e,t){var a=t.tabs[t.peer];return(0,n.post)(A.CONTROLLER,{act:"a_delete_template",template_id:e,hash:a.hash,gid:t.gid,peer_id:t.peer}).then((()=>{var a=t.templates.find((t=>t.id===e));return a&&(a.deleted=!0),t}))}));function un(e,t,a){var r=a.tabs[a.peer];return(0,n.post)(A.CONTROLLER,{act:"a_create_template",hash:r.hash,gid:a.gid,peer_id:a.peer,name:e,text:t}).then((e=>(a.templates.unshift(e[0]),a)))}function _n(e,t,a,r){var s=r.tabs[r.peer];return(0,n.post)(A.CONTROLLER,{act:"a_update_template",template_id:e,hash:s.hash,gid:r.gid,peer_id:r.peer,group_id:r.gid,name:t,text:a}).then((t=>{var a=r.templates.find((t=>t.id===e));return a&&Object.assign(a,t[0]),r}))}function gn(e,t){if((0,m.isFullyLoadedTab)(t,e)){var a=(0,f.getTab)(t,e);a.allShown=!1,a.lastReset=Date.now()}return t}function mn(e,t){var a=e.updateType,n=e.updateArg,r=0;a===c.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED&&(r=n===c.MESSAGE_REQUEST_STATUS_NEW?1:-1),a===c.MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED&&(r=-1);var s=t.dialog_tab_cts[A.ConvoListFolder.MR];return s&&(s.total=(0,z.getConvoListFolderCounterDisplayed)(t,A.ConvoListFolder.MR)+r),Promise.resolve(t)}function pn(e,t,a){if((0,m.isFullyLoadedTab)(a,e.peerId)){var n=(0,f.getTab)(a,e.peerId);n.history=(0,m.setCasperMessageExpiringStatusDOM)(n.history,t,e.messageId)}return Promise.resolve(a)}function hn(e,t){return Promise.resolve().then((()=>{if((0,m.isFullyLoadedTab)(t,e)){var a=(0,f.getTab)(t,e);Object.values(a.msgs).forEach((e=>{var t=(0,f.parserMessage)(e);(0,v.isCasperMessage)(t)&&!y.casperMessagesStore.has(t.chat_local_id)&&y.casperMessagesStore.add(t)}))}return Promise.resolve(t)}))}var fn=(0,S.wrapHashAction)((function(e,t,a,r,s){return(0,n.post)(A.CONTROLLER,{act:"a_peer_profile_toggle_tag",hash:s.manage_tags_hash,group_id:s.gid,peer_id:r,tag_id:e,action:a}).then((a=>{s.tabs[r].peer_tags=a[0];var n=s.peer_profile_tags.findIndex((t=>t.id===e));return t?s.peer_profile_tags[n].uses++:!t&&s.peer_profile_tags[n].uses>0&&s.peer_profile_tags[n].uses--,s}))})),vn=(0,S.wrapHashAction)((function(e,t){return(0,n.post)(A.CONTROLLER,{act:"a_peer_profile_manage_tags",hash:t.manage_tags_hash,group_id:t.gid,tags:JSON.stringify(e)}).then((e=>(t.peer_profile_tags=e[0].tags,t)))})),bn=(0,S.wrapHashAction)((function(e,t,a){return(0,n.post)(A.CONTROLLER,{act:"a_peer_profile_save_note",hash:a.manage_tags_hash,group_id:a.gid,peer_id:e,note:t}).then((()=>(a.tabs[e].peer_profile_info.note=t,a)))})),Cn=(0,S.wrapHashAction)(((e,t)=>(0,n.post)(A.CONTROLLER,{act:"a_reload_message",msg_id:e,hash:t.writeHash}).then((e=>e[0])))),Tn=(0,S.wrapHashAction)(((e,t)=>{var a=t.tabs[e];return(0,n.post)(A.CONTROLLER,{act:"a_get_active_call_data",peer_id:a.peerId,hash:a.hash}).then((e=>{var n=e[0];return n?a.callInProgress=n:a.callInProgress&&delete a.callInProgress,t}))})),En=(e,t)=>{var a=t.tabs[e];return a.callInProgress&&delete a.callInProgress,Promise.resolve(t)};function In(e,t){return t.peer_tags_filter&&t.peer_tags_filter.ids!==e&&(0,D.resetFolderList)(t,A.ConvoListFolder.PEER_TAGS),t.peer_tags_filter={ids:e,mask:(0,x.convertPeerTagsFilterToMask)(t.peer_profile_tags,e)},Promise.resolve(t)}function Ln(e,t,a,n){var r=(0,f.getTab)(n,e);if(r){var s,i,o=r.peer_tags?r.peer_tags.ids:[];if(r.peer_tags={ids:t,mask:a},t.length!==o.length)t.length>o.length?(s=!0,i=t.filter((e=>!o.includes(e)))[0]):(s=!1,i=o.filter((e=>!t.includes(e)))[0]),n=function(e,t,a){if(!a.peer_profile_tags)return a;var n=a.peer_profile_tags.find((t=>t.id===e));n&&(t?n.uses++:n.uses>0&&n.uses--);return a}(i,s,n)}return Promise.resolve(n)}function yn(e){return e.dialog_tabs[p.FOLDER_PEER_TAGS]=e.dialog_tabs[p.FOLDER_ALL].map((t=>(0,f.getTab)(e,t))).filter((t=>(0,x.applyPeerTagsFilterToTab)(e,t))).map((e=>e.peerId)),Promise.resolve(e)}function An(e){return(0,n.post)(A.CONTROLLER,{act:"a_get_peer_profile_tags",group_id:e.gid}).then((t=>(e.peer_profile_tags=t[0].tags,e.active_tab===p.FOLDER_PEER_TAGS?(e.peer_tags_filter.ids=e.peer_profile_tags.filter((t=>e.peer_tags_filter.ids.includes(t.id))).map((e=>e.id)),e.peer_tags_filter.mask=(0,x.convertPeerTagsFilterToMask)(e.peer_profile_tags,e.peer_tags_filter.ids),(0,l.updateLocation)({tab:p.FOLDER_PEER_TAGS,tags:e.peer_tags_filter.mask}),yn(e)):e)))}},516703:(e,t,a)=>{"use strict";a.d(t,{statlogsForwardEvent:()=>d,statlogsForwardFromCommunityEvent:()=>u,statlogsCommunityTemplatesClickEvent:()=>_,statlogsForwardFromChannel:()=>g,statlogsSendingTime:()=>p,statlogsSendingTimeStart:()=>h,statlogsSendingTimeEnd:()=>f,statlogsSendingError:()=>v,statlogsSendingQueueLength:()=>C,statlogsSendingRetry:()=>T});a(682772),a(115306);var n=a(327125),r=a(171516),s=a(506770),i=a(414332),o=a(67328),l=new i.DevNullStatCollector(new i.CustomStatCollector),c={};function d(e){(0,n.statlogsProbValueEvent)(.1,"im_forward_stat",m(e),!!e.get().gid)}function u(e,t){(0,n.statlogsProbValueEvent)(.1,"im_forward_from_community_stat",m(e),!!e.get().gid,+t)}function _(){(0,n.statlogsProbValueEvent)(1,"im_apply_community_template_stat",1)}function g(){(0,n.statlogsProbValueEvent)(1,"messages_channel_forward_click",1)}function m(e){var t=e.get().pendingForward;return+(t&&t.msgIds&&t.msgIds.length)}function p(e,t,a,n){void 0===n&&(n=!1);if(!(0,s.randEnabled)(1))return()=>{};var i=+new Date,c=b(e),d=function(e){var t=(0,o.unpackStore)(e);return Boolean(t.longpoll&&t.longpoll.isSSE)}(e)?"sse":"longpoll";return function(){var e=+new Date-i;(0,r.saveStatlogEvents)({name:"messages_send_time_web",value:e,keys:[t,a,c,n,d]}),"opt_to_lp"===a&&l.logEvent({key:"messages_send_time_web",value_str:d,value:e})}}function h(e,t,a,n){if(t.messageId&&-1!==String(t.messageId).indexOf("rid")){var r=[t.messageId.replace("rid",""),a,n].join("_"),s=t.attaches.length>0;c[r]=p(e,a,n,s)}}function f(e,t,a,n){var r=[t.randomId,a,n].join("_"),s=c[r];s&&(s(),delete c[r])}function v(e,t,a,r){var i=b(e),o=""===t?"network":"unknown";(0,s.randEnabled)(1)&&(0,n.statlogsValueEvent)("messages_send_errors_web",o,a,r,i)}function b(e){var t=(0,o.unpackStore)(e);return Boolean(t.longpoll&&t.longpoll.isEnabled&&t.longpoll.isEnabled())}function C(e){var t=(0,o.unpackStore)(e),a=t.imQueue(t.peer).length;(0,s.randEnabled)(1)&&(0,n.statlogsValueEvent)("messages_send_queue_size",a)}function T(e,t){void 0===t&&(t="unknown");(0,s.randEnabled)(1)&&(0,n.statlogsValueEvent)("messages_send_retry",1,t,e)}},845307:(e,t,a)=>{"use strict";a.d(t,{PeerProfile:()=>L});a(892222),a(57327),a(226699),a(66992),a(821249),a(319601),a(132023),a(333948);var n=a(785893),r=a(667294),s=a(501389),i=a(284863),o=a(483295),l=a(810890),c=a(659397),d=a(70162),u=a(931897),_=a(554846),g=a(897404),m=a(384032),p=a(472111),h=a(482354),f=a(154537),v=a(236996),b=a(105103),C=a(371351),T=a(294378);function E(){return E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},E.apply(this,arguments)}var I="peer_profile_modal";class L extends r.PureComponent{constructor(e){super(e),this.toggleProfile=()=>{this.setState({isCollapsed:!this.state.isCollapsed})},this.onPeerTagsChange=(e,t)=>{var a=this.props.store,n=a.get().peer;this.setState((a=>({peerTags:t?[].concat(a.peerTags,e):a.peerTags.filter((t=>t!==e))})),(()=>{a.set(m.peerProfileToggleTag.bind(null,e,t,t?"bind":"unbind",n)).catch(T.dummyCatch)}))},this.onSave=e=>{this.setState({tags:e},(()=>{this.props.store.set(m.peerProfileManageTags.bind(null,[...this.state.tags])).then((e=>{var t=e.get().peer_profile_tags;this.setState({isCollapsed:0===t.length,tags:t,isTagsModalOpened:!1}),(0,s.showDoneBox)((0,d.getLang)("mail_im_peer_profile_manage_tags_success"),{out:1e3})})).catch(T.dummyCatch)}))},this.onNoteSave=e=>{var t=this.props.store,a=t.get().peer;t.set(m.peerProfileSaveNote.bind(null,a,e)).then((()=>{this.setState({note:e,isNoteModalOpened:!1}),(0,s.showDoneBox)(e?(0,d.getLang)("mail_im_peer_profile_save_note_success"):(0,d.getLang)("mail_im_peer_profile_delete_note_success"),{out:1e3})})).catch(T.dummyCatch)},this.toggleModal=(e,t,a)=>{switch(e&&e.preventDefault(),a){case"tags":this.setState({isTagsModalOpened:t});break;case"note":this.setState({isNoteModalOpened:t})}t&&(0,l.cancelStackPush)(I,(()=>{(0,l.cancelStackFilter)(I),this.toggleModal(null,!1,a)}))};var t=e.store.get(),a=t.peer,n=(0,i.getTab)(t,a),r=n.peer_profile_info||{};this.state={isCollapsed:!0,tags:t.peer_profile_tags||[],peerTags:n.peer_tags?n.peer_tags.ids:[],note:r.note,isTagsModalOpened:!1,isNoteModalOpened:!1}}render(){var e=this.props.store.get(),t=(0,i.getTab)(e,e.peer),a=this.state,r=a.isCollapsed,s=a.tags,l=a.peerTags,m=a.note,T=a.isTagsModalOpened,I=a.isNoteModalOpened,L=s.length>0,y=L?s.reduce(((e,t)=>(e[t.id]=!0,e)),{}):[],A=l.filter((e=>y[e])),S=t.peer_profile_info,k=S&&(S.city||S.age),M=(0,o.classNames)("PeerProfile__wrapper",{"PeerProfile__wrapper--collapsed":r});return(0,n.jsxs)("div",{className:M,children:[(0,n.jsx)(_.Scroll,{className:"PeerProfile__scroll",neverHide:!0,children:(0,n.jsxs)("dl",{className:"PeerProfile__container",children:[(0,n.jsx)("dt",{className:"PeerProfile__label",children:(0,d.getLang)("mail_im_peer_profile_tags_label_text")}),(0,n.jsxs)("dd",{className:"PeerProfile__content PeerProfile__tags",children:[r&&!L&&!t.ad_id&&(0,n.jsx)(u.default,{className:"PeerProfile__manageTagsLink",onClick:e=>this.toggleModal(e,!0,"tags"),children:(0,d.getLang)("mail_im_peer_profile_manage_tags")}),(L||t.ad_id)&&(0,n.jsx)(p.PeerProfileTagsList,{tags:s,peerTags:A,isPeerProfileCollapsed:r,adId:t.ad_id,hasAdAccess:t.has_ad_access,isEasyPromotedMarket:t.is_easy_promoted_market,toggleProfile:this.toggleProfile}),!r&&(0,n.jsx)(h.PeerProfileTagsGrid,{tags:[...s].map((e=>E({},e,{isChecked:l.includes(e.id)}))),onPeerTagsChange:this.onPeerTagsChange}),!r&&(0,n.jsx)(u.default,{className:"PeerProfile__manageTagsLink",onClick:e=>this.toggleModal(e,!0,"tags"),children:(0,d.getLang)("mail_im_peer_profile_manage_tags")}),T&&(0,n.jsx)(f.PeerProfileTagsModal,{tags:s,onSave:this.onSave,onClose:e=>this.toggleModal(e,!1,"tags")})]}),(0,n.jsx)("dt",{className:"PeerProfile__label",children:(0,d.getLang)("mail_im_peer_profile_info_label_text")}),(0,n.jsxs)("dd",{className:"PeerProfile__content PeerProfile__info",children:[k&&(0,n.jsxs)(n.Fragment,{children:[S.city&&(0,n.jsx)("span",{className:"PeerProfile__infoItem",children:(0,c.decodeHTMLEntities)(S.city)}),S.age&&(0,n.jsx)("span",{className:"PeerProfile__infoItem",children:(0,c.decodeHTMLEntities)(S.age)}),S.likes_cnt&&(0,n.jsx)(g.default,{className:"PeerProfile__infoTooltip",position:"t",text:(0,d.getLang)("mail_peer_profile_likes_replies_tooltip"),appearance:"light",children:(0,n.jsxs)("span",{className:"PeerProfile__infoItem",children:[S.likes_cnt&&(0,n.jsx)("span",{className:"PeerProfile__infoItem",children:(0,c.decodeHTMLEntities)(S.likes_cnt)}),S.replies_cnt&&(0,n.jsx)("span",{className:"PeerProfile__infoItem",children:(0,c.decodeHTMLEntities)(S.replies_cnt)})]})})]}),!k&&(0,n.jsx)("span",{children:(0,d.getLang)("mail_im_peer_profile_info_empty")})]}),e.is_peer_profile_note_enabled&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("dt",{className:"PeerProfile__label",children:(0,d.getLang)("mail_im_peer_profile_note_label_text")}),(0,n.jsxs)("dd",{className:"PeerProfile__content PeerProfile__note",children:[!m&&(0,n.jsx)(u.default,{onClick:e=>this.toggleModal(e,!0,"note"),children:(0,d.getLang)("mail_im_peer_profile_note_add_link")}),!!m&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"PeerProfile__noteText",children:(0,c.decodeHTMLEntities)(m)}),(0,n.jsx)("span",{className:"PeerProfile__noteDivider",children:" · "}),(0,n.jsx)(u.default,{onClick:e=>this.toggleModal(e,!0,"note"),children:(0,d.getLang)("mail_im_peer_profile_note_edit_link")})]}),I&&(0,n.jsx)(v.PeerProfileNoteModal,{note:m,onNoteSave:this.onNoteSave,onClose:e=>this.toggleModal(e,!1,"note")})]})]}),(0,n.jsx)("dt",{className:"PeerProfile__label",children:(0,d.getLang)("mail_im_peer_profile_join_date_label_text")}),(0,n.jsx)("dd",{className:"PeerProfile__content",children:S&&S.join_date?(0,c.decodeHTMLEntities)(S.join_date):(0,d.langSex)(t.sex,(0,d.getLang)("mail_im_peer_profile_join_date_empty_text","raw"))})]})}),(L||t.ad_id)&&(0,n.jsx)("button",{className:"PeerProfile__toggler",onClick:this.toggleProfile,children:this.state.isCollapsed?(0,n.jsx)(b.default,{}):(0,n.jsx)(C.default,{})})]})}}},236996:(e,t,a)=>{"use strict";a.d(t,{PeerProfileNoteModal:()=>g});a(66992),a(573210),a(333948);var n=a(785893),r=a(667294),s=a(483295),i=a(659397),o=a(70162),l=a(359284),c=a(288420),d=a(781402),u=a(546847),_=a(118690);class g extends r.Component{constructor(e){var t;super(e),t=this,this.onChange=e=>{var t=e.target.value;this.setState({note:t})},this.onSubmit=function(e,a){void 0===a&&(a=!1),e&&e.preventDefault();var n=t.state.note&&t.state.note.trim();a||n?(t.setState({isLoading:!0}),t.props.onNoteSave(n)):t.setState({note:""})},this.toggleConfirmationModal=(e,t)=>{e&&e.preventDefault(),this.setState({isConfirmationModalOpen:t})},this.state={note:e.note||"",isLoading:!1,isConfirmationBoxOpen:!1,isConfirmationModalOpen:!1},this.inputRef=r.createRef()}componentDidMount(){this.inputRef.current.element.focus()}render(){var e=(0,s.classNames)("PeerProfileNoteModal",{"PeerProfileNoteModal--hidden":this.state.isConfirmationModalOpen}),t=[...this.props.note?[(0,n.jsx)(c.default,{appearance:"link",onClick:e=>this.toggleConfirmationModal(e,!0),className:"PeerProfileNoteModal__deleteButton",children:(0,o.getLang)("mail_im_peer_profile_note_delete_link")},"delete")]:[],(0,n.jsx)(c.default,{appearance:"tertiary",onClick:this.props.onClose,children:(0,o.getLang)("global_cancel")},"cancel"),(0,n.jsx)(_.default,{onClick:this.onSubmit,loading:this.state.isLoading,children:(0,o.getLang)("global_save")},"save")];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.default,{onClose:this.props.onClose,className:e,disableBackdropClick:!0,disableEscapeClose:!0,children:(0,n.jsxs)("form",{onSubmit:this.onSubmit,children:[(0,n.jsx)(d.default.Header,{title:(0,o.getLang)("mail_im_peer_profile_note_box_title"),onClose:this.props.onClose,appearance:"blue"}),(0,n.jsx)(d.default.Body,{children:(0,n.jsx)(u.default,{className:"PeerProfileNoteModal__input",value:(0,i.decodeHTMLEntities)(this.state.note),placeholder:(0,o.getLang)("mail_im_peer_profile_note_box_placeholder"),onChange:this.onChange,style:{height:21},maxLength:96,ref:this.inputRef})}),(0,n.jsx)(d.default.Footer,{actionButtons:t})]})}),this.state.isConfirmationModalOpen&&(0,n.jsx)(d.default,{title:(0,o.getLang)("global_warning"),appearance:"blue",actionButtons:[(0,n.jsx)(c.default,{appearance:"tertiary",onClick:e=>this.toggleConfirmationModal(e,!1),children:(0,o.getLang)("global_cancel")},"cancel"),(0,n.jsx)(c.default,{onClick:e=>{this.toggleConfirmationModal(e,!1),this.setState({note:""},(()=>this.onSubmit(null,!0)))},children:(0,o.getLang)("global_delete")},"delete")],onClose:e=>this.toggleConfirmationModal(e,!1),className:"PeerProfileConfirmationModal",children:(0,o.getLang)("mail_im_peer_profile_note_delete_confirmation_text")})]})}}},482354:(e,t,a)=>{"use strict";a.d(t,{PeerProfileTagsGrid:()=>i});a(66992),a(821249),a(333948);var n=a(785893),r=a(667294),s=a(342086);class i extends r.Component{constructor(){super(...arguments),this.onCheckboxChange=(e,t)=>{this.props.onPeerTagsChange(e,t)}}render(){var e=this.props.tags;return(0,n.jsx)("div",{className:"PeerProfileTagsGrid",children:e.map(((e,t)=>(0,n.jsx)(s.PeerProfileTagsGridItem,{data:e,onCheckboxChange:this.onCheckboxChange},t)))})}}},342086:(e,t,a)=>{"use strict";a.d(t,{PeerProfileTagsGridItem:()=>i});var n=a(785893),r=(a(667294),a(659397)),s=a(451865);function i(e){var t=e.data,a=e.onCheckboxChange,i=(0,r.decodeHTMLEntities)(t.name);return(0,n.jsx)("div",{className:"PeerProfileTagsGridItem",onClick:e=>{e&&e.preventDefault(),a(t.id,!t.isChecked)},children:(0,n.jsxs)(s.default,{className:"PeerProfileTagsGridItem__checkbox",checked:t.isChecked,onChange:(e,n)=>a(t.id,n),children:[(0,n.jsx)("span",{className:"PeerProfileTagsGridItem__color",style:{backgroundColor:t.color}}),(0,n.jsx)("span",{className:"PeerProfileTagsGridItem__name",title:i,children:i})]})})}},472111:(e,t,a)=>{"use strict";a.d(t,{PeerProfileTagsList:()=>l});a(57327),a(226699),a(821249),a(140561),a(132023);var n=a(785893),r=a(667294),s=a(70162),i=a(931897),o=a(208071);class l extends r.Component{constructor(e){super(e),this.onExtraClick=()=>{this.setState({isTagsCollapsed:!1})},this.state={isTagsCollapsed:!0}}render(){var e=this.props,t=e.peerTags,a=e.tags,r=e.isPeerProfileCollapsed,l=e.adId,c=e.hasAdAccess,d=e.isEasyPromotedMarket,u=e.toggleProfile,_=a.filter((e=>t.includes(e.id)));l&&_.unshift({adId:l,hasAdAccess:c,isEasyPromotedMarket:d});var g=0;r&&this.state.isTagsCollapsed&&_.length>5&&(g=_.splice(5).length);return _=_.map(((e,t)=>(0,n.jsx)(o.PeerProfileTagsListItem,{data:e},t))),(0,n.jsxs)("div",{className:"PeerProfileTagsList",children:[_.length>0&&_,g>0&&(0,n.jsx)("div",{className:"PeerProfileTagsListItem PeerProfileTagsListItem--extra",onClick:this.onExtraClick,children:`+ ${(0,s.getLang)("mail_im_peer_profile_extra_tags",g)}`}),!_.length&&(0,n.jsxs)("div",{className:"PeerProfileTagsListItem--empty",children:[(0,s.getLang)("mail_im_peer_profile_tags_empty")," ",(0,n.jsx)("span",{className:"PeerProfileTagsList__linkDivider",children:"·"})," ",(0,n.jsx)(i.default,{className:"PeerProfileTagsList__toggleProfileLink",onClick:u,children:r?(0,s.getLang)("mail_im_peer_profile_toggle_tags_on"):(0,s.getLang)("mail_im_peer_profile_toggle_tags_off")})]})]})}}},208071:(e,t,a)=>{"use strict";a.d(t,{PeerProfileTagsListItem:()=>l});a(66992),a(333948);var n=a(785893),r=a(667294),s=a(659397),i=a(146143),o=a(70162);class l extends r.Component{constructor(){super(...arguments),this.onAdTagAlertClick=()=>{(0,i.showFastBox)((0,o.getLang)("mail_ad_tag_no_access_box_title"),(0,o.getLang)("mail_ad_tag_no_access_box_text"))}}render(){var e=this.props.data;if(e.adId){var t=`ads?act=office&union_id=${e.adId}&utm_medium=community_messages_ad_tag&utm_source=dialog`,a="";a=e.isEasyPromotedMarket?(0,o.getLang)("mail_ad_tag_easy_promoted_market"):e.hasAdAccess?`${(0,o.getLang)("mail_ad_tag_text_prefix")} ${e.adId}`:(0,o.getLang)("mail_ad_tag_no_access_text");var r=(0,n.jsx)("span",{className:"PeerProfileTagsListItem__adTagText",children:a});return(0,n.jsxs)("div",{className:"PeerProfileTagsListItem PeerProfileTagsListItem--adTag",children:[e.hasAdAccess&&(0,n.jsx)("a",{className:"PeerProfileTagsListItem__adTagLink",href:t,target:"_blank",children:r}),!e.hasAdAccess&&(0,n.jsx)("button",{className:"PeerProfileTagsListItem__adTagAlert",onClick:this.onAdTagAlertClick,children:r})]})}return(0,n.jsx)("div",{className:"PeerProfileTagsListItem",style:{backgroundColor:e.color},children:(0,n.jsx)("span",{children:(0,s.decodeHTMLEntities)(e.name)})})}}},154537:(e,t,a)=>{"use strict";a.d(t,{PeerProfileTagsModal:()=>C});a(57327),a(66992),a(821249),a(319601),a(573210),a(333948);var n=a(785893),r=a(667294),s=a(483295),i=a(659397),o=a(608021),l=a(70162),c=a(359284),d=a(288420),u=a(118690),_=a(931897),g=a(781402),m=a(554846),p=a(42769);function h(){return h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},h.apply(this,arguments)}var f=["#4bb34b","#5c9ce6","#e64646","#792ec0","#63b9ba","#ffa000","#ffc107","#76787a","#9e8d6b","#45678f","#539b9c","#454647","#7a6c4f","#6bc76b","#5181b8","#ff5c5c","#a162de","#7ececf","#aaaeb3","#bbaa84"],v=f[0],b="deleted";class C extends r.Component{constructor(e){var t;super(e),t=this,this.generateEmptyTag=()=>({name:"",color:this.state&&this.state.tags.length?this.getAvailableColor():v,state:"new"}),this.getAvailableColor=()=>{var e=[...this.state.tags].reduce(((e,t)=>(t.state!==b&&(e[t.color]=!0),e)),{});return f.find((t=>!e[t]))},this.onAddLinkClick=e=>{e&&e.preventDefault(),this.state.tags.filter((e=>e.state!==b)).length>=20||this.setState((e=>({tags:[...e.tags,this.generateEmptyTag()]})),(()=>{this.inputsRef.current.scrollIntoView({block:"end"})}))},this.onNameChange=(e,t)=>{var a=e.target.value;this.setState({tags:this.state.tags.map(((e,n)=>n===t?h({},e,{name:a,state:e.state||"changed"}):e))})},this.onRemove=function(e,a){void 0===a&&(a=!1);var n=t.state.tags[e];!a&&n.id&&n.uses>0?t.setState({isConfirmationModalOpen:!0,indexToRemove:e}):t.setState({tags:t.state.tags.filter(((t,a)=>a!==e)),deletedTags:[...t.state.deletedTags,h({},n,{state:b})]})},this.onSubmit=e=>{e&&e.preventDefault();var t=[...this.state.tags,...this.state.deletedTags].reduce(((e,t)=>(t.name.trim()&&t.state&&e.push({id:t.id,name:t.name,color:t.color,state:t.state}),e)),[]);this.setState({isLoading:!0}),this.props.onSave(t)},this.toggleConfirmationModal=(e,t)=>{e&&e.preventDefault(),this.setState({isConfirmationModalOpen:t})},this.state={tags:e.tags.length?e.tags.map((e=>h({},e))):[this.generateEmptyTag()],deletedTags:[],isLoading:!1,isConfirmationModalOpen:!1,indexToRemove:null},this.inputsRef=r.createRef()}render(){var e=this.state,t=e.tags,a=e.isConfirmationModalOpen,r=t[e.indexToRemove],h=(0,s.classNames)("PeerProfileTagsModal",{"PeerProfileTagsModal--hidden":a});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.default,{onClose:this.props.onClose,className:h,disableBackdropClick:!0,disableEscapeClose:!0,children:(0,n.jsxs)("form",{onSubmit:this.onSubmit,children:[(0,n.jsx)(g.default.Header,{title:(0,l.getLang)("mail_im_peer_profile_manage_tags_box_title"),onClose:this.props.onClose,appearance:"blue"}),(0,n.jsx)(g.default.Body,{children:(0,n.jsx)(m.Scroll,{className:"PeerProfileTagsModal__scroll",neverHide:!0,children:(0,n.jsxs)("div",{className:"PeerProfileTagsModal__tagsInputs",ref:this.inputsRef,children:[this.state.tags.map(((e,t)=>(0,n.jsx)(p.PeerProfileTagsModalField,{index:t,data:e,onNameChange:this.onNameChange,onRemove:this.onRemove},t))),this.state.tags.length<20?(0,n.jsx)(_.default,{className:"PeerProfileTagsModal__addLink",onClick:this.onAddLinkClick,children:(0,l.getLang)("mail_im_peer_profile_manage_tags_add_link")}):""]})})}),(0,n.jsx)(g.default.Footer,{actionButtons:[(0,n.jsx)(d.default,{appearance:"tertiary",onClick:this.props.onClose,children:(0,l.getLang)("global_cancel")},"cancel"),(0,n.jsx)(u.default,{onClick:this.onSubmit,loading:this.state.isLoading,children:(0,l.getLang)("global_save")},"save")]})]})}),a&&(0,n.jsx)(g.default,{title:(0,l.getLang)("global_warning"),appearance:"blue",actionButtons:[(0,n.jsx)(d.default,{appearance:"tertiary",onClick:e=>this.toggleConfirmationModal(e,!1),children:(0,l.getLang)("global_cancel")},"cancel"),(0,n.jsx)(d.default,{onClick:e=>{this.toggleConfirmationModal(e,!1),this.onRemove(this.state.indexToRemove,!0)},children:(0,l.getLang)("global_delete")},"delete")],onClose:e=>this.toggleConfirmationModal(e,!1),className:"PeerProfileConfirmationModal",children:(0,o.langStr)(1===r.uses?(0,l.getLang)("mail_im_peer_profile_tag_delete_confirmation_text_single"):(0,l.getLang)("mail_im_peer_profile_tag_delete_confirmation_text",r.uses,!0),"tag_name",(0,i.decodeHTMLEntities)(r.name))})]})}}},42769:(e,t,a)=>{"use strict";a.d(t,{PeerProfileTagsModalField:()=>c});var n=a(785893),r=a(667294),s=a(70162),i=a(897404),o=a(659397),l=a(64107);class c extends r.Component{constructor(e){super(e),this.onKeyDown=e=>"Enter"!==e.key||(e.preventDefault(),!1),this.inputRef=r.createRef()}componentDidMount(){this.props.data.id||this.inputRef.current.focus()}render(){var e=this.props,t=e.index,a=e.data,r=e.onNameChange,c=e.onRemove;return(0,n.jsxs)("div",{className:"PeerProfileTagsModalField",children:[(0,n.jsx)("input",{type:"hidden",value:a.id?a.id:""}),(0,n.jsx)("input",{type:"text",className:"PeerProfileTagsModalField__input",value:(0,o.decodeHTMLEntities)(a.name),ref:this.inputRef,onChange:e=>r(e,t),onKeyDown:this.onKeyDown,maxLength:20,placeholder:(0,s.getLang)("mail_im_peer_profile_manage_tags_placeholder")}),(0,n.jsx)("span",{className:"PeerProfileTagsModalField__color",style:{backgroundColor:a.color}}),(0,n.jsx)(i.default,{position:"t",text:(0,s.getLang)("mail_im_peer_profile_manage_tags_remove"),children:(0,n.jsx)("span",{className:"PeerProfileTagsModalField__remove",onClick:()=>c(t),children:(0,n.jsx)(l.default,{})})})]})}}},653414:(e,t,a)=>{"use strict";a.d(t,{mount:()=>g});var n=a(146143),r=a(70162),s=a(873589),i=a(384032),o=a(661711),l=a(610124),c=a(645523),d=a(274642),u=a(124041);function _(e){return e.parentNode.getAttribute("data-receiver-chat-peer-id")}function g(e,t,a){var g=(0,l.createModule)({handlers:(l,g)=>{g(e,"click","_im_join_chat",(e=>function(e,t){var a=(0,s.domData)(t,"chat-id"),o=(0,s.domData)(t,"hash"),l=(0,s.domData)(t,"chat-link");return u.FlatButton.lock(t),(0,i.joinChat)(a,o,l,e.get()).then((a=>{var n=a[0];u.FlatButton.unlock(t);var r=e.get();r.longpoll.push([(0,c.changePeer)(n)]),r.onJoinChat&&r.onJoinChat(n)})).catch((e=>{(0,n.showFastBox)((0,r.getLang)("mail_join_invite_error_title"),e),u.FlatButton.unlock(t)}))}(t,e.target))),g(e,"click","_im_accept_mr",(e=>function(e,t){var a=_(t);return u.FlatButton.lock(t),e.set(i.acceptMessageRequest.bind(null,a)).then((()=>{u.FlatButton.unlock(t),e.get().longpoll.push([(0,c.changePeer)(a,!1,!1,!1,"chat_preview")])})).catch((e=>{(0,o.hideAllBoxes)(),(0,n.showFastBox)((0,r.getLang)("mail_join_invite_error_title"),e),u.FlatButton.unlock(t)}))}(t,e.target))),g(e,"click","_im_reject_mr",(e=>function(e,t,a){var s=_(a);return u.FlatButton.lock(a),e.set((e=>(0,i.rejectMessageRequest)(s,!1,e))).then((()=>{t.updateMenu(),t.updateList(),u.FlatButton.unlock(a),(0,o.hideAllBoxes)()})).catch((e=>{(0,o.hideAllBoxes)(),(0,n.showFastBox)((0,r.getLang)("mail_error"),e),u.FlatButton.unlock(a)}))}(t,a,e.target))),g(e,"click","_im_join_chat_donut",(e=>function(e,t){var a=(0,s.domData)(t,"chat-id"),l=(0,s.domData)(t,"hash"),u=(0,s.domData)(t,"chat-link"),_=(0,s.domData)(t,"owner-id");(0,o.hideAllBoxes)(),(0,d.showDonutSubscribePopup)(null,null,_,"chat_preview","",{type:"subscribe",params:{act:"subscribe_popup"},onSuccessPayment:()=>{(0,i.joinChat)(a,l,u,e.get()).then((t=>{var a,n=t[0],r=e.get();null==(a=r.longpoll)||a.push([(0,c.changePeer)(n)]),r.onJoinChat&&r.onJoinChat(n)})).catch((e=>{(0,n.showFastBox)((0,r.getLang)("mail_join_invite_error_title"),e)}))}})}(t,e.target)))}});return{unmount(){(0,l.destroyModule)(g)}}}},49241:(e,t,a)=>{"use strict";a.d(t,{isOutOfMessageEditingTime:()=>c,convertEmojiHtmlToRegularText:()=>d,findLastMessageToEdit:()=>u,wasMessageReallyModified:()=>_,replaceMsgAfterEdit:()=>g});a(57327),a(702707),a(115306);var n=a(284863),r=a(342269),s=a(43229),i=a(661711),o=a(826338),l=a(67328);function c(e,t){return Date.now()/1e3-t>e.pinMessageEditSettings.messageEditAllowedTime}function d(e){var t=document.createElement("div");return e=e.replace(/\[((id|club)\d+)\|(.+?)]/g,(function(){var e=arguments.length<=1?void 0:arguments[1],t=arguments.length<=3?void 0:arguments[3];return/^\@/.test(t)?t:`@${e} (${t})`})),t.innerHTML=e,Emoji.val(t)}function u(e,t){return+(t&&t.msgs?Object.keys(t.msgs):[]).filter((e=>e>0)).sort(((e,t)=>t-e)).find((a=>function(e,t){t=(0,n.parserMessage)(t);var a=(0,l.unpackStore)(e),r=vk.id==t.peerId&&!a.gid,o=a.pinMessageEditSettings,c=o.messageEditAllowedTime,d=o.pinEditDelayTime,u=o.isPinEditEnabled,_=Date.now()/1e3,g=(0,n.getPinnedMessage)(a),m=g&&g.messageId===t.messageId,p=t.kludges&&t.kludges.pinned_at,h=_-t.date>c,f=p&&_-p<d;if(333==t.peerId)return!1;if(!r&&!(0,s.isOut)(t))return!1;if((0,s.isServiceMsg)(t))return!1;if(m&&h&&u){if(f)return!1}else if(h)return!1;return!((0,s.isGift)(t)||(0,s.isSticker)(t)||(0,s.isAudioMsg)(t)||(0,s.isGraffiti)(t)||(0,s.isMoney)(t)||(0,s.isVKPay)(t)||(0,s.isCallMessage)(t)||(0,s.isCasperMessage)(t)||(0,i.isAlreadyDeleted)(e,t.peerId,t.messageId))}(e,t.msgs[a])))||null}function _(e,t,a){var n=(0,o.convertKludgesToAttaches)(t.kludges,t.messageId),r=a.dData.attaches;if(d(t.text)!==a.dData.txt||n.length!==r.length)return!0;for(var s=n.length;s--;){var i=n[s],l=r[s];if(i.id!=l.id||i.type!=l.type||"poll"==i.type&&l.object&&l.object.poll_is_edited)return!0}return!1}function g(e,t,a,n,s,o){t.origText=a,t.text=(0,i.replaceSpecialSymbols)((0,r.clean)(a)).replace(/\n/gi,"<br>"),t.attaches=n,t.kludges.emoji=1,t.local=1,t.share_url=s,t.cancelled_shares=o,t.update_time=Math.floor(Date.now()/1e3),e.get().tabs[t.peerId].msgs[t.messageId]=t}},519037:(e,t,a)=>{"use strict";a.d(t,{ImDraft:()=>o,loadDraftForPeer:()=>c});a(892222),a(821249),a(140561),a(241539),a(788674),a(292087),a(115306),a(323123);var n=a(887294),r=a(342269),s=a(663825),i=a(384032);function o(e,t){this._db=e,this._key=t,this.dData={txt:"",attaches:[],urlBinds:[],cancelled:[]},this.load()}function l(e){switch(e.type){case"mail":case"reply":return e.id<0&&1==e.object.fwd_count;default:return!e.object}}function c(e,t){return new o(e,"draft_"+t)}o.prototype.dump=function(){if(this._key){var e,t={txt:(e=this.dData).txt,attaches:e.attaches.length?e.attaches:void 0,urlBinds:e.urlBinds.length?e.urlBinds:void 0,cancelled:e.cancelled.length?e.cancelled:void 0},a=0===t.txt.length&&!t.attaches&&!t.urlBinds&&!t.cancelled;this._db.updateByKey(this._key,a?void 0:t)}},o.prototype.load=function(){if(this._key){var e=this._db.selectByKey(this._key);e&&(this.dData=function(e){return{txt:e.txt,attaches:e.attaches||[],urlBinds:e.urlBinds||[],cancelled:e.cancelled||[]}}(e))}},o.prototype.clear=function(){this.dData={txt:"",attaches:[],urlBinds:[],cancelled:[]},this.dump()},o.prototype.setText=function(e){this.dData.txt=(0,r.trim)(e),this.dump()},o.prototype.addAttach=function(e,t,a){if(("share"===e&&this.removeAttachByType(e),"mail"!==e&&"reply"!==e||(this.removeAttachByType("mail"),this.removeAttachByType("reply")),"audio_playlist"===e||"artist"===e)&&this.dData.attaches.find((t=>t.type===e)))return!1;if(!e||!t&&"poll"!==e)return!1;var n=this.dData.attaches.findIndex((a=>a.type===e&&a.id===t));-1===n?(this.dData.attaches.push({type:e,id:t,object:a}),this.dump()):"video"!==e&&"poll"!==e||(this.dData.attaches[n]={type:e,id:t,object:a},this.dump())},o.prototype.syncWithSelector=function(e){var t=this.getFwdRaw();this.dData.attaches=(t?[t]:[]).concat(e.getMedias().map((e=>{var t=e[0],a=e[1];return this.dData.attaches.find((e=>e.type==t&&e.id==a))||{type:t,id:a}}))),this.dump()},o.prototype.removeAttachByType=function(e){for(var t=this.dData.attaches.length;t--;)this.dData.attaches[t].type===e&&this.dData.attaches.splice(t,1);this.dump()},o.prototype.removeAllAttaches=function(){this.dData.attaches=[],this.dData.cancelled=[],this.dump()},o.prototype.addBindUrl=function(e,t,a){this.getBoundAttach(e)||(this.dData.urlBinds.push({url:e,type:t,id:a}),this.dump())},o.prototype.getBoundAttach=function(e){var t=this.dData.urlBinds.find((t=>t.url===e));return t&&this.dData.attaches.find((e=>e.type===t.type&&e.id===t.id))||null},o.prototype.getShareUrl=function(){var e=this.dData.attaches.find((e=>"share"===e.type));if(e&&e.object)return e.object.url.replace(/&amp;/g,"&")},o.prototype.hasOnlyReplies=function(e){return void 0===e&&(e=null),e?e.flags&s.FLAG_HAS_REPLY&&!this.dData.attaches.find((e=>"mail"!==e.type)):this.hasAttaches()&&!this.dData.attaches.find((e=>"reply"!==e.type))},o.prototype.getCancelledShares=function(){return this.dData.cancelled.length?this.dData.cancelled:void 0},o.prototype.hasAttaches=function(){return this.dData.attaches.length>0},o.prototype.destroy=function(){this.dData={},this._key=this._db=null},o.prototype.prepareObjects=function(e,t){return this.dData.attaches.find(l)?(0,n.post)(i.CONTROLLER,{act:"draft_medias",gid:e,messageId:t||0,media:t?void 0:this.dData.attaches.map((e=>[e.type,e.id])).join("*")}).then((e=>{var t=e[0];this.dData.attaches=t.map((e=>({type:e[0],id:e[1],object:e[2]})))})):Promise.resolve()},o.prototype.getFwdRaw=function(){return this.dData.attaches.find((e=>"mail"===e.type||"reply"===e.type))},o.prototype.getFwdCount=function(){var e=this.getFwdRaw();return e?e.id<0?e.object.fwd_count:e.id.split(";").length:0}},238283:(e,t,a)=>{"use strict";a.d(t,{oCacheExists:()=>n.oCacheExists,oCacheGet:()=>n.oCacheGet,oCacheAdd:()=>r.oCacheAdd});var n=a(606542),r=a(653004)},429639:(e,t,a)=>{"use strict";a.d(t,{getPeerProfileHeight:()=>d,mount:()=>_});var n=a(785893),r=(a(667294),a(873589)),s=a(973935),i=a(284863),o=a(661711),l=a(845307);function c(){return document.querySelector("#PeerProfile")}function d(){var e=c();return e?e.offsetHeight:0}function u(e,t){if(t){var a=parseInt((0,r.getStyle)(e,"padding-top"));e.style.paddingTop=a+d()+"px"}else e.style.removeProperty("padding-top")}function _(e){return{render(t){var a=t.get(),r=c(),d=a.peer,_=(0,i.getTab)(a,d);a.is_peer_profile_enabled&&r&&(0,o.isFullyLoadedTab)(a,d)&&!(0,i.isChannelPeer)(_)&&!(0,i.isCommunityChat)(t,d)&&(r.innerHTML&&s.unmountComponentAtNode(r),s.render((0,n.jsx)(l.PeerProfile,{store:t}),r,(()=>{u(e,!0)})))},destroy(){var t=c();t&&(s.unmountComponentAtNode(t),u(e,!1))}}}},538517:(e,t,a)=>{"use strict";a.d(t,{mount:()=>i});var n=a(610124),r=a(661711);function s(e){return{unmount(){(0,n.destroyModule)(e)}}}function i(e,t,a,i){var o=(0,n.createMutations)(s).bindMutations,l=t=>{a().messageKeyboardButtonClick(t),e.hide()};return o((0,n.createModule)({handlers:(t,a)=>{a(e.bodyNode,"click",r.MESSAGE_KEYBOARD_BUTTON_CLASS,l),a(e.bodyNode,"click",r.MESSAGE_ASR_COLLAPSE_TOGGLE_BUTTON,r.onASRCollapseToggleClick)}}))}},955647:(e,t,a)=>{"use strict";a.d(t,{isPinnedMessageVisibleInTab:()=>f,pinnedMessageHide:()=>v,pinnedMessageUnHide:()=>b,pinnedMessageUnpin:()=>C,mount:()=>y});var n=a(610124),r=a(70162),s=a(798262),i=a(873589),o=a(384032),l=a(538517),c=a(661711),d=a(284863),u=a(67328),_=a(879346),g=a(290846),m=a(459554),p=a(844142),h="_im_pin_hide";function f(e,t){if((0,u.unpackStore)(e).searchShown)return!1;var a=(0,d.getTab)(e,t);return!!(a&&p.Ranges.isChatOrChannelPeer(t)&&a.pinned)&&!(0,m.isPinnedMessageHidden)(a)}function v(e,t,a,n){void 0===n&&(n=!0);var r=(0,d.getTab)(e,t),o=r&&(0,d.parserMessage)(r.pinned);r&&o&&(r.pinHideId=o.chat_local_id,cur.imDb.update(_.PIN_HIDDEN_ID_OP,[r.peerId,r.pinHideId]),E(a,t,e),(0,i.re)((0,i.geByClass1)("_im_pinned_tt")),n&&window.Notifier&&Notifier.lcSend("pin_hide",{hide:1,peer:t}),(0,s.statlogsValueEvent)("im_pinned_messages","hide"))}function b(e,t,a,n){void 0===n&&(n=!0);var r=(0,d.getTab)(e,t);r&&r.pinHideId&&(delete r.pinHideId,cur.imDb.update(_.PIN_HIDDEN_ID_OP,[r.peerId,void 0]),E(a,t,e),n&&window.Notifier&&Notifier.lcSend("pin_hide",{hide:0,peer:t}),(0,s.statlogsValueEvent)("im_pinned_messages","show"))}function C(e,t,a){var n=E.bind(null,a,t),r=(0,c.showUnpinDialog)((()=>{r.hideProgress(),r.hide(),e.set(o.unpinMessageOptimistic.bind(null,t)).then(n).then((e=>e.set(o.unpinMessage.bind(null,t)))).then(n)}))}function T(e,t,a){var n=e.get().peer,r=(0,d.parserMessage)((0,d.getTab)(e,n).pinned);if(a.target.classList.contains(h))r&&v(e,n,t);else if("A"!==a.target.tagName){var i=r&&r.messageId;i&&!(0,c.isAlreadyDeleted)(e,n,i)?(0,c.focusOnMessage)(e,t().focusOnMessage,n,i):(0,c.showPinnedBox)(e,t,n,l.mount,a),(0,s.statlogsValueEvent)("im_pinned_messages","open")}}function E(e,t,a){return e().updateChatTopic(t,a),(0,o.setActions)(a.get()),e().updateActions(a),a}function I(e){(0,g.showTooltip)(e.target,{text:(0,r.getLang)("mail_hide_unpin_hover"),black:1,needLeft:1,shift:[8,4],forcetoup:!0,className:"_im_pinned_tt",appendEl:document.body})}function L(e){return{unmount(){(0,n.destroyModule)(e)}}}function y(e,t,a){var r=(0,n.createMutations)(L).bindMutations,s=T.bind(null,t,a),i=I.bind(null);return r((0,n.createModule)({handlers:(t,a)=>{a(e,"click","_im_pinned_message",s),a(e,"mouseover",h,i)}}))}},284863:(e,t,a)=>{"use strict";a.d(t,{isFullyLoadedTab:()=>u.isFullyLoadedTab,getTab:()=>u.getTabSafe,isTabMarkedUnread:()=>u.isTabMarkedUnread,isCommunityInterface:()=>_.isCommunityInterface,isReversedDialogs:()=>_.isReversedConvoOrder,isChannelPeer:()=>u.isChannelPeer,isChatActive:()=>u.isChatActive,isCasperChatTab:()=>u.isCasperChatTab,parserMessage:()=>m.parseMessage,isClassicInterface:()=>_.isClassicInterface,isSearching:()=>_.isSearchView,getLocalId:()=>g.getLocalId,getFirstUnread:()=>b,isSearchShown:()=>C,getCurrentKeyboard:()=>T,getKeyboard:()=>E,getSelectedMessages:()=>I,getMessageRangeFromSelection:()=>L,countUnread:()=>y,getLastMessage:()=>A,getAuthorFullName:()=>S,getMessage:()=>k,isLocksAvailable:()=>M,isFoldersAvailable:()=>R,getBareTab:()=>w,makeTabNotFullyLoaded:()=>N,isGoToEndVisible:()=>O,isGoToMentionVisible:()=>P,isGoToReactionAvailable:()=>x,getUnreadScrollBottom:()=>D,isSendingAvailable:()=>F,isCommunityBlocked:()=>H,checkVoiceMessageAvailable:()=>U,getSearchText:()=>B,isSearchingValue:()=>j,isRecentSearchesActive:()=>G,getPinnedMessage:()=>q,doPopularSuggExist:()=>V,isAnyMessageBeingEdited:()=>Y,getGroupId:()=>K,getTabDraft:()=>z,getTemplates:()=>$,tabIsMessageRequest:()=>W,tabIsRejectedMessageRequest:()=>Q,tabIsMessageRequestToChat:()=>Z,removeMessageRequestFolderFlags:()=>J,isMessageRequestFolder:()=>X,tabIsOutgoingMessageRequest:()=>ee,existsIncomingMessageRequest:()=>te,isMessageRequestChangedEvent:()=>ae,isBusinessNotifyChangedEvent:()=>ne,isCommunityChat:()=>re,isCasperChat:()=>se});a(57327),a(682772),a(821249),a(702707),a(426833);var n=a(43229),r=a(342269),s=a(663825),i=a(891326),o=a(238283),l=a(519037),c=a(67328),d=a(145072),u=a(459554),_=a(993421),g=a(376473),m=a(412827),p=a(179288),h=a(578843),f=a(506770),v=a(844142);function b(e,t){var a=(0,c.unpackStore)(e),s=a.tabs[a.peer];return Object.keys(s.msgs).filter((a=>{var i=k(e,t,a);return(0,f.partConfigEnabled)("me_web_read_by_cmid")?!(0,n.isOut)(i)&&(0,r.intval)(i.chat_local_id)>s.in_up_to_cmid:!(0,n.isOut)(i)&&(0,r.intval)(a)>s.in_up_to}))[0]}function C(e){return(0,c.unpackStore)(e).searchShown}function T(e){return E(e,(0,_.getPeer)(e))}function E(e,t){var a=((0,u.getTabSafe)(e,t)||{}).keyboard;if(!a||!a.buttons||a.buttons.length)return a}function I(e){return(0,c.unpackStore)(e).selectedMessages}function L(e,t,a){var s=(0,u.getTabSafe)(e,t),i=I(e)[0];if(void 0===i)return[a];var o=Math.min(a,i),l=Math.max(a,i);return Object.keys(s.msgs).filter((e=>e>=o&&e<=l)).filter((t=>{var a=k(e,e.get().peer,t);return!(0,n.isServiceMsg)(a)&&!(0,n.isCallMessage)(a)})).map(r.intval)}function y(e,t){var a=(0,c.unpackStore)(t),r=(0,u.getTabSafe)(a,e),s=0;for(var i in r.msgs)if(r.msgs.hasOwnProperty(i)){var o=k(t,e,i);(0,n.isOut)(o)||(s+=(0,n.isUnread)(r,o)?1:0)}return s}function A(e,t,a){var n=(0,u.getTabSafe)(e,t),r=k(e,t,a),i=Object.keys(e.msg_local_ids_sort||{}).length>1?Object.values(n.msgs).sort(((t,a)=>{var n=(0,m.parseMessage)(t).messageId,r=(0,m.parseMessage)(a).messageId;return(0,g.getLocalId)(e,n)-(0,g.getLocalId)(e,r)})):Object.values(n.msgs);if(!r)return(0,m.parseMessage)(i[i.length-1]);for(var o=r.local,l=i.length-1;l>=0;l--){var c=(0,m.parseMessage)(i[l]),d=c.local&&c.type!==s.EDIT_MESSAGE;if(!(!o&&d))if(o&&!d||(0,g.getLocalId)(e,r.messageId)>(0,g.getLocalId)(e,c.messageId))return c}}function S(e,t,a){var r=(0,u.getTabSafe)(e,t),s=k(e,t,a),i=(0,c.unpackStore)(e);return(0,n.isOut)(s)?(0,o.oCacheGet)(e,i.id).name:s.userId!==s.peerId?!!(0,o.oCacheExists)(e,s.userId)&&(0,o.oCacheGet)(e,s.userId).name:r.tab}function k(e,t,a){var n=(0,u.getTabSafe)(e,t),r=n&&n.msgs&&n.msgs[a];return r?(0,m.parseMessage)(r):null}function M(e){return(0,c.unpackStore)(e).gid}function R(e){return(0,c.unpackStore)(e).gid}function w(e,t){var a=(0,c.unpackStore)(t);return a.tabs[e]||a.mapped_index[e]}function N(e,t){var a=(0,u.getTabSafe)(e,t);a&&(a.msgs=void 0,a.msgid=void 0,a.scrollTop=void 0,a.scrollBottom=void 0,a.contHeight=void 0,a.offset=void 0,a.skipped=void 0)}function O(e){var t=e.get().go_to_end_visible;return!!t&&t[0]}function P(e){var t=e.get().go_to_mentions_visible;return!!t&&t[0]}function x(e){return e.get().go_to_reactions_available}function D(e){var t=e.get().go_to_end_visible;return t?t[1]:0}function F(e){return!(0,c.unpackStore)(e).lockedSending}function H(e,t){return!!v.Ranges.isGroupId(t)&&!!(0,u.getTabSafe)(e,t).blocked_community}function U(e){return(0,c.unpackStore)(e).voice_message_available}function B(e){return(0,c.unpackStore)(e).searchText}function j(e,t){var a=(0,c.unpackStore)(e);return!!(t&&t!==B(e)||a.recentSearch)}function G(e){return(0,c.unpackStore)(e).recentSearch}function q(e){var t=(0,u.getCurrentTab)(e);return t&&t.pinned&&(0,m.parseMessage)(t.pinned)}function V(e){var t=e.get().popular_sugg;return t&&t.length>0}function Y(e){return 1==(0,c.unpackStore)(e).isEditing}function K(e){return(0,c.unpackStore)(e).gid}function z(e){return e.draft||(e.draft=(0,l.loadDraftForPeer)(cur.imDb,e.peerId)),e.draft}function $(e){return((0,c.unpackStore)(e).templates||[]).filter((e=>!e.deleted))}function W(e){return!!e&&(0,u.tabIsMessageRequest)(e)}function Q(e){return Boolean(e.folders&i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST_REJECTED])}function Z(e){return v.Ranges.isChatOrChannelPeer(e.peerId)&&W(e)}function J(e){return e&~i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST]&~i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST_REJECTED]&~i.FOLDER_MASKS[p.FOLDER_NOT_IMPORTANT_MESSAGE_REQUEST]}function X(e){return(0,c.unpackStore)(e).active_tab===i.FOLDER_MESSAGE_REQUEST}function ee(e){return v.Ranges.isContactId(e.peerId)}function te(e){return!!(0,h.getConvoListFolderCounterTotal)(e,p.ConvoListFolder.MR)}function ae(e){var t=e.type,a=e.updateType;return t===s.CONVERSATION_UPDATED&&(a===s.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED||a===s.MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED)}function ne(e){var t=e.type,a=e.updateType;return t===s.CONVERSATION_UPDATED&&a===s.MAIL_CHAT_UPDATE_TYPE_BUSINESS_NOTIFY_DATA_CHANGED}function re(e,t){var a=(0,u.getTabSafe)(e,t);return!!a&&(0,u.isCommunityChat)(a)}function se(e,t){return(0,u.doesChatTabHaveFlag)((0,u.getTabSafe)(e,t),d.MAIL_CHAT_FLAG_IS_CASPER)}},891326:(e,t,a)=>{"use strict";a.d(t,{FOLDER_UNREAD:()=>n.FOLDER_UNREAD,FOLDER_ALL:()=>n.FOLDER_ALL,FOLDER_UNRESPOND:()=>n.FOLDER_UNRESPOND,FOLDER_IMPORTANT:()=>n.FOLDER_IMPORTANT,FOLDER_MESSAGE_REQUEST:()=>n.FOLDER_MESSAGE_REQUEST,FOLDER_MESSAGE_REQUEST_REJECTED:()=>n.FOLDER_MESSAGE_REQUEST_REJECTED,FOLDER_MARKED_UNREAD:()=>n.FOLDER_MARKED_UNREAD,FOLDER_MASKS:()=>n.FOLDER_MASKS,FOLDER_PEER_TAGS:()=>n.FOLDER_PEER_TAGS,FOLDER_BUSINESS_NOTIFY:()=>n.FOLDER_BUSINESS_NOTIFY,FOLDER_ARCHIVE:()=>n.FOLDER_ARCHIVE,ARROW_UP:()=>r,ARROW_DOWN:()=>s,PAGE_UP:()=>i,PAGE_DOWN:()=>o,END_KEY:()=>l,HOME:()=>c,ENTER:()=>d,UNPRINTABLE_KEYS:()=>u,UP_DOWN_CONTROLS:()=>_,PRINTABLE:()=>g,LINE_FEED:()=>m});var n=a(179288),r=38,s=40,i=33,o=34,l=35,c=36,d=13,u=[r,s,i,o,d,27,l,c],_=[i,o,s,r,c,l],g="printable",m=10},661711:(e,t,a)=>{"use strict";a.d(t,{getBareTab:()=>_.getBareTab,getTab:()=>_.getTab,isAnyMessageBeingEdited:()=>_.isAnyMessageBeingEdited,isClassicInterface:()=>_.isClassicInterface,isCommunityInterface:()=>_.isCommunityInterface,isFoldersAvailable:()=>_.isFoldersAvailable,isFullyLoadedTab:()=>_.isFullyLoadedTab,isLocksAvailable:()=>_.isLocksAvailable,isReversedDialogs:()=>_.isReversedDialogs,isTabMarkedUnread:()=>_.isTabMarkedUnread,parserMessage:()=>_.parserMessage,tabIsMessageRequest:()=>_.tabIsMessageRequest,tabIsOutgoingMessageRequest:()=>_.tabIsOutgoingMessageRequest,tabIsRejectedMessageRequest:()=>_.tabIsRejectedMessageRequest,isLastMsgDebugEnabled:()=>E.isLastMsgDebugEnabled,showDebugAlert:()=>I.showDebugAlert,normalizeTabsGotFromServer:()=>y.normalizeTabsGotFromServer,getUserInitials:()=>A.getUserInitials,prepareContactName:()=>A.prepareContactName,replaceSpecialSymbols:()=>S.replaceSpecialSymbols,SENDING_CLASS:()=>k.SENDING_CLASS,FAILED_CLASS:()=>k.FAILED_CLASS,secondsToHuman:()=>S.secondsToHuman,RESTORE_CLASS:()=>te,TYPING_CLASS:()=>ae,MESSAGE_KEYBOARD_BUTTON_CLASS:()=>ne,MESSAGE_STACK_CLASS:()=>re,BOT_CAROUSEL_CLASS:()=>se,JOIN_CALL_BY_LINK_CLASS:()=>ie,CREATE_CHAT_ACTION:()=>oe,CHAT_TITLE_ACTION:()=>le,CHAT_INVITE_USER:()=>ce,CHAT_KICK_USER:()=>de,CHAT_PHOTO_UPDATE:()=>ue,CHAT_PHOTO_REMOVE:()=>_e,CHAT_PIN_MESSAGE:()=>ge,CHAT_UNPIN_MESSAGE:()=>me,CHAT_INVITE_BY_LINK:()=>pe,CHAT_SCREENSHOT:()=>he,CHAT_GROUP_CALL_STARTED:()=>fe,CHAT_KICK_USER_CALL_BLOCK:()=>ve,CHAT_KICK_DON:()=>be,DESELECT_ALL_CLASS:()=>Ce,HIDE_TOP_NOTICE_CLASS:()=>Te,HIDE_ASIDE_NOTICE_CLASS:()=>Ee,HIDE_ASIDE_PROMO_BLOCK_CLASS:()=>Ie,INSTALL_VKADMIN_LINK:()=>Le,CLEAR_RECENT_CLASS:()=>ye,TOGGLE_MR_TAB:()=>Ae,TOGGLE_BUSINESS_NOTIFY_TAB:()=>Se,TOGGLE_ARCHIVES_TAB:()=>ke,TOGGLE_ALL_TAB:()=>Me,MESSAGE_SEARCH_CLASS:()=>Re,PINNED_CONTAINER_CLASS:()=>we,AUDIO_MSG_CLASS:()=>Ne,MESSAGE_ASR_COLLAPSE_TOGGLE_BUTTON:()=>Oe,getClassicChatHeight:()=>He,setClassicChatHeight:()=>Ue,applyInnerHtml:()=>Be,compensateHistoryHeightChange:()=>je,isAlreadyDeleted:()=>Ge,replaceMessageAttrs:()=>qe,isVoiceMessageAvailable:()=>Ve,getAvailableMicrophones:()=>Ye,dayFromVal:()=>Ke,formatPhoneNumber:()=>ze,updateMessageInCache:()=>$e,updateListenedMark:()=>We,updateMessageEditableStatus:()=>Qe,editAndReplaceMessage:()=>Ze,setCasperMessageExpiringStatusDOM:()=>Je,markMessagesAsRead:()=>Xe,replaceAttaches:()=>et,replaceCarousel:()=>tt,replaceMessageReactions:()=>at,MSG_NEW:()=>nt,MSG_DUPLICATE:()=>rt,MSG_LOCAL_DUPLICATE:()=>st,getMessageStoreStatus:()=>it,isPeerActive:()=>ot,isFvkcomgroup:()=>lt,isTabLoaded:()=>ct,isTabLoadedWithMessage:()=>dt,convertPeerToUrl:()=>ut,unUrlPeer:()=>_t,simplifyCounter:()=>gt,renderPhotosFromTab:()=>ft,renderBtnSearchOnlyMessages:()=>vt,renderMessagesSep:()=>bt,renderConversationsSep:()=>Ct,renderPopularSuggSep:()=>Tt,renderClearRecent:()=>Et,renderPopularSuggestions:()=>It,renderConvoRecommendList:()=>Lt,renderFindFriendsStub:()=>yt,convertLegacyOnlineToAPIFlags:()=>At,isViewWithRecommendations:()=>St,setMessageError:()=>kt,startResendMessage:()=>Mt,removeMessages:()=>Rt,removeExpiredMessagesStub:()=>wt,removeStartingFromMessage:()=>Nt,removeMessagesWithRestore:()=>Ot,restoreMessage:()=>Pt,formatTyper:()=>xt,loadSummaryActivityType:()=>Dt,renderEmptySearch:()=>Ht,addChatPhotoToUpdate:()=>Ut,isSelfMessage:()=>Bt,showVerifiedTooltip:()=>jt,wrapLoading:()=>Gt,tabFromIds:()=>qt,checkSelectClick:()=>Vt,renderGoTo:()=>Yt,showFlushChat:()=>Kt,showLeaveDialog:()=>zt,showUnpinDialog:()=>$t,showMsgDeleteDialog:()=>Wt,cleanHistory:()=>Qt,inviteUser:()=>Zt,toggleDialogsFolder:()=>Jt,showUnreadOnly:()=>Xt,changeTab:()=>ea,isImportant:()=>ta,isUnrespond:()=>aa,isPeerBlocked:()=>na,isPendingForward:()=>ra,isPeerBlockedByMe:()=>sa,blockLatencyCompensation:()=>ia,showSpamLayer:()=>oa,getLastSeenTextInHeader:()=>la,getLastSeenText:()=>ca,showBlacklistBoxUser:()=>ua,showBlacklistBox:()=>_a,getBaseLink:()=>ga,showFavvedBox:()=>ma,isEditableFocused:()=>pa,updateStar:()=>ha,isMessagesVisible:()=>fa,hideTopNotice:()=>va,hideAsideNotice:()=>ba,hideAsidePromoBlock:()=>Ca,installVKAdminApp:()=>Ta,renderShortText:()=>Ia,lockButton:()=>ya,unlockButton:()=>Aa,renderPinnedMessage:()=>Sa,showMessageInfoTooltip:()=>ka,showEditTimeTooltip:()=>Ma,showCasperExpiringTooltip:()=>Ra,getHistoryTopIndent:()=>wa,getPinnedMessageHeight:()=>Na,applyMessageHandlers:()=>Oa,showPinnedBox:()=>Pa,showRepliedBox:()=>xa,isUserAliveInChat:()=>Da,getAliveMembersCount:()=>Fa,splitMessageToParts:()=>Ha,isMessageTooLong:()=>Ua,showInvitationBox:()=>Ba,showWaitUntilUploadedBox:()=>ja,canMessageBeDeletedForAll:()=>Ga,getChatMembersByIds:()=>qa,formatTimespan:()=>Va,focusOnMessage:()=>Ya,getNowEditingMessage:()=>Ka,checkMessageRequestsTab:()=>za,hideAllBoxes:()=>$a,getMessageRequestDateText:()=>Wa,canPinMessage:()=>Qa,canForwardMessages:()=>Za,canMarkImportant:()=>Ja,removeExpiredMessageIfNeed:()=>Xa,isPeerCurrentUser:()=>en,isAppActionOptionAvailableForPeer:()=>tn,isGiftOptionAvailableForPeer:()=>an,isMoneyOptionAvailableForPeer:()=>nn,replaceExpiredMessageWithPlaceholder:()=>rn,replaceExpiredRepliedMessageWithPlaceholder:()=>ln,getChatMemberCount:()=>cn,CALL_ENTRY_POINT_SNIPPET:()=>dn,CALL_ENTRY_POINT_HEADER:()=>un,CALL_ENTRY_POINT_LIST:()=>_n,CALL_ENTRY_POINT_JOIN_SNIPPET:()=>gn,CALL_ENTRY_POINT_JOIN_HEADER:()=>mn,CALL_ENTRY_POINT_JOIN_BANNER:()=>pn,startCallFromIm:()=>hn,handleCallLinkClick:()=>fn,isCallToPeerAvailable:()=>vn,isCallToPeerFromSnippetAvailable:()=>bn,joinCallFromIm:()=>Cn,getConvoLocation:()=>Tn,showGroupCallsOnboardingBox:()=>En,showGroupCallsNewYearTooltip:()=>In,getRightMenuMaxItems:()=>Ln,showChatInvitationBox:()=>yn,setCallbackButtonLoadingState:()=>An,getCallbackButton:()=>Sn,onASRCollapseToggleClick:()=>kn});a(382526),a(141817),a(892222),a(57327),a(491038),a(226699),a(682772),a(66992),a(294986),a(821249),a(747042),a(702707),a(319601),a(241539),a(788674),a(339714),a(132023),a(804723),a(115306),a(323123),a(573210),a(454747),a(333948);var n=a(663825),r=a(840060),s=a(897449),i=a(501389),o=a(679740),l=a(631351),c=a(342269),d=a(891326),u=a(283303),_=a(284863),g=a(43229),m=a(640157),p=a(483295),h=a(290846),f=a(146143),v=a(152278),b=a(653414),C=a(363035),T=a(645523),E=a(993421),I=a(294378),L=a(179288),y=a(923876),A=a(222131),S=a(442347),k=a(163612),M=a(67328),R=a(238283),w=a(955647),N=a(384032),O=a(145072),P=a(777529),x=a(75560),D=a(592380),F=a(429639),H=a(873589),U=a(608021),B=a(459554),j=a(122779),G=a(68421),q=a(428549),V=a(69935),Y=a(506770),K=a(578843),z=a(419672),$=a(917791),W=a(376473),Q=a(35916),Z=a(844142),J=a(124041);function X(){return X=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},X.apply(this,arguments)}var ee="_im_mess_original",te="_im_mess_restore",ae="_im_typing",ne="_im_mess_btn",re="_im_mess_stack",se="_im_bot_carousel",ie="_im_join_call_by_link",oe="chat_create",le="chat_title_update",ce="chat_invite_user",de="chat_kick_user",ue="chat_photo_update",_e="chat_photo_remove",ge="chat_pin_message",me="chat_unpin_message",pe="chat_invite_user_by_link",he="chat_screenshot",fe="chat_group_call_started",ve="chat_kick_user_call_block",be="chat_kick_don",Ce="_im_deselect_all",Te="_im_top_notice_hide",Ee="_im_aside_notice_hide",Ie="_im_aside_promo_block_hide",Le="_im_vkadmin_promo_link",ye="_im_clear_recent",Ae="_im_toggle_mr_tab",Se="_im_toggle_business_notify_tab",ke="_im_toggle_archives_tab",Me="_im_toggle_all_tab",Re="_im_mess_search",we="_im_pinned",Ne="im_msg_audiomsg",Oe="_msg_asr_collapse_toggle",Pe="._im_mess_stack",xe=4096,De=100,Fe="chatPosition";function He(){return ls.get(Fe)||0}function Ue(e){e>=(0,H.clientHeight)()-30&&(e=0),ls.set(Fe,e)}function Be(e,t){e&&e.innerHTML!==t&&(e.innerHTML=t)}function je(e,t,a,n){var r=t&&!a?1:!t&&a?-1:0;r&&!(0,_.isClassicInterface)(e)&&n().compensateHistoryHeightChange(r)}function Ge(e,t,a){var n=e.get?e.get():e;if(ct(n,t)){var r=n.tabs[t].deleted||[];return(0,c.inArray)(a,r)}return!1}function qe(e,t,a){var n=a.randomId,r=(0,H.geByClass1)(`_im_mess_rid${n}`,t);return r&&(t=(0,z.removeMessagesWithStack)([r],t),t=(0,z.appendMessageToHistory)(e,a,t,!1)),t}function Ve(e){var t=(0,_.checkVoiceMessageAvailable)(e);return(0,_.isCommunityInterface)(e)||r.browser.mobile&&r.browser.safari?Promise.resolve(!1):void 0!==t?Promise.resolve(t):Ye().then((e=>e.length>0)).catch((e=>!1))}function Ye(){return window.AudioContext&&navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then((function(e){for(var t=[],a=0;a<e.length;a++)"audioinput"==e[a].kind&&t.push(e[a]);return t})):Promise.reject(new Error("NotSupported"))}function Ke(e){var t=e.split(".");return(t[0]<10?"0":"")+t[0]+(t[1]<10?"0":"")+t[1]+t[2]}function ze(e){var t=(""+e).replace(/\D/g,"").match(/^(\d+)(\d{3})(\d{3})(\d{2})(\d{2})$/);return t?`+${t[1]} (${t[2]}) ${t[3]}-${t[4]}-${t[5]}`:""}function $e(e,t,a){var n=(0,H.domData)(a,"msgid"),r=(0,H.geByClass1)(`_im_mess_${n}`,t),s=a.cloneNode(!0);return r&&(r.parentNode.replaceChild(s,r),(0,z.ensureDomHasActions)(t)),t}function We(e,t){var a=e.querySelector(`._im_mess_${t}`),n=null==a?void 0:a.querySelector(".im_msg_audiomsg");if(n)return n.classList.remove("im_msg_audiomsg--unlistened"),e}function Qe(e,t,a,n){if((0,Y.partConfigEnabled)("im_message_editable_sync")){var r=+n.dataset.msgid,s=(0,_.getMessage)(e,t,r),i=(0,W.canMessageBeEdited)(e,s),o=n.classList.contains("im-mess_editable");if(i!==o){var l=(0,H.geByClass1)(`_im_mess_${r}`),c=[n];l&&c.push(l),c.forEach((e=>{e.classList.toggle("im-mess_editable",i)})),$e(0,a,n)}}else{var d=+n.dataset.msgid,u=(0,_.getMessage)(e,t,d),g=(0,W.canMessageBeEdited)(e,u);g!==n.classList.contains("im-mess_editable")&&(n.classList.toggle("im-mess_editable",g),$e(0,a,n))}}function Ze(e,t,a){if(function(e){return e.kludges&&"app_action"===e.kludges.attach1_type}(t))return a;var n=(0,H.geByClass1)(`_im_mess_${t.messageId}`,a);if(n){var r=(0,H.se)((0,k.renderMessage)(e,t));n.classList.contains("im-mess_is_editing")&&r.classList.add("im-mess_is_editing"),n.parentNode.replaceChild(r,n),(0,z.ensureDomHasActions)(a)}return a}function Je(e,t,a){var n=(0,H.geByClass1)(`_im_mess_${a}`,e);if(n){var r=n.closest(Pe),s=r&&r.querySelector(".im-mess-stack--bomb");s&&s.classList.add(t?"im-mess-stack--bomb_expiring-soon":"im-mess-stack--bomb_expiring")}return e}function Xe(e,t,a){var n=e.tabs[t];return(0,M.toArray)((0,H.geByClass)("_im_mess_unread",a)).forEach((e=>{var t,a,r=!1;if((0,Y.partConfigEnabled)("me_web_read_by_cmid")){var s=(0,c.intval)((0,H.domData)(e,"cmid"));if(!s)return;r=n.out_up_to_cmid>=s}else{var i=(0,c.intval)((0,H.domData)(e,"msgid"));if(!i)return;r=n.out_up_to>=i}r&&((0,H.removeClass)(e,"_im_mess_unread"),(0,H.removeClass)(e,"im-mess_unread"),t=e,(a=(0,H.geByClass1)("_im_mess_blind_unread_marker",t))&&(a.removeAttribute("aria-label"),a.removeAttribute("role"),a.removeAttribute("tabindex")))})),a}function et(e,t,a){var n=t.peerId,r=t.messageId,s=(0,H.geByClass1)("_im_msg_reply"+r,e),i=(0,H.geByClass1)("_im_msg_media"+r,e),o=a.tabs[n].mediacontent[r][0];return s&&(s.innerHTML=o[0]),i&&(i.innerHTML=o[1]),(0,Q.initWidgets)(i),e}function tt(e,t,a){var n=t.messageId,r=e.querySelector("._im_bot_carousel_"+n);if(r){var s=function(e,t){var a=(0,_.getMessage)(e,t.peerId,t.messageId).kludges.template,n=!1;if(!a)return"";var r=a.elements.reduce(((e,a,r)=>{var s="",i="",o=(0,c.clean)(a.title),l=(0,c.clean)(a.description);if(a.photo&&(s+=(0,c.getTemplate)("sImBotCarouselSlidePhoto",{url:a.photo.sizes.find((e=>"q"===e.type)).url,alt:o||l||""}),n=!0),o&&(i+=(0,c.getTemplate)("sImBotCarouselSlideTitle",{content:o})),l&&(i+=(0,c.getTemplate)("sImBotCarouselSlideDescription",{content:l})),(a.title||a.description)&&(s+=(0,c.getTemplate)("sImBotCarouselSlideContent",{content:i})),a.action&&("open_link"===a.action.type&&(s=(0,c.getTemplate)("sImBotCarouselSlideLinkWrapper",{content:s,url:(0,V.wrapAwayIfExternal)(a.action.link,!0)})),"open_photo"===a.action.type&&(s=(0,c.getTemplate)("sImBotCarouselSlidePhotoLinkWrapper",{content:s,photo_id:`${a.photo.owner_id}_${a.photo.id}`,msg_id:t.messageId}))),a.buttons){var d=a.buttons.reduce(((e,t,a)=>{var n=Number(r+""+a);return e+(0,c.getTemplate)("sImBotCarouselSlideButton",{label:(0,x.getButtonLabel)(t),appearance:(0,x.getButtonAppearance)(t),modifier:t.action.type.replace("_","-"),attributes:(0,x.getAttributesFromActionObject)(t.action,n),tag_name:"open_link"===t.action.type?"a":"button"})}),"");s+=(0,c.getTemplate)("sImBotCarouselSlideButtons",{content:d})}return e+(0,c.getTemplate)("sImBotCarouselSlide",{content:s,index:r})}),"");return a.elements.length>1?(0,c.getTemplate)("sImBotCarousel",{content:(0,c.getTemplate)("sImCarousel",{content:r,controls_class:n?"BotCarousel__control--fourth":"BotCarousel__control",scroll_count:"1"}),msg_id:t.messageId}):(0,c.getTemplate)("sImBotCarousel",{content:r,msg_id:t.messageId})}(a,t);return(0,H.domReplaceEl)(r,s),e}}function at(e,t,a,n){var r=e.querySelector("._im_mess_"+a);if(r){var s=[...r.querySelectorAll("._im_mess_reactions")].pop();if(s){var i=Number(r.dataset.cmid);return s.innerHTML=(0,k.renderMessageReactions)(t,i,n),e}}}var nt=0,rt=1,st=2;function it(e,t){if(!(0,_.isFullyLoadedTab)(t,e.peerId))return nt;var a=t.tabs[e.peerId];return a.msgs[e.messageId]?rt:a.msgs["rid"+e.randomId]?st:nt}function ot(e,t){return e===t.peer}function lt(e,t){return(0,B.doesChatTabHaveFlag)((0,_.getTab)(e,t),1024)}function ct(e,t){return!!e.tabs[t]}function dt(e,t){return!!ct(e,t)&&null!==e.tabs[t].lastmsg}function ut(e){return Z.Ranges.isChatOrChannelPeer(e)?"c"+(e-2e9):Z.Ranges.isEmailId(e)?"e"+Math.abs(e+2e9):Z.Ranges.isContactId(e)?"mr"+(e-19e8):e}function _t(e){switch(e.slice(0,1)){case"e":return-2e9-(0,c.intval)(e.slice(1));case"c":return 2e9+(0,c.intval)(e.slice(1));default:return(0,c.intval)(e)}}function gt(e){return e>9999999?Math.floor(e/1e6)+"M":e>9999?Math.floor(e/1e3)+"K":e>0?e.toString():""}function mt(e,t){var a=`<img src="${e}" alt="" class="dialogs_inline_chatter dialogs_inline_chatter_half"/>`;return t&&(a=(0,c.getTemplate)("im_dialogs_link",{href:t,photo:a})),`<div class="im_grid">\n    <div class="dialogs_inline_chatter dialogs_inline_chatter_half">\n      ${a}\n    </div>\n  </div>`}function pt(e,t){var a=`<img src="${e}" alt="" class="dialogs_inline_chatter"/>`;return t&&(a=(0,c.getTemplate)("im_dialogs_link",{href:t,photo:a})),`<div class="im_grid">\n    <div class="dialogs_inline_chatter">\n      ${a}\n    </div>\n  </div>`}function ht(e,t){if(void 0===t&&(t=[]),"string"==typeof e)return(0,c.getTemplate)("sImDialogImRowPhoto",{photo:`<img src="${e}" alt=""/>`});switch(e.length){case 1:return(0,c.getTemplate)("sImDialogImRowPhoto",{photo:`<img src="${e[0]}" alt=""/>`});case 2:return e.map(((e,a)=>mt(e,t[a]))).join("");case 3:return mt(e[0],t[0])+e.slice(1).map(((e,a)=>pt(e,t[a+1]))).join("");case 4:return e.map(((e,a)=>pt(e,t[a]))).join("")}}function ft(e,t,a){return(0,y.isDialogWithYourself)(e.get().id,t.peerId)?(0,c.getTemplate)("sImDialogImRowPhoto",{photo:`<img src="${L.FAVORITES_ICON_URL}" alt="">`}):"string"==typeof t.photo&&t.photo?(0,c.getTemplate)("sImDialogImRowPhoto",{photo:`<img src="${t.photo}" alt="">${t.photo_icon||""}`}):Z.Ranges.isChatOrChannelPeer(t.peerId)&&t.membersCount<2?(0,c.getTemplate)("sImDialogImRowPhoto",{photo:`<img src="${e.get().default_chat_photo}" alt="">`}):Array.isArray(t.photo)?ht(t.photo):Z.Ranges.isContactId(t.peerId)?(0,c.getTemplate)("sImContactAvatar",{name:(0,A.getUserInitials)(t.tab),size:30,classes:"nim-peer--contact-avatar"}):ht(...(0,y.getDataForChatMemberGrid)(e,t,a))}function vt(e){var t=e.get().gid?(0,U.getLang)("mail_search_only_messages_comm"):(0,U.getLang)("mail_search_only_messages");return`<li class="im-page--mess-search-w">\n    <div class="im-page--mess-search ${Re}">\n      <button type="button" class="im-i--messages-search"></button>${t}\n    </div>\n  </li>`}function bt(){return`<li class="im-search-results-head">${(0,U.getLang)("mail_search_messages")}</li>`}function Ct(){return`<li class="im-search-results-head">${(0,U.getLang)("mail_search_conversations_sep")}</li>`}function Tt(){return`<li class="im-search-results-head">${(0,U.getLang)("mail_search_dialogs_sep")}</li>`}function Et(){return`<li class="im-search-results-head _im_recent_bar">\n    ${(0,U.getLang)("mail_recent_searches")}\n    <button type="button" class="${ye} im-page--clear-recent">${(0,U.getLang)("mail_clear_recent")}</button>\n  </li>`}function It(e){var t=e.get().popular_sugg,a=(0,_.isClassicInterface)(e)?7:4;return t.length>a&&(t=t.slice(0,a)),'<li class="im-popular clear_fix">'+t.map((t=>{var a,n,r=t.peerId,s=!(0,y.isDialogWithYourself)(e.get().id,r)&&(0,R.oCacheGet)(e,r)||t,i=e.get().tabs[r]||t,o=(e.get().mutedPeers||[]).indexOf(r)>=0,l=["im-popular--item","fl_l","_im_dialog","_dont_add_recent","_im_sugg_"+r,i.unread>0&&"sugg-is_unread",o&&"sugg-is_muted"].filter((e=>!!e)).join(" "),d=i.is_nft_photo?(a=s.photo,n=44,(0,c.getTemplate)("sImDialogImRowAvatarRichSkinPhoto",{photo:a,size:n})):`<img class="im-popular--avatar" src="${s.photo}"/>`;return`<div class="${l}" data-peer="${r}">\n    <a class="im-popular--avatar-w ${(0,M.onlinePlatformClass)(i.online)}" href="${s.link}">${d}</a>\n    <div class="im-popular--name-w"><a class="im-popular--name" href="${s.link}">${s.first_name||s.name}</a></div>\n    <span class="im-popular--unread _sugg_unread_ct">${gt(i.unread)}</span>\n</div>`})).join("")+"</li>"}function Lt(e){if((0,E.getLocalSettingsValue)(e,"messages_recommendation_list_hidden"))return"<div></div>";var t=(0,B.getRecommendedConvoList)(e),a=t?t.items.map(((e,a)=>function(e,t){var a=Z.Ranges.isContactId(e.peer_id),n=a?`/im?sel=${e.peer_id}`:`/${e.screen_name}`,r=!a&&e.online&&e.online_info?"online"+(e.online_info.is_mobile?" mobile":""):"",s="";switch(!0){case a&&!e.photo:s=(0,c.getTemplate)("sImContactAvatar",{name:(0,A.getUserInitials)(e.name),size:46,classes:""});break;case e.is_nft_photo:var i={online:(0,c.getTemplate)("sImDrawNftOnline"),"online mobile":(0,c.getTemplate)("sImDrawNftOnlineMobile")};s=(0,c.getTemplate)("sImUserNftAvatar",{online:i[r]||"",src:e.photo});break;default:s=(0,c.getTemplate)("sImUserAvatar",{src:e.photo,online_class:r,classes:""})}return(0,c.getTemplate)("sImConvoRecommendListUser",{name:e.name,id:e.peer_id,link:n,photo:s,position:t,track_code:e.track_code,remove_label:(0,U.getLang)("mail_recommend_block_remove_item")})}(t.item_data[e],a))):[],n=[(0,c.getTemplate)("sImConvoRecommendListButton",{icon:(0,j.getIcon24UserOutline)().icon,title:(0,U.getLang)("mail_recommend_block_action_find_friends"),tag_name:"a",attributes:'href="/friends?act=find" target="_blank"'}),(0,c.getTemplate)("sImConvoRecommendListButton",{icon:(0,G.getIcon24SmartphoneOutline)().icon,title:(0,U.getLang)("mail_recommend_block_action_invite"),tag_name:"button",attributes:'data-action="invite_by_phone_number"',classes:"_convoRecommendAction"})],r=a.length?(0,c.getTemplate)("sImCarousel",{content:a.join("")+n.join(""),controls_class:"ConvoRecommendList__control",scroll_count:"4"}):n.join("");return(0,c.getTemplate)("sImConvoRecommendList",{list_content:r})}function yt(e){return(0,M.unpackStore)(e).findFriendsStub||""}function At(e){var t=Boolean(e&&mobPlatforms[e]);return{is_online:Boolean(e&&!t),is_mobile:t}}function St(e){var t=(0,M.unpackStore)(e);return t.active_tab===L.FOLDER_ALL&&!(0,_.isCommunityInterface)(e)&&t.isRecommendationListEnabled}function kt(e,t,a){var n=(0,H.geByClass1)("_im_mess_"+t.messageId,a);if(n){(0,H.attr)(n,"aria-hidden","false"),(0,H.addClass)(n,`im-mess_failed ${k.FAILED_CLASS}`);var r=(0,H.geByClass1)("_im_mess_marker",n);(0,H.attr)(r,"aria-label",(0,U.getLang)("mail_send_message_error")),(0,H.attr)(r,"role","link")}return a}function Mt(e,t,a){var n=(0,H.geByClass1)("_im_mess_"+t,a);if(n){(0,H.removeClass)(n,"im-mess_failed"),(0,H.attr)(n,"aria-hidden","true"),(0,H.removeClass)(n,k.FAILED_CLASS);var r=(0,H.geByClass1)("_im_mess_marker",n);(0,H.attr)(r,"aria-label",""),(0,H.attr)(r,"role","")}return a}function Rt(e,t){var a=e.map((e=>(0,H.geByClass1)("_im_mess_"+e,t))).filter((e=>e));return(0,z.removeMessagesWithStack)(a,t)}function wt(e,t){var a=t||document,n=[];return e.forEach((e=>{var t=a.querySelector(`._im_expired_message_${e}`);if(t){var r=+t.dataset.count;if(t.dataset.count=r-1,t.classList.remove(`_im_expired_message_${e}`),1===r)(!(0,H.domNS)(t)||(0,H.hasClass)((0,H.domNS)(t),"_im_bar_date"))&&((0,H.hasClass)((0,H.domPS)(t),"_im_bar_date")&&(0,H.re)((0,H.domPS)(t)),(0,H.hasClass)((0,H.domPS)(t),"_im_unread_bar_row")&&(0,H.re)((0,H.domPS)(t))),(0,H.re)(t);else n.includes(t)||n.push(t)}})),n.length&&n.forEach((e=>{var t=+e.dataset.count;if(t>0){var a=sn(t),n=(0,H.se)(a);n.classList.add(...e.classList),e.replaceWith(n)}})),t}function Nt(e){for(var t=e;t;){var a=t;if(null===(t=t.previousElementSibling)){(0,H.hasClass)(a,"mess_srv")&&(t=a.parentNode);var n=(0,H.gpeByClass)("_im_mess_stack",a);n&&(t=n.previousElementSibling,1===(0,H.domChildren)(a.parentNode).length&&n.parentNode.removeChild(n))}(0,H.hasClass)(a,"_im_unread_bar_row")||a.parentNode.removeChild(a)}}function Ot(e,t,a,n){return e.map((e=>(0,H.geByClass1)("_im_mess_"+e,n))).filter((e=>e)).forEach((e=>{(0,H.val)(e,function(e,t,a){var n=t.innerHTML;return`<div class="im-mess--text">\n    ${"delete"===a?(0,U.getLang)("mail_deleted_stop"):(0,U.getLang)("mail_marked_as_spam")} <button type="button" data-peer="${e}" class="${te} im-mess--btn">${(0,U.getLang)("mail_restore")}</button>\n    <div class="_im_mess_original im-mess--original">${n}</div>\n  </div>`}(t,e,a)),(0,H.addClass)(e,"im-mess_light")})),n}function Pt(e,t,a){var n=(0,H.geByClass1)("_im_mess_"+e,a);if(n){var r=(0,H.geByClass1)(ee,n);(0,H.val)(n,r.innerHTML),(0,H.removeClass)(n,"im-mess_light")}return a}function xt(e,t,a,n,r,s){if(void 0===e&&(e={}),void 0===r&&(r=2),void 0===s&&(s=!1),s)return Ft(e,t,a,n,!0,r);var i=Ft(e,t,a,n,!1,r);return i.length>60?Ft(e,t,a,n,!0,r):i}function Dt(e){var t={[N.ACTIVITY_TYPE_TYPING]:1,[N.ACTIVITY_TYPE_RECORDING_AUDIO]:2},a=Object.keys(e).sort(((e,a)=>t[a]-t[e])),n={},r=a.reduce(((t,a)=>{var r=(e[a]||{}).userIds;return(void 0===r?[]:r).forEach((e=>{n[e]||(n[e]=!0,t[a]=!0)})),t}),{}),s=a.filter((e=>!!r[e]));return s.length>1?"":s[0]}function Ft(e,t,a,n,r,s){var i=function(e,t,a){var n=[],r={};return Object.keys(t).map((a=>{((t[a]||{}).userIds||[]).forEach((t=>{(0,R.oCacheExists)(e,t)?parseInt(t,10)!==e.id&&(r[t]=a):n.push(t)}))})),n.length&&(0,N.loadChatMember)({[a]:n},e),Object.keys(r).sort(((e,a)=>t[r[e]].ts-t[r[a]].ts))}(n,e,t);if(0===i.length)return"";var o=Z.Ranges.isUserIdTransitional(t)||Z.Ranges.isGroupId(t)?"first_name":r?"short_name":"name",l=Dt(e),c="";l===N.ACTIVITY_TYPE_RECORDING_AUDIO?c=(0,U.getLang)("mail_recording_audio_several",i.length):l===N.ACTIVITY_TYPE_TYPING&&(c=(0,U.getLang)("mail_typing_several",i.length));var d=i.slice(0,Math.min(i.length-1,s)),u=d.map((e=>(0,R.oCacheGet)(n,e)[o])).join(", ");if(i.length>s+1){var _=function(e){var t={};return Object.keys(e).forEach((a=>{var n=e[a].userIds;(void 0===n?[]:n).forEach((e=>{t[e]=1}))})),Object.keys(t).length}(e);u+=" "+(0,U.getLang)("mail_and_peer").replace("{count}",_-s).replace("{typing}",c)}else{if(i.length>1&&(u+=` ${(0,U.getLang)("mail_and_peer_one")}`),!Z.Ranges.isChatOrChannelPeer(t)&&a)u+=` ${c}`;else u+=` ${(0,R.oCacheGet)(n,i[d.length])[o]} ${c}`}return u.trim()}function Ht(){return`<div class="im-page--chat-search-empty">\n    ${(0,q.getIcon56MessagesOutline)().icon}\n    ${(0,U.getLang)("mail_im_search_empty")}\n  </div>`}function Ut(e,t,a,n){if(t===ue){var r=(0,H.geByClass1)("_im_mess_"+e.messageId,n);if(r){var s=a.tabs[e.peerId];r.parentNode.innerHTML=(0,c.getTemplate)("im_msg_row",{msg_id:e.messageId,cmid:e.chat_local_id,from_id:e.peerId,text:(0,k.renderServiceMsg)(a,e,s.peerId)+a.chat_photo_msg,ts:e.date,cls:"im-mess_srv _im_mess_srv",reactions:""})}}return n}function Bt(e,t){return!t&&e===vk.id}function jt(e,t){return(0,h.showTooltip)(e,{url:Z.Ranges.isGroupId(t)?"al_groups.php":"al_profile.php",params:{act:"verified_tt",mid:t,gid:t},slide:15,ajxdt:200,showdt:200,hidedt:200,dir:"auto",shift:[94,7,7],className:"verified_tt"})}function Gt(e){return function(t,a,n){void 0===a&&(a="bottom"),void 0===n&&(n="");var r=(0,H.se)((0,c.getTemplate)("im_preloader",{preloader:(0,H.rs)(vk.pr_tpl,{id:""}),cls:["bottom"===a?"im-preloader_bottom":"im-preloader_top",n].join(" ")})),s=!1;function i(){s=!0,(0,H.removeClass)(r,"im-preloader_visible"),r.parentNode&&r.parentNode.removeChild(r),e&&e.classList.remove("_is-loading-list")}e.classList.add("_is-loading-list"),setTimeout((()=>{s||("bottom"===a?e.appendChild(r):e.insertBefore(r,(0,H.domFC)(e)),(0,H.addClass)(r,"im-preloader_visible"))}),0),t.then(i).catch((e=>{console.error(e),i()}))}}function qt(e,t){return{0:{msgs:e.reduce(((e,t)=>(e[t]=[t,n.FLAG_IMPORTANT,0,0,"",{},{},0,0,0],e)),{}),hash:t,history:1}}}function Vt(e,t){if(!t&&!e)return!1;var a=e.target||e.srcElement,n=8,r=!1,s=/_im_mess|im_log_act|im_log_ract|_im_log_body|im_log_rspacer|_im_graffiti_w|_wall_post_cont/;do{if(!a||a.onclick||a.onmousedown||"A"==a.tagName||(0,H.hasClass)(a,"_im_no_select")||(0,H.hasClass)(a,"im_msg_media_link")||"IMG"==a.tagName&&!(0,H.hasClass)(a,"_im_graffiti")&&!(0,H.hasClass)(a,"emoji")&&!(0,H.hasClass)(a,"emoji_css")&&!(0,H.hasClass)(a,"im_gift")||"TEXTAREA"==a.tagName||(0,H.hasClass)(a,"im-gift--button")||(0,H.hasClass)(a,"GiftSnippetContent__button")||(0,H.hasClass)(a,"play_new")||(0,H.hasClass)(a,"videoplayer")||(r=s.test(a.className)))break}while(n--&&(a=a.parentNode));return!r||!!(0,c.trim)((window.getSelection&&window.getSelection()||document.getSelection&&document.getSelection()||"").toString())}function Yt(e,t){return`<div class="im-mess--text">\n      <span>${(0,U.getLang)("mail_restored")}</span>\n      <a class="_im_go_to" href="/im?sel=${ut(e)}&msgid=${t}">${(0,U.getLang)("mail_im_goto_conversation")}</a>\n    </div>`}function Kt(e,t,a){var n=(0,U.getLang)("mail_deleteall1"),r=(0,U.getLang)("mail_sure_to_delete_all"),s=(0,U.getLang)("mail_delete");return Z.Ranges.isChatOrChannelPeer(t)&&((0,B.doesChatTabHaveFlag)(e,1024)?(n=(0,U.getLang)("mail_leave_channel"),r=(0,U.getLang)("mail_unfollow_channel_confirmation"),s=(0,U.getLang)("mail_unfollow_channel")):r=(0,U.getLang)("mail_chat_sure_to_delete_all")),Z.Ranges.isGroupId(t)&&(r=(0,U.getLang)("mail_group_sure_to_delete_all")),(0,f.showFastBox)(n,r,s,a,(0,U.getLang)("global_cancel"))}function zt(e,t,a){var n=(0,_.getTab)(e,t),r=Z.Ranges.isChatOrChannelPeer(t),i=r&&Z.Ranges.isChatOrChannelPeer(n),o=r&&(0,_.tabIsMessageRequestToChat)(n),l=(0,U.getLang)("mail_deleteall1"),c=(0,U.getLang)("mail_sure_to_delete_all"),d=(0,U.getLang)("mail_delete");if(r){if(!(0,_.isChatActive)(n))return Kt(n,t,a.bind(null,!0));i?(l=(0,U.getLang)("mail_leave_channel"),c=(0,U.getLang)("mail_vkcomgroup_leave_confirm"),d=(0,U.getLang)("mail_leave_channel")):o?(l=(0,U.getLang)("mail_reject_mr_confirmation_title"),c=(0,U.getLang)("mail_reject_mr_confirmation_text"),d=(0,U.getLang)("mail_message_request_reject")):(l=(0,U.getLang)("mail_leave_chat"),c=(0,U.getLang)("mail_chat_leave_confirm"),d=(0,U.getLang)("mail_leave_chat"))}Z.Ranges.isGroupId(t)&&(c=(0,U.getLang)("mail_group_sure_to_delete_all"));var u=new f.MessageBox({title:l,width:i?450:500}).content(c).setButtons(d,(()=>a(!!(0,s.isChecked)((0,H.geByClass1)("_check_is_delete"))||!r)),(0,U.getLang)("global_cancel")).show();return!r||i||o||u.setControlsText(`<div class="checkbox im-delete-forall-checkbox _check_is_delete" onclick="checkbox(this);" role="checkbox" aria-checked="false">${(0,U.getLang)("mail_deleteall1")}</div>`),u}function $t(e){return(0,f.showFastBox)((0,U.getLang)("mail_unpin_title"),(0,U.getLang)("mail_unpin_text"),(0,U.getLang)("mail_unpin"),e,(0,U.getLang)("global_cancel"))}function Wt(e,t,a,n){var r=(0,U.getLang)("mail_dialog_msg_delete_N",t),i=(0,f.showFastBox)((0,U.getLang)("mail_dialog_msg_delete_title"),r,(0,U.getLang)("mail_delete"),(()=>n((0,s.isChecked)((0,H.geByClass1)("_check_forall")))),(0,U.getLang)("global_cancel")),o="",l=!1;return a&&(o=`<div class="checkbox im-delete-forall-checkbox _check_forall" onclick="checkbox(this);" role="checkbox" aria-checked="false">${(0,U.getLang)("mail_delete_for_all")}</div>`,l=cur.imDb.selectByKey("del_forall_checked")),i.setControlsText(o),l&&(0,s.checkbox)((0,H.geByClass1)("_check_forall")),i}function Qt(e,t,a,n,r){t.showProgress(),e.set(n.bind(null,r)).then((()=>{var n;t.hideProgress(),t.hide(),a().removePeer(e,r),a().updateDialogFilters(e);var s=e.get();[d.FOLDER_BUSINESS_NOTIFY,d.FOLDER_ARCHIVE].includes(s.active_tab)&&!(null==(n=s.dialog_tabs[s.active_tab])?void 0:n.length)&&s.longpoll.push([(0,T.changeTab)(d.FOLDER_ALL)])}))}function Zt(e,t,a,n){var r=e.get().tabs[t].memberIds;e.set(n.bind(null,"add_member",r)).then(a().showCreation)}function Jt(e,t,a,n){var r=e.get();if(![d.FOLDER_BUSINESS_NOTIFY,d.FOLDER_ARCHIVE].includes(n)&&r.active_tab===d.FOLDER_ALL&&0===(0,K.getConvoListFolderCounterTotal)(r,n))return!1;var s=r.active_tab===n?d.FOLDER_ALL:n;return e.set((e=>a(s,e))).then(t)}function Xt(e,t,a){if(e.get().active_tab===d.FOLDER_ALL&&0===(0,E.getUnreadCountWithMuted)(e))return Promise.resolve(!1);var n=e.get().active_tab===d.FOLDER_UNREAD?d.FOLDER_ALL:d.FOLDER_UNREAD;return e.set(a.bind(null,n)).then((e=>{t().restoreDialogs(e,!0)})).then((()=>!0))}function ea(e,t,a,n){if(t.get().active_tab===e&&e!==d.FOLDER_PEER_TAGS)return Promise.resolve(t);var r=(0,_.isReversedDialogs)(t);return t.set(n.bind(null,e)).then((e=>(a().restoreDialogs(e,!0,r!==(0,_.isReversedDialogs)(e)),e)))}function ta(e,t){void 0===t&&(t=e.get().peer);var a=e.get().tabs[t];return d.FOLDER_MASKS[d.FOLDER_IMPORTANT]&a.folders}function aa(e,t,a){if(void 0===a&&(a=!1),void 0===t&&(t=e.get().peer),!(0,_.isFoldersAvailable)(e))return!1;var n=a||e.get().tabs[t];return!!(d.FOLDER_MASKS[d.FOLDER_UNRESPOND]&n.folders)}function na(e,t){return!1===((t.get().block_states||{})[e]||{}).free}function ra(e){return null!=e.get().pendingForward}function sa(e,t){return(t.get().block_states[e]||{}).who===vk.id}function ia(e,t){var a=e.get().block_states;Object.keys(a).forEach((r=>{a[r].time?!1===a[r].free&&Date.now()-a[r].time>=5e4&&t.push([n.mutexEvent([,1,"gim"+e.get().gid,r,0,""])]):a[r].time=Date.now()}))}function oa(e,t,a){var n;return!(0,f.showTabbedBox)("al_im.php",{act:"a_spam",offset:"0",gid:e.get().gid},{onDone:(a,r)=>{r&&(n=t(a,e,r))},params:{width:638,onDestroy:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0),n.unmount()}}},a)}function la(e,t){return ca(e.get(),t,(0,_.getTab)(e,t).last_seen)}function ca(e,t,a,n){if((0,y.isDialogWithYourself)(e.id,t))return"";if(a.platform)return(0,U.getLang)("mail_header_online_status")+(a.mobile?da(t,!1,!1,!0):"");if(!a.can_see){var r=(0,R.oCacheGet)(e,t),s=r||e.tabs[t];return(0,P.getLastSeenByStatus)(a.status,s.sex)}if(!a.time||Date.now()-1e3*a.time>7776e6)return"";var i=(0,U.getDateText)(a.time,e.timeshift),o=(0,U.langSex)((0,R.oCacheGet)(e,t).sex,(0,U.getLang)("mail_last_activity_tip","raw")).replace("{user}","").replace("{time}",i);return a.mobile&&(o+=da(t,!1,!1,n)),o}function da(e,t,a,n){var r={mid:e};a||(r.was=1),t?r.forcetoup=!0:r.forcetodown=!0,r=Object.assign(r,n);var s=JSON.stringify(r).slice(1,-1).replace(/"/g,"&quot;");return(0,c.getTemplate)("im_wrap_mobile",{class:"im_status_mob_onl",params:s})}function ua(e,t){var a=t.get().tabs[e];return(0,f.showBox)("al_settings.php",{act:"blacklist_box",q:a.href},{stat:[window.jsc("web/settings.js"),"settings.css"]})}function _a(e,t){return(0,f.showBox)("groupsedit.php",{act:"bl_edit",name:"/id"+e,gid:t.get().gid},{stat:["page.css","ui_controls.js","ui_controls.css"]})}function ga(e){return e.get().gid?"/gim"+e.get().gid:"/im"}function ma(e,t,a,n){var r;Oa((0,f.showTabbedBox)("al_im.php",{act:"a_important",offset:"0"},{onDone:(n,s)=>{s&&(r=a(n,e,t,s))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{r&&r.unmount()}}},n),e)}function pa(){var e=document.activeElement;return null!==e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||e.getAttribute("contenteditable"))}function ha(e,t,a){var n=(0,H.geByClass1)("_im_mess_"+e,a);return n&&(0,H.toggleClass)(n,"im-mess_fav",t),a}function fa(e,t,a){var n=(0,_.getFirstUnread)(e,e.get().peer);if(!n)return[!1,0];var r=(0,H.geByClass1)(`_im_mess_${n}`,t);if(!r){var s=(0,_.getLastMessage)(e,e.get().peer,n);if(!s)return[!0,0];r=(0,H.geByClass1)(`_im_mess_${s.messageId}`,t)}var i=(0,H.hasClass)(r,"_im_mess_srv")?r:(0,H.gpeByClass)("_im_mess_stack",r);if(!i)return[!0,0];var o=r?r.offsetTop:0,l=i.offsetTop+o,c=a.contHeight();return l<=a.scrollTop()+a.getScrollHeight()?[!0,0]:[!1,Math.max(0,c-l)]}function va(e,t,a){(0,v.cancelEvent)(t);var n=(0,H.gpeByClass)("_im_top_notice",a);(0,l.fadeOut)(n,200,H.re.pbind(n));var r=(0,H.gpeByClass)("_im_page_dialogs",n);r&&(0,H.hasClass)(r,"im-page--dialogs-notice")&&(0,H.removeClass)(r,"im-page--dialogs-notice"),ajax.post("al_im.php",{act:"a_hide_top_notice",type:n.getAttribute("data-type"),hash:n.getAttribute("data-hash")})}function ba(e,t,a){(0,v.cancelEvent)(t);var n=(0,H.gpeByClass)("_im_aside_notice",a);(0,l.slideUp)(n,200,H.re.pbind(n)),ajax.post("al_im.php",{act:"a_hide_top_notice",type:n.getAttribute("data-type"),hash:n.getAttribute("data-hash")})}function Ca(e,t){(0,v.cancelEvent)(e);var a=(0,H.gpeByClass)("_im_aside_promo_block",t);(0,l.slideUp)(a,200,H.re.pbind(a)),ajax.post("al_im.php",{act:"a_hide_promo_block",type:a.getAttribute("data-type"),hash:a.getAttribute("data-hash")})}function Ta(e,t){(0,H.gpeByClass)("_im_aside_promo_block",t).classList.add("--action-called"),ajax.post("al_im.php",{act:"a_vkadmin_app_install",hash:(0,H.domData)(t,"hash"),platform:(0,H.domData)(t,"platform")})}function Ea(e){var t=e.filter((e=>"reply"!==e.type));return t.length>1?function(e){return[...e].sort(((e,t)=>"mail"!==e.type?"mail"===t.type?-1:1:0))}(t):t}function Ia(e,t,a,n,r){var s,i=function(e,t){var a=e.replace(/\<br\s*\/?\>(\n)?/gi," ").replace(/[\n\r]/gi," ");return a=(0,m.replaceMentions)(a,((e,t,a,n,r)=>r)),t&&(a=Emoji.emojiToHTML(a,!0)),a}(a,n);if(t&&"..."!==t.trim()&&!Z.Ranges.isChatOrChannelPeer(e)&&(i=(0,c.getTemplate)("im_topic",{topic:t,cls:"im-topic_dialog"})+i),null==(s=i)?void 0:s.length)return i;var o=Ea(r),l=o[0];return l?(0,c.getTemplate)("im_dialog_media",{name:La(l,o)}):(0,c.getTemplate)("im_dialog_deleted_media")}function La(e,t){var a={photo:(0,U.getLang)("mail_added_photos","raw"),video:(0,U.getLang)("mail_added_videos","raw"),audio:(0,U.getLang)("mail_added_audios","raw")};switch(e.type){case"mail":var n=e.object?e.object.fwd_count:e.id.split(";").length;return(0,U.langNumeric)(n,(0,U.getLang)("mail_fwd_msgs","raw"),!0);case"photo":case"video":case"audio":if("video"===e.type&&"clip"===e.kind)return(0,U.getLang)("mail_added_clip");var r=t.filter((t=>t.type===e.type)).length;return(0,U.langNumeric)(r,a[e.type],!0);case"audio_playlist":return"audio_album"===e.kind?(0,U.getLang)("mail_added_audio_album"):(0,U.getLang)("mail_added_audio_playlist");case"artist":return(0,U.getLang)("mail_added_artist");case"doc":switch(e.kind){case"graffiti":return(0,U.getLang)("mail_added_graffiti");case"audiomsg":case"audio_message":return(0,U.getLang)("mail_added_audiomsg");default:return(0,U.getLang)("mail_added_docs")}case"geo":case"map":return(0,U.getLang)("mail_added_geo");case"wall":return(0,U.getLang)("mail_added_wall");case"wall_reply":return(0,U.getLang)("mail_added_wall_reply");case"gift":return(0,U.getLang)("mail_added_gift");case"link":case"share":return(0,U.getLang)("mail_added_link");case"sticker":return(0,U.getLang)("mail_added_sticker");case"app_action":return(0,U.getLang)("mail_added_widget");case"market":return(0,U.getLang)("mail_added_market_item");case"money_transfer":return(0,U.getLang)("mail_added_money_transfer");case"money_request":return(0,U.getLang)("mail_added_money_request");case"story":return(0,U.getLang)("mail_added_story");case"mask":return(0,U.getLang)("mail_added_mask");case"article":return(0,U.getLang)("mail_added_article");case"call":case"group_call_in_progress":return(0,U.getLang)("mail_added_call");case"poll":return(0,U.getLang)("mail_added_poll");case"podcast":return(0,U.getLang)("mail_added_podcast");case"widget":return(0,U.getLang)("mail_added_widget");default:return(0,U.getLang)("mail_added_"+e.type)}}function ya(e){(0,H.addClass)(e,"im-send-btn_loading")}function Aa(e){(0,H.removeClass)(e,"im-send-btn_loading")}function Sa(e){var t=e.get(),a=(0,_.getPinnedMessage)(e);if(!a||!(0,w.isPinnedMessageVisibleInTab)(e,(0,E.getPeer)(e)))return"";var n,r=(0,R.oCacheGet)(e,a.userId);if(!r)return"";if((0,g.isMoneyRequest)(a)&&void 0!==a.kludges.attach1_tr_amount)n=function(e,t){var a="",n="%s "+t.kludges.attach1_currency;"RUB"===t.kludges.attach1_currency&&(n=(0,U.getLang)("mail_money_amount_rub","raw"));if(t.kludges.attach1_total_amount){var r=(0,U.langNumeric)(t.kludges.attach1_tr_amount/1e3,"%s",!0),s=(0,U.langNumeric)(t.kludges.attach1_total_amount/1e3,n,!0);a=(0,U.getLang)("mail_money_request_collected_amount_from").replace("{amount}",r).replace("{total_amount}",s)}else{var i=(0,U.langNumeric)(t.kludges.attach1_tr_amount/1e3,n,!0);a=(0,U.getLang)("mail_money_request_collected_amount").replace("{amount}",i)}if((0,c.intval)(t.kludges.attach1_held_amount)){var o=(0,U.langNumeric)(t.kludges.attach1_held_amount/1e3,n,!0);a+=" "+(0,U.getLang)("mail_money_request_held_amount").replace("{amount}",o)}t.text&&(a+='<span class="divider"></span>'+(0,k.parseMessageText)(e,t.text,t.kludges));t.kludges.attach1_total_amount&&(a+=(0,c.getTemplate)("im_pinned_message_media_bar",{percent:Math.min(100,Math.floor(t.kludges.attach1_tr_amount/t.kludges.attach1_total_amount*100))}));return a}(t,a);else if(a.text)n=(0,k.parseMessageText)(t,a.text,a.kludges);else if(a.attaches.length){var s=Ea(a.attaches),i=(0,g.isAppAction)(a)?a.kludges.attach1_preview:La(s[0],s);n=(0,c.getTemplate)("im_pinned_message_media",{text:i})}else n=(0,c.getTemplate)("im_pinned_message_deleted_media");return n=n.replace(/<br\s?\/?>/gi," "),(0,c.getTemplate)("im_pinned_message",{link:r.link,name:r.name,date:(0,U.getSmDate)(a.date,t.timeshift),content:n})}function ka(e,t,a){var n=a.getAttribute("data-info");n&&(0,h.showTooltip)(a,{text:n,className:"_im_history_tooltip",appendParentCls:"_im_mess_stack",black:1,hidedt:1e3,shift:[0,4]})}function Ma(e,t,a){var n=+a.getAttribute("data-time");n&&(0,h.showTooltip)(a,{text:(0,U.getLang)("mail_message_edited")+" "+(0,U.getSmDate)(n,e.get().timeshift),className:"_im_history_tooltip",appendParentCls:"_im_mess_stack",black:1,shift:[0,4]})}function Ra(e,t,a){var n=a.target,r=n.closest("."+re),s=r.querySelector("._im_mess");if(s){var i,l=Number(s.getAttribute("data-cmid")),c=D.casperMessagesStore.getExpireTime(l),d="_im_bomb_tooltip_"+Math.round(1e4*Math.random()).toString(16);if(window.tooltips){var u=t.querySelectorAll(".im-mess-stack--bomb");Array.from(u).forEach((e=>{e!==n&&tooltips.hide(e,{fasthide:!0})}))}var _=wa(e);(0,h.showTooltip)(n,{text:m((0,o.formatTime)(c)),className:"_im_history_tooltip "+d,appendParentCls:re,black:1,shift:[12,4],onShowStart:g,onShowEnd(){i=setTimeout(g,500)},onHide(){clearTimeout(i)},force:!0,toup:n.getBoundingClientRect().top>_+37,hasover:!0}),setTimeout(g,500)}function g(){var e=r.querySelector(`.${d} .tt_text`);e&&(e.innerHTML=m((0,o.formatTime)(D.casperMessagesStore.getExpireTime(l)))),i=setTimeout(g,500)}function m(e){return`<div class="wrapped">${e}</div>`}}function wa(e){var t=(0,E.getPeer)(e),a=(0,_.getTab)(e,t),n=(0,w.isPinnedMessageVisibleInTab)(e,(0,E.getPeer)(e))||a&&a.top_banner,r=(0,F.getPeerProfileHeight)(),s=a&&(0,_.tabIsMessageRequest)(a)&&!(0,_.tabIsRejectedMessageRequest)(a);return 105+(n?s?72:Na(e):0)+r}function Na(e){var t=(0,_.getPinnedMessage)(e);return t&&(0,g.isMoneyRequest)(t)?62:52}function Oa(e,t){e.bodyNode.addEventListener("mouseover",(e=>{e.target.classList.contains("_im_edit_time")&&Ma(t,0,e.target),e.target.classList.contains("_im_page_info")&&ka(0,0,e.target)})),e.bodyNode.addEventListener("click",(e=>{e.target.closest(`.${Oe}`)&&kn(e)}))}function Pa(e,t,a,n,r){var s,i=e.get();Oa((0,f.showTabbedBox)("al_im.php",{act:"a_get_pinned_message_box",chat:a,gid:e.get().gid,hash:i.tabs[a].hash},{onDone:(a,r)=>{r&&(s=n(a,e,t,r),(0,Q.initWidgets)(a.bodyNode))},params:{width:638,containerClass:"im-show-message-box",onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{s&&s.unmount()}}},r),e)}function xa(e,t,a){var n=e.get();Oa((0,f.showTabbedBox)("al_im.php",{act:"a_get_replied_message_box",chat:n.peer,msgid:t,gid:n.gid,hash:n.tabs[n.peer].hash},{onDone:(e,t)=>{},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{}}},a),e)}function Da(e,t){return!(!Z.Ranges.isChatOrChannelPeer(e.peerId)||!e.memberIds)&&e.memberIds.indexOf(t)>=0}function Fa(e){return!Z.Ranges.isChatOrChannelPeer(e.peerId)||e.data.kicked?0:e.membersCount}function Ha(e,t){var a=[],n=t.find((e=>"mail"===e[0])),r=n?n[1].split(";"):[];for(r.length>De&&(n[1]=r.slice(0,De).join(";"));e.length>xe;){var s=e.substr(0,xe).lastIndexOf(" ");-1==s&&(s=xe),a.push({msgText:(0,c.trim)(e.substr(0,s))}),e=(0,c.trim)(e.substr(s))}for(e.length&&a.push({msgText:e,attaches:t}),a.length||a.push({attaches:t}),r=r.slice(De);r.length;r=r.slice(De))a.push({attaches:[["mail",r.slice(0,De).join(";")]]});return a}function Ua(e){return e.length>xe}function Ba(e,t,a,n,r){void 0===n&&(n=!0),void 0===r&&(r=null);var s=Object.assign(function(e,t){if(t)return{chat_id:e.invite_chat_id,hash:e.invite_hash,link:e.invite_link};return e}(t,n),{act:"a_chat_preview"}),i=!1;(0,f.showBox)("al_im.php",s,{stat:["boxes.css"],params:{hideButtons:!0,onHide(){e.set(a),i&&i.unmount()}},onFail:e=>(setTimeout((()=>(0,f.showFastBox)((0,U.getLang)("global_error"),e)),0),!0),onDone(t){i=(0,b.mount)(t.bodyNode,e,r)}},{})}function ja(){(0,f.showFastBox)((0,U.getLang)("global_error"),(0,U.getLang)("mail_message_wait_until_uploaded"))}function Ga(e,t){var a=(0,_.getTab)(e,t.peerId)||{},n=e.get(),r=Z.Ranges.isChatOrChannelPeer(t.peerId)&&(0,O.isUserAdminInChat)(a,n.id),s=Z.Ranges.isChatOrChannelPeer(t.peerId)&&(0,O.isUserAdminInChat)(a,t.userId);if(!t)return!1;if(!(0,g.isOut)(t)&&(!r||s))return!1;if(333==t.peerId)return!1;if(Date.now()/1e3-t.date>86400)return!1;if(Ge(e,t.peerId,t.messageId))return!1;if(Z.Ranges.isChatOrChannelPeer(t.peerId)){if(!(0,_.isChatActive)(a))return!1}else if(a.block_error>0)return!1;return!0}function qa(e,t){return t.map((t=>(0,R.oCacheGet)(e,t)))}function Va(e,t){if("number"!=typeof e||0===e)return"";var a,n=[[31536e3,t?(0,U.getLang)("global_years_accusative","raw"):(0,U.getLang)("global_age_years","raw")],[2592e3,t?(0,U.getLang)("global_months_accusative","raw"):(0,U.getLang)("global_age_months","raw")],[604800,t?(0,U.getLang)("global_weeks_accusative","raw"):(0,U.getLang)("global_age_weeks","raw")],[86400,t?(0,U.getLang)("global_days_accusative","raw"):(0,U.getLang)("global_age_days","raw")],[3600,t?(0,U.getLang)("global_hours_accusative","raw"):(0,U.getLang)("global_hours","raw")],[60,t?(0,U.getLang)("global_minutes_accusative","raw"):(0,U.getLang)("global_minutes","raw")],[1,t?(0,U.getLang)("global_seconds_accusative","raw"):(0,U.getLang)("global_age_seconds","raw")]],r=e,s=[];if(n.forEach((e=>{var t=e[0],a=e[1],n=Math.floor(r/t);r%=t,n>=1&&s.push((0,U.langNumeric)(n,a))})),1===(a=s.length))return s.pop();var i=s.slice(0,a-1).join(", "),o=s.pop();return(0,U.getLang)("global_and").replace(/{before}/gi,i).replace(/{after}/gi,o)}function Ya(e,t,a,n){n&&!Ge(e,a,n)&&((0,_.getMessage)(e,a,n)?(e.setState({msgid:n}),(0,u.updateLocation)({msgid:n}),t()):e.get().longpoll.push([(0,T.changePeer)(a,n)]))}function Ka(e){var t=(0,H.geByClass1)("im-mess_is_editing");if(!t)return null;var a=e.get().tabs[e.get().peer],n=(0,_.parserMessage)(a.msgs[(0,H.domData)(t,"msgid")]);return n&&n.peerId==e.get().peer?n:null}function za(e,t){var a="unshown";if((0,_.isClassicInterface)(e)){var n=document.getElementById("ui_rmenu_mr");n&&((0,_.existsIncomingMessageRequest)(e)?n.classList.remove(a):n.classList.add(a))}else t(e)}function $a(){for(var e=(0,i.curBox)();e;)e.hide(),e=(0,i.curBox)()}function Wa(e,t){return(0,U.getLang)("mail_invitation_sended_ago").replace("{when}",(0,U.getDateText)(e,t))}function Qa(e,t){var a=(0,E.getPeer)(e),n=(0,_.getMessage)(e,a,t);return(0,O.canPinOrUnpin)(e,a)&&!(0,g.isCasperMessage)(n)}function Za(e,t){var a=(0,E.getPeer)(e);return!t.find((t=>{var n=(0,_.getMessage)(e,a,t);return(0,g.isCasperMessage)(n)}))}function Ja(e,t){var a=(0,E.getPeer)(e);return!t.find((t=>{var n=(0,_.getMessage)(e,a,t);return(0,g.isCasperMessage)(n)}))}function Xa(e,t){var a=D.casperMessagesStore.isProcessed(e.chat_local_id),n=D.casperMessagesStore.has(e.chat_local_id),r=D.casperMessagesStore.getExpireTime(e.chat_local_id)>D.MAX_DEVIATION;(!n&&!a||n&&r)&&t(e),n&&r&&D.casperMessagesStore.remove(e.chat_local_id)}function en(e){return e===vk.id}function tn(e){return!en(e)&&(Z.Ranges.isChatOrChannelPeer(e)||Z.Ranges.isUserId(e))}function an(e,t){return Z.Ranges.isUserId(t)&&!en(t)&&!(0,_.isCommunityInterface)(e)&&!Z.Ranges.isContactId(t)}function nn(e,t){var a=e.get(),n=(0,_.isCommunityInterface)(e);return Z.Ranges.isUserIdTransitional(t)&&!en(t)&&!n&&!(0,c.inArray)(t,a.moneyTransferExcept)&&!Z.Ranges.isContactId(t)||Z.Ranges.isGroupId(t)&&a.moneyTransferCommAvail&&(0,B.getCurrentTab)(e).moneyTransferAvail&&!n||n&&a.moneyRequestAvail&&!Z.Ranges.isChatOrChannelPeer(t)||Z.Ranges.isChatOrChannelPeer(t)&&(0,B.getCurrentTab)(e).moneyRequestAvail&&!(0,_.isCasperChat)(e,t)}function rn(e,t,a){var n="im-expired-message",r=(0,H.geByClass1)(`_im_mess_${a.messageId}`,t),s=r&&r.closest(Pe);if(!r||!s)return t;var i,o,l,c=Array.from(s.querySelectorAll("._im_mess")),d=(o=(i=s).previousElementSibling,l=i.nextElementSibling,[o&&1===o.nodeType?o:null,l&&1===l.nodeType?l:null]),u=d[0],_=d[1],g=u&&u.classList.contains(n),m=_&&_.classList.contains(n),p=g&&0===c.findIndex((e=>+e.getAttribute("data-msgid")===a.messageId)),h=m&&c.findIndex((e=>+e.getAttribute("data-msgid")===a.messageId))===c.length-1,f=sn((p?+u.getAttribute("data-count"):0)+(h?+_.getAttribute("data-count"):0)+1,`_im_expired_message_${a.messageId}`),v=(0,H.se)(f);if(p&&(v.classList.add(...u.classList),u.remove()),h&&(v.classList.add(..._.classList),_.remove()),1===c.length)s.replaceWith(v);else{var b=c.reduce(((e,t)=>{var n=+t.getAttribute("data-msgid");return n<a.messageId&&e[0].push(t),n>a.messageId&&e[1].push(t),e}),[[],[]]),C=b[0],T=b[1];s.replaceWith((0,H.se)(on(e,C))||"",v,(0,H.se)(on(e,T))||"")}return t}function sn(e,t){return void 0===t&&(t=""),(0,c.getTemplate)("sImExpiredMessagePlaceholder",{text:(0,U.langNumeric)(e,(0,U.getLang)("mail_messages_expired","raw")).replace("{count}",e),count:e,id_classes:(0,p.classNames)(t)})}function on(e,t){if(0===t.length)return"";var a=+t[0].getAttribute("data-peer"),n=+t[0].getAttribute("data-msgid"),r=(0,_.getMessage)(e,a,n);return(0,c.getTemplate)("im_mess_stack",Object.assign((0,k.getStackDataFromMessage)(e,r),{messages:t.reduce(((e,t)=>e+t.outerHTML),"")}))}function ln(e,t){var a=`._im_replied_message[data-msgid="${t.messageId}"]`;Array.from(e.querySelectorAll(a)).forEach((e=>{var t=e.querySelector(".im-replied--text"),a=e.querySelector(".im-replied--photo-wrapper");t.innerHTML=(0,c.getTemplate)("im_dialog_media",{name:(0,U.getLang)("mail_expired_message")}),a.innerHTML=""}))}function cn(e){return Z.Ranges.isChatOrChannelPeer(e.peerId)&&e.membersCount?(0,U.langNumeric)(e.membersCount,(0,U.getLang)("mail_im_n_chat_members","raw")):""}var dn=C.CallStatSource.CONVO_SNIPPET,un=C.CallStatSource.CONVO_HEADER,_n=C.CallStatSource.CONVO_LIST,gn=C.CallStatSource.CONVO_JOIN_SNIPPET,mn=C.CallStatSource.CONVO_JOIN_HEADER,pn=C.CallStatSource.CONVO_JOIN_BANNER;C.CallStatSource.WIDGET;function hn(e,t,a,n,r,s,i){if(void 0===a&&(a=!1),void 0===s&&(s=!1),void 0===i&&(i=!1),window.Calls&&window.Calls.call&&!window.Calls.isInActiveCall){if(s)return void window.Calls.showStartCallModal(t);if(i)return void window.Calls.showCallByNamePopup(t,r);if(!t)return void window.Calls.startCall(a,r);if(Z.Ranges.isChatOrChannelPeer(t)){var o=X({},(0,_.getTab)(e,t),{canAddMembers:(0,O.canInviteUser)(e,t,void 0)});window.Calls.startGroupCall(t,[o],n,a,r)}else{var l=(0,R.oCacheGet)(e,t),c=X({},l,{canAddMembers:!0});window.Calls.call(t,a,[c,[l]],r)}}}function fn(e){(0,v.cancelEvent)(e);var t=e.target.closest(`.${ie}`),a=t&&t.querySelector("[href]");if(a){var n=decodeURIComponent(a.getAttribute("href"));return n&&window.Calls&&window.Calls.showJoinPopup?window.Calls.showJoinPopup(n,C.CallStatSource.LINK_JOIN_SNIPPET):void 0}}function vn(e,t){var a=(0,_.getTab)(e,t);return!(0,_.isCommunityInterface)(e)&&!!a.can_start_call}function bn(e,t){var a=(0,_.getTab)(e,t);return!(!a||!a.callInProgress)}function Cn(e,t,a,n,r){if(void 0===n&&(n=!1),window.Calls&&window.Calls.call&&!window.Calls.isInActiveCall){var s=(0,_.getTab)(e,t);if(!(0,_.isChatActive)(s))return;window.Calls.showStartCallModal(null,a)}}function Tn(e,t){void 0===t&&(t=void 0);var a=t?`&msgid=${t}`:"";return`/im?sel=${ut(e)}${a}`}function En(e,t){(0,f.showBox)("al_im.php",{act:"group_calls_onboarding_box"},{params:{hideButtons:!0,hideOnBGClick:!1,width:655,onHide:()=>{"group_calls"===nav.objLoc.promo&&(delete nav.objLoc.promo,nav.setLoc(nav.objLoc)),ajax.post("al_index.php",{act:"hide_feature_tt",hash:t,type:"group_calls"})}},containerClass:"GroupCallsOnboarding",onDone:t=>{var a=t.bodyNode,n=a.querySelector(".GroupCallsOnboarding__call-button"),r=a.querySelector(".GroupCallsOnboarding__skipButton"),s=a.querySelector(".GroupCallsOnboarding__closeButton"),i=(0,H.ge)("box_layer",t.bodyNode),o=function(){t.hide();var a=new ElementTooltip((0,H.geByClass1)("_im_create_call"),{content:(0,U.getLang)("mail_group_calls_im_search_tt"),forceSide:"bottom",cls:"feature_intro_tt feature_intro_blue_tt",autoShow:!1,appendTo:(0,H.geByClass1)("_im_dialogs_search"),width:250,offset:(0,_.isClassicInterface)(e)?[10,25]:[13,12],rightShift:30,onHide:function(){(0,v.removeEvent)(a._ttel,"click")}});a.show(),(0,v.addEvent)(a._ttel,"click",(()=>a.hide())),cur.destroy.push((()=>{(0,v.removeEvent)(a._ttel,"click"),a.destroy()}))};(0,v.addEvent)(n,"click",(()=>{t.hide(),hn(e,null,!1,null,_n)})),(0,v.addEvent)(r,"click",o),(0,v.addEvent)(s,"click",o);var l=e=>{e.target===i&&((0,v.removeEvent)(i,"click",l),o())};(0,v.addEvent)(i,"click",l),cur.destroy.push((()=>{(0,v.removeEvent)(r,"click"),(0,v.removeEvent)(s,"click"),(0,v.removeEvent)(n,"click"),(0,v.removeEvent)(i,"click",l),t.hide(),t.destroy()}))}})}function In(e,t){cur.groupCallsTooltip||"im"!==cur.module||!(0,H.isVisible)("im_dialogs_search")||cur.introTooltipShow||setTimeout((function(){var a=()=>{cur.groupCallsTooltip&&cur.groupCallsTooltip.destroy(),ajax.post("al_index.php",{act:"hide_feature_tt",hash:t,type:"group_calls_new_year"})};cur.groupCallsTooltip=new ElementTooltip((0,H.geByClass1)("_im_create_call"),{content:(0,U.getLang)("mail_group_calls_im_search_new_year_tt"),forceSide:"bottom",cls:"feature_intro_tt feature_intro_blue_tt",autoShow:!1,appendTo:(0,H.geByClass1)("_im_dialogs_search"),width:200,offset:(0,_.isClassicInterface)(e)?[10,25]:[13,12],rightShift:30,onHide:function(){cur.groupCallsTooltip&&((0,v.removeEvent)(cur.groupCallsTooltip._ttel,"click",a),cur.groupCallsTooltip.destroy()),ajax.post("al_index.php",{act:"hide_feature_tt",hash:t,type:"group_calls_new_year"})}}),cur.groupCallsTooltip.show(),(0,v.addEvent)(cur.groupCallsTooltip._ttel,"click",a),cur.destroy.push((function(){cur.groupCallsTooltip&&((0,v.removeEvent)(cur.groupCallsTooltip._ttel,"click",a),cur.groupCallsTooltip.destroy())}))}),1e3)}function Ln(e,t){var a=20,n=document.querySelector("._im_aside_notice");return n&&(a+=n.offsetHeight),(0,_.isCommunityInterface)(e)?a+=268:(a+=120,e.get().hasContacts&&(a+=32),(0,_.existsIncomingMessageRequest)(e)&&(a+=32)),Math.floor((t-a)/32)}function yn(e,t,a,n){var r=n?()=>n.removeDialog(e,t):null,s=()=>(0,_.isClassicInterface)(e)&&a().updateMenu(e);return((0,_.getTab)(e,t)?Promise.resolve():e.set((e=>(0,$.loadPeer)(e,t,0,!1,!1,"chatInvite")))).then((()=>{var a=(0,_.getTab)(e,t);return(0,_.tabIsMessageRequestToChat)(a)?Ba(e,{receiver_peer_id:t},N.leaveInvitation,!1,{updateList:r,updateMenu:s}):e.get().longpoll.push([(0,T.changePeer)(t,!1,!1,!1,"")])}))}function An(e,t){t?J.FlatButton.lock(e):J.FlatButton.unlock(e)}function Sn(e,t,a){var n=e.querySelector(`._im_mess_${t}`);return n?n.querySelector(`.${ne}[data-index="${a}"]`):null}function kn(e){var t=e.target.closest(`.${Ne}`);(0,v.cancelEvent)(e),t&&t.classList.toggle("im_msg_audiomsg--transcription-expanded")}},75560:(e,t,a)=>{"use strict";a.d(t,{BUTTON_TYPE_OPEN_LINK:()=>y,BUTTON_TYPE_OPEN_MODAL_VIEW:()=>A,handleOpenLink:()=>k,handleShowSnackbar:()=>R,handleCallbackAction:()=>O,CALLBACK_TIMEOUT_MS:()=>P,handleButtonClick:()=>x,getButtonAppearance:()=>D,getButtonLabel:()=>F,getActionObjectFromElement:()=>U,getAttributesFromActionObject:()=>B,sendLocationFromKeyboard:()=>j});a(226699),a(66992),a(569720),a(241539),a(804723),a(115306),a(333948),a(560285);var n=a(342269),r=a(70162),s=a(659397),i=a(274642),o=a(146143),l=a(69935),c=a(240367),d=a(475234),u=a(459554),_=a(309756),g=a(826338),m=a(993421),p=a(606542),h=a(827749),f=a(712439),v=a(722199),b=a(859456),C=a(844142),T=7131443,E="vkpay",I="location",L="open_app",y="open_link",A="open_modal_view",S=["app-id","owner-id","type","payload","hash","label","link"];function k(e,t){var a=new URL(e);if(!!a.hostname.match(b.OUR_DOMAINS))window.open(e);else{var n=new o.MessageBox;n.setOptions({title:(0,r.getLang)("mail_callback_popup_title"),bodyStyle:"overflow: hidden; text-overflow: ellipsis;"});var s=(0,r.getLang)("mail_callback_popup_text").replace("{name}",t).replace("{domain}",a.hostname);n.content(s),n.addButton((0,r.getLang)("box_cancel"),!1,"no"),n.addButton((0,r.getLang)("global_open"),(()=>{window.open((0,l.wrapAwayIfExternal)(e,!0)),n.hide()})),n.show()}}function M(e){var t=e.type,a=e.appId,n=e.ownerId,r=e.hash,s=e.appHash,o="app"+(t===E?T:a)+(n?"_"+n:"");(0,i.showWiki)({w:o+encodeURIComponent("#"+r),from_keyboard:1,app_hash:s})}function R(e){var t=e.peerId,a=e.ownerId,n=e.text,r=e.store,s=(0,u.getTab)(r,t),i=(0,p.oCacheGet)(r,a),o=C.Ranges.isChatOrChannelPeer(t)&&i?i.photo:void 0;(0,_.showNotification)({text:n,title:s.name,photo:o})}var w=["open_link","open_app"];function N(e){var t=setTimeout((()=>e.set(d.unsetActionCallbackTimeout)),2e3);e.set((e=>(0,d.setActionCallbackTimeout)(t,e)))}function O(e,t){var a=e.action,n=(0,m.getPeer)(t)===e.peer_id;if(a&&n&&!(w.includes(e.action.type)&&(0,m.getActionCallbackTimeout)(t)))switch(e.action.type){case"open_link":!function(e){var t=e.peerId,a=e.store;k(e.link,(0,u.getTab)(a,t).name)}({peerId:e.peer_id,link:a.link,store:t}),N(t);break;case"open_app":M({type:a.type,appId:a.app_id,ownerId:a.owner_id,hash:a.hash,appHash:(0,m.getKeyboardAppHash)(t)}),N(t);break;case"show_snackbar":R({peerId:e.peer_id,ownerId:e.owner_id,text:a.text,title:a.title,store:t});break;default:return}}var P=6e4;function x(e,t,a,n){var r=e.app_id,s=e.owner_id,i=e.type,o=e.payload,l=e.hash,d=void 0===l?"":l,u=e.link,_=void 0===u?"":u,p=n.keyboardAuthorId,b=(0,m.getKeyboardAppHash)(a);switch(i){case y:(0,m.getPeer)(a)===v.VK_OFFICIAL_PEER_ID&&(0,g.isOnboardingFindFriendsLink)(_)&&(0,h.collectOnboardingFindFriendsClickStats)((0,f.unpackStore)(a).viewer_id);break;case E:case L:M({type:i,appId:r,ownerId:s,hash:d,appHash:b});break;case I:j((e=>t({keyboardAuthorId:p,action:{label:"",attaches:[e],payload:o}})));break;case"text":t({action:e,appHash:b,keyboardAuthorId:p});break;case"callback":var C=n.message,T=n.peerId,A=n.onBeforeSend,S=void 0===A?()=>{}:A,k=n.onSendSuccess,R=void 0===k?()=>{}:k,w=n.onSendFail,N=void 0===w?()=>{}:w;S(),(0,c.sendMessageEvent)({author_id:p,conversation_message_id:null==C?void 0:C.chat_local_id,message_id:null==C?void 0:C.messageId,peer_id:T,payload:e.payload}).then(R,N);break;default:e.payload=JSON.stringify({command:"not_supported_button",button_type:i,payload:e.payload}),t({action:e,appHash:b,keyboardAuthorId:p})}}function D(e){return H(e)?"primary":e.color.toLowerCase().replace("default","secondary")}function F(e){var t=e.action,a=t.type,i=t.label;return a===I?(0,r.getLang)("mail_keyboard_label_location"):H(e)?(0,r.getLang)("mail_keyboard_label_vkpay").replace(/ VK Pay$/,""):function(e){var t=e;return t=(0,s.decodeHTMLEntities)(t||""),t=(0,n.clean)(t).replace(/\n(\r)?/gi," "),t=Emoji.emojiToHTML(t,!0)}(i)}function H(e){var t=e.action,a=t.type,n=t.app_id;return a===E||a===L&&n===T}function U(e){return S.reduce(((t,a)=>(t[a.replace("-","_")]=e.getAttribute("data-"+a)||void 0,t)),{})}function B(e,t){var a=Object.entries(e).reduce(((e,t)=>{var a=t[0],r=t[1];return e+` data-${a.replace("_","-")}="${(0,n.clean)(""+r)}"`}),"");e.type!==y&&e.type!==A||(a+=` href="${(0,l.wrapAwayIfExternal)(encodeURI(e.link),!0)}" target="_blank" rel="nofollow noopener"`);return a+=` data-index="${t}"`}function j(e){cur.sendLocation=function(t,a){a(),e(t)},(0,o.showBox)("al_places.php",{act:"a_choose_place_box",from_keyboard:1},{stat:["places.css","map.css","maps.js","ui_controls.css","ui_controls.js","boxes.css"],width:640,bodyStyle:"padding: 0px;"})}},43229:(e,t,a)=>{"use strict";a.d(t,{isAppAction:()=>r.isAppAction,isOut:()=>r.isOutbound,isServiceMsg:()=>r.isServiceMsg,isGraffiti:()=>r.isGraffiti,isAudioMsg:()=>r.isAudioMsg,isSticker:()=>r.isSticker,isGift:()=>r.isGift,isMoney:()=>r.isMoney,isMoneyRequest:()=>r.isMoneyRequest,isVKPay:()=>r.isVKPay,isCasperMessage:()=>r.isCasperMessage,isCallMessage:()=>r.isCallMessage,isUnread:()=>r.isUnread,isImportant:()=>r.isImportant,isMessageToBlockedCommunity:()=>r.isMessageToBlockedCommunity,isMessageEmpty:()=>r.isMessageEmpty,getMessageTTL:()=>r.getMessageTTL,isExpiredCasperMessage:()=>r.isExpiredCasperMessage,getUserId:()=>s,getAuthorId:()=>i});var n=a(67328),r=a(376473);function s(e){return(0,r.isOutbound)(e)?vk.id:e.userId}function i(e,t){var a=(0,n.unpackStore)(e);return(0,r.isOutbound)(t)?a.id:t.userId}},306151:(e,t,a)=>{"use strict";a.d(t,{onPeerTagsExtraHover:()=>f,renderPeerTags:()=>b,renderPeerTagsFilter:()=>C,initPeerTagsFilter:()=>T,onPeerTagsFilterCheckboxChange:()=>E,onPeerTagsFilterPaneItemClick:()=>I,renderPeerTagsFilterPane:()=>L,onDialogPeerTagClick:()=>A,isPeerTagsFolder:()=>S,convertPeerTagsFilterToMask:()=>M,onPeerTagsChangeEvent:()=>R,onPeerProfileTagsChangedEvent:()=>w,applyPeerTagsFilterToTab:()=>N,updateEmptyDialogsMargin:()=>O});a(892222),a(57327),a(226699),a(682772),a(821249),a(747042),a(702707),a(241539),a(339714),a(132023),a(323123),a(454747);var n=a(384032),r=a(342269),s=a(284863),i=a(891326),o=a(873589),l=a(70162),c=a(290846),d=a(659397),u=a(645523),_="_im_page_dialogs",g="PeerTagsFilter__control--hidden",m="_im_peer_tags_filter_pane",p="_im_peer_tags_filter_pane_item";function h(e,t){var a=0,n=[],r=[],s=!1;return e.forEach((e=>{e.width=e.width?e.width:function(e){return 12+9*(0,d.decodeHTMLEntities)(e.name).length}(e),e.width+(s?0:69)>=t-a?(r.push(e),s||(a+=69,s=!0)):(n.push(e),a+=e.width)})),[n,r]}function f(e,t){var a=e.target,n=(0,o.gpeByClass)("_im_dialog",a),i=parseInt((0,o.domData)(n,"peer")),l=t.get(),d=(0,s.getTab)(l,i),u=d.peerTagsMaxWidth;if(u){var _=h(v(l,d),u)[1].reduce(((e,t)=>e+=(0,r.getTemplate)("sImPeerTagsExtraTooltipItem",{name:t.name,color:t.color})),"");(0,c.showTooltip)(a,{text:_,center:!0,dir:"bottom",className:"PeerTagsExtraTooltip",hasover:!0})}}function v(e,t){var a=t.peer_tags&&t.peer_tags.ids.length?e.peer_profile_tags.filter((e=>t.peer_tags.ids.includes(e.id))):[];return t.ad_id&&a.unshift(function(e){var t,a;return e.is_easy_promoted_market?(t=(0,l.getLang)("mail_ad_tag_easy_promoted_market"),a=145):(t=e.has_ad_access?`${(0,l.getLang)("mail_ad_tag_text_prefix")} ${e.ad_id}`:(0,l.getLang)("mail_ad_tag_no_access_text"),a=e.has_ad_access?104:97),{isAdTag:!0,adTagText:t,width:a,name:t,color:"#e5ebf1"}}(t)),a}function b(e,t,a,n){if(t<69)e.innerHTML="";else{e.style.maxWidth=t+"px";var i=a.get(),o=(0,s.getTab)(i,n),c=v(i,o);if(c.length){var d=h(c,t),u=d[0],_=d[1],g=u.reduce(((e,t)=>(t.isAdTag?e+=(0,r.getTemplate)("sImPeerTagsAdTag",{ad_tag_text:t.adTagText,url:`ads?act=office&union_id=${o.ad_id}&utm_medium=community_messages_ad_tag&utm_source=dialog`,extra_class:o.has_ad_access?"PeerTagsItem--hasAdAccess":""}):e+=(0,r.getTemplate)("sImPeerTagsItem",{tag_id:t.id,name:t.name,color:t.color}),e)),""),m=_.length,p=`+${(0,l.getLang)("mail_im_peer_profile_extra_tags",m)}`;m&&(g+=(0,r.getTemplate)("sImPeerTagsExtra",{text:p})),e.innerHTML=g}else e.innerHTML=""}}function C(e){var t=(0,o.geByClass1)("_im_peer_tags_filter_tags"),a=e.peer_profile_tags||[];a.length>0&&t&&(t.innerHTML=a.reduce(((t,a)=>t+=(0,r.getTemplate)("sImPeerTagsFilterItem",{tag_id:a.id,name:a.name,color:a.color,checked:e.peer_tags_filter.ids.includes(a.id)?"checked":"",count:a.uses})),""))}function T(e){var t=e.get(),a=(0,o.geByClass1)("_im_peer_tags_filter_control");if(a)if(!t.peer&&t.peer_profile_tags&&t.peer_profile_tags.length>0){(0,o.removeClass)(a,g);var r=k(t.peer_profile_tags,t.peer_tags_filter.mask);e.set((e=>(0,n.updatePeerTagsFilter)(r,e))).then((()=>y(e,r,!0)))}else(0,o.addClass)(a,g)}function E(e,t){var a=t.get(),r=e.target,s=parseInt(r.id.slice(9)),i=r.checked?[].concat(a.peer_tags_filter.ids,s):a.peer_tags_filter.ids.filter((e=>e!==s));t.set((e=>(0,n.updatePeerTagsFilter)(i,e))).then((()=>y(t,i)))}function I(e,t){var a=t.get(),r=(0,o.hasClass)(e.target,p)?e.target:(0,o.gpeByClass)(p,e.target),s=parseInt((0,o.domData)(r,"id")),i=a.peer_tags_filter.ids.filter((e=>e!==s));t.set((e=>(0,n.updatePeerTagsFilter)(i,e))).then((()=>y(t,i)))}function L(e){var t,a,n=e.peer_tags_filter.ids,s=n.length>0,i=(0,o.geByClass1)(m),l=(t=(0,o.geByClass1)(_),a=(0,o.geByClass1)(m),parseFloat(getComputedStyle(t)["padding-top"])-(a&&a.offsetHeight>0?a.offsetHeight+1:0));if(s&&i){var c=(e.peer_profile_tags||[]).filter((e=>n.includes(e.id))).sort(((e,t)=>n.indexOf(e.id)-n.indexOf(t.id)));i.innerHTML=c.reduce(((e,t)=>e+=(0,r.getTemplate)("sImPeerTagsFilterPaneItem",{tag_id:t.id,name:t.name,color:t.color})),"")}(0,o.toggleClass)(i,"PeerTagsFilterPane--active",s),function(e,t){var a=(0,o.geByClass1)(_),n=(0,o.geByClass1)(m);if(e&&n){var r=t+(n.offsetHeight+1);a.style.paddingTop=`${r}px`}else a.style.paddingTop=`${t}px`}(s,l),O()}function y(e,t,a){var n=e.get();C(n),L(n),function(e){var t=(0,o.geByClass1)("_im_right_menu"),a=(0,o.geByClass1)("ui_rmenu_item_sel",t),n=(0,o.geByClass1)("_ui_item_all",t);(e.length>0||!a)&&uiRightMenu.switchMenu(n)}(t),a||n.longpoll.push([(0,u.changeTab)(t.length>0?i.FOLDER_PEER_TAGS:i.FOLDER_ALL)])}function A(e,t){var a=e.target,r=[parseInt((0,o.domData)(a,"id"))];t.set((e=>(0,n.updatePeerTagsFilter)(r,e))).then((()=>y(t,r)))}function S(e){return e.get().active_tab===i.FOLDER_PEER_TAGS}function k(e,t){if(!e||!e.length||!t)return[];var a=t.toString(2).split("").reverse().reduce(((e,t,a)=>("1"===t&&e.push(1<<a),e)),[]);return e.filter((e=>a.includes(e.mask))).map((e=>e.id))}function M(e,t){return Number.isInteger(t)?t:e&&e.length&&t&&t.length?e.filter((e=>t.includes(e.id))).reduce(((e,t)=>e+=t.mask),0):null}function R(e,t,a){var r=a.peerId,s=a.peerTagsMask,i=e.get(),o=k(i.peer_profile_tags,s);e.set((e=>(0,n.updatePeerTags)(r,o,s,e))).then((()=>{C(e.get()),i.peer||(t.renderPeerTags(e,r),S(e)&&e.set(n.updatePeerTagsFilterFolder).then((()=>t.restoreDialogs(e))))}))}function w(e,t){e.set(n.updatePeerProfileTags).then((()=>{C(e.get()),e.get().peer||(t.restoreDialogs(e),t.renderPeerTags(e))}))}function N(e,t){var a=e.peer_tags_filter.mask;return!(!a||!t.peer_tags)&&!!(a&t.peer_tags.mask)}function O(){var e=(0,o.geByClass1)("im-page--dialogs-empty");if(e){var t=(0,o.geByClass1)(m),a=t&&t.offsetHeight>0?t.offsetHeight/2:5;e.style.marginTop=`${a}px`}}},719711:(e,t,a)=>{"use strict";a.d(t,{addDelegateEvent:()=>o,removeDelegateEvent:()=>l});a(57327),a(66992),a(821249),a(651532),a(241539),a(323123),a(454747),a(333948);var n=a(873589),r=a(152278),s=new window.Map;function i(e){var t=s.get(e.currentTarget);if(t){var a=t[e.type];if(a)for(var r,i=0;i<a.length;i++){var o=a[i],l=o[0],c=o[1],d=void 0;if((0,n.hasClass)(e.target,l)?d=c(e,e.target):(r=(0,n.gpeByClass)(l,e.target,e.currentTarget))&&(d=c(e,r)),!1===d)break}}}function o(e,t,a,n,o){var l=s.get(e);l||(s.set(e,{}),l=s.get(e));for(var c=t.split(" "),d=0;d<c.length;d++){var u=c[d];l[u]||(l[u]=[],o?(0,r.addEvent)(e,u,i,!1,!1,o):(0,r.addEvent)(e,u,i)),l[u].push([a,n])}}function l(e,t,a,n){var o=s.get(e);o&&(t.split(" ").forEach((t=>{o[t]&&(o[t]=o[t].filter((e=>e[0]!==a||e[1]!==n)),0===o[t].length&&(0,r.removeEvent)(e,t,i))})),0===Object.keys(o).map((e=>o[e].length)).reduce(((e,t)=>e+t))&&s.delete(e))}},592380:(e,t,a)=>{"use strict";a.d(t,{MAX_DEVIATION:()=>r,EXPIRING_TIME:()=>s,EXPIRING_SOON_TIME:()=>i,EXPIRING:()=>o,EXPIRING_SOON:()=>l,EXPIRED:()=>c,casperMessagesStore:()=>m});a(57327),a(454747);var n=a(43229),r=2e3,s=6e4,i=1e4,o="expiring",l="expiring_soon",c="expired",d=[],u={},_={},g=0,m={add(e){var t=h(e),a=t[0],n=t[1],r=t[2],d=Math.max(a+n-s-r,0),g=Math.max(a+n-i-r,0),m=Math.max(a+n-r,0),f=setTimeout((()=>{p({type:o,message:e})}),d),v=setTimeout((()=>{p({type:l,message:e})}),g),b=setTimeout((()=>{p({type:c,message:e}),_[e.chat_local_id]=!0,delete u[e.chat_local_id]}),m);u[e.chat_local_id]={message:e,expiringTime:d,expiredTime:m,timers:[f,v,b]}},remove(e){this.has(e)&&(u[e].timers.forEach(clearTimeout),delete u[e])},setTimeshift(e){g=1e3*(e||0)},getTimings:e=>u[e]?h(u[e].message):[0,0,0],getExpireTime(e){if(!u[e])return 0;var t=h(u[e].message),a=t[0],n=t[1],r=t[2];return Math.max(Math.floor((a+n-r)/1e3),0)},isProcessed:e=>!!_[e],subscribe(e){d.push(e)},unsubscribe(e){d=d.filter((t=>t!==e))},has:e=>!!u[e],destroy(){u={},d=[],_={}}};function p(e){d.forEach((t=>t(e)))}function h(e){return[1e3*e.date+g,1e3*((0,n.getMessageTTL)(e)||0),Date.now()]}},934103:(e,t,a)=>{"use strict";a.d(t,{getNativeOption:()=>s,createScroll:()=>c});var n=a(610124),r=a(927766);function s(e,t){return document.body[e]||document.documentElement[e]}class i{constructor(e,t){this.el=e,this.opts=t,this.module=(0,n.createModule)({handlers:(e,t)=>{e(window,"scroll",this.onScroll.bind(this)),e(window,"resize",this.resize.bind(this))}}),this.innerHeight=window.innerHeight,this.prevScroll=this.scrollTop()}update(){}resize(){this.innerHeight=window.innerHeight}scrollTop(e){if(void 0===e)return s("scrollTop",this.el);!function(e,t,a){"scrollTop"===e&&window.scrollTo(0,t)}("scrollTop",e,this.el)}contHeight(){return s("scrollHeight")}smoothScroll(e){(0,r.scrollToY)(e+this.scrollTop(),300)}getContainer(){return this.el}getScroller(){return null}scrollBottom(e){if(void 0===e)return this.contHeight()-this.scrollTop()-this.getScrollHeight();var t=this.contHeight()-e-this.getScrollHeight();this.scrollTop(t)}scrollBottomFixSave(e){var t=Date.now(),a=()=>{Date.now()-t<500&&this.scrollBottom(e),window.removeEventListener("scroll",a)};window.addEventListener("scroll",a),this.scrollBottom(e)}onScroll(e){var t=this.scrollTop(),a=t-this.prevScroll,n=this.contHeight();this.opts.onScroll&&this.opts.onScroll(-a,this),this.opts.scrollChange&&this.opts.scrollChange(t),this.opts.more&&n-t<2*this.innerHeight&&this.opts.more(this),this.prevScroll=t}getScrollHeight(){return this.innerHeight}destroy(){(0,n.destroyModule)(this.module)}}class o{constructor(e,t){this.prevTop=0,this.scroll=new uiScroll(e,{hidden:void 0===t.hidden||t.hidden,shadows:t.shadows,stopScrollPropagation:!1,theme:t.scrollTheme,onmore:()=>t.more&&t.more(this),onscroll:e=>{var a=this.scrollTop(),n=this.prevTop-a;this.prevTop=a,t.scrollChange&&t.scrollChange(a),t.onScroll&&t.onScroll(n,this)}})}update(){this.scroll.update("sync")}scrollTop(e){return void 0!==e?this.scroll.scrollTop(e):this.scroll.data.scrollTop}getContainer(){return this.scroll.content}getScroller(){return this.scroll.scroller}contHeight(){return this.scroll.data.scrollHeight}smoothScroll(e){this.scroll.scrollTop(this.scrollTop()+e,300)}scrollBottom(e){return void 0!==e?this.scroll.scrollBottom(e):this.scroll.data.scrollBottom}scrollBottomFixSave(e){var t=Date.now();this.scroll.emitter.addOnceListener("resize",(()=>{Date.now()-t<500&&this.scroll&&this.scrollBottom(e)})),this.scrollBottom(e)}getScrollHeight(){return this.scroll.data.viewportHeight}destroy(){this.scroll.destroy()}}class l{constructor(e,t){this.el=e}update(){}getContainer(){return this.el}getScroller(){return null}scrollTop(e){return 0}contHeight(){return 0}smoothScroll(e){}scrollBottom(e){return 0}scrollBottomFixSave(e){}getScrollHeight(){return 0}destroy(){}}function c(e,t){return t.noScroll?new l(e):t.nativeScroll?new i(e,t):new o(e,t)}},327125:(e,t,a)=>{"use strict";a.d(t,{statlogsValueEvent:()=>s,statlogsProbValueEvent:()=>i});var n=a(506770),r=a(798262);function s(e,t,a,n,s){return(0,r.statlogsValueEvent)(e,t,a,n,s)}function i(e,t,a,r,i,o){(0,n.randEnabled)(e)&&s(t,a,r,i,o)}},554846:(e,t,a)=>{"use strict";a.d(t,{Scroll:()=>o});a(682772);var n=a(785893),r=(a(667294),a(102957)),s=a(934103);function i(){return i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},i.apply(this,arguments)}var o=e=>{var t=e.children,a=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,["children"]);return(0,n.jsx)(r.ScrollContext.Provider,{value:{createScroll:s.createScroll},children:(0,n.jsx)(r.Scroll,i({},a,{children:t}))})};o.defaultProps={isNative:!1,isShadows:!1,neverHide:!1,onScroll:null}},859456:(e,t,a)=>{"use strict";a.d(t,{TOP_DOMAINS:()=>s,OUR_DOMAINS:()=>o,VK_DOMAIN:()=>l,RE_DOMAIN_PATTERN:()=>c});var n=a(570655),r=a(961540),s=(0,n.__spreadArray)((0,n.__spreadArray)((0,n.__spreadArray)([],(0,n.__read)("aaa,aarp,abarth,abb,abbott,abbvie,abc,able,abogado,abudhabi,ac,academy,accenture,accountant,accountants,aco,active,actor,ad,adac,ads,adult,ae,aeg,aero,aetna,af,afamilycompany,afl,africa,ag,agakhan,agency,ai,aig,aigo,airbus,airforce,airtel,akdn,al,alfaromeo,alibaba,alipay,allfinanz,allstate,ally,alsace,alstom,am,americanexpress,americanfamily,amex,amfam,amica,amsterdam,an,analytics,android,anquan,anz,ao,aol,apartments,app,apple,aq,aquarelle,ar,aramco,archi,army,arpa,art,arte,as,asda,asia,associates,at,athleta,attorney,au,auction,audi,audible,audio,auspost,author,auto,autos,avianca,aw,aws,ax,axa,az,azure,ba,baby,baidu,banamex,bananarepublic,band,bank,bar,barcelona,barclaycard,barclays,barefoot,bargains,baseball,basketball,bauhaus,bayern,bb,bbc,bbt,bbva,bcg,bcn,bd,be,beats,beauty,beer,bentley,berlin,best,bestbuy,bet,bf,bg,bh,bharti,bi,bible,bid,bike,bing,bingo,bio,biz,bj,bl,black,blackfriday,blanco,blockbuster,blog,bloomberg,blue,bm,bms,bmw,bn,bnl,bnpparibas,bo,boats,boehringer,bofa,bom,bond,boo,book,booking,boots,bosch,bostik,boston,bot,boutique,box,bq,br,bradesco,bridgestone,broadway,broker,brother,brussels,bs,bt,budapest,bugatti,build,builders,business,buy,buzz,bv,bw,by,bz,bzh,ca,cab,cafe,cal,call,calvinklein,cam,camera,camp,cancerresearch,canon,capetown,capital,capitalone,car,caravan,cards,care,career,careers,cars,cartier,casa,case,caseih,cash,casino,cat,catering,catholic,cba,cbn,cbre,cbs,cc,cd,ceb,center,ceo,cern,cf,cfa,cfd,cg,ch,chanel,channel,chase,chat,cheap,chintai,chloe,christmas,chrome,chrysler,church,ci,cipriani,circle,cisco,citadel,citi,citic,city,cityeats,ck,cl,claims,cleaning,click,clinic,clinique,clothing,cloud,club,clubmed,cm,cn,co,coach,codes,coffee,college,cologne,com,comcast,commbank,community,company,compare,computer,comsec,condos,construction,consulting,contact,contractors,cooking,cookingchannel,cool,coop,corsica,country,coupon,coupons,courses,cr,credit,creditcard,creditunion,cricket,crown,crs,cruise,cruises,csc,cu,cuisinella,cv,cw,cx,cy,cymru,cyou,cz,dabur,dad,dance,data,date,dating,datsun,day,dclk,dds,de,deal,dealer,deals,degree,delivery,dell,deloitte,delta,democrat,dental,dentist,desi,design,dev,dhl,diamonds,diet,digital,direct,directory,discount,discover,dish,diy,dj,dk,dm,dnp,do,docs,doctor,dodge,dog,doha,domains,dot,download,drive,dtv,dubai,duck,dunlop,duns,dupont,durban,dvag,dvr,dz,earth,eat,ec,eco,edeka,edu,education,ee,eg,eh,email,emerck,energy,engineer,engineering,enterprises,epost,epson,equipment,er,ericsson,erni,es,esq,estate,esurance,et,eu,eurovision,eus,events,everbank,exchange,expert,exposed,express,extraspace,fage,fail,fairwinds,faith,family,fan,fans,farm,farmers,fashion,fast,fedex,feedback,ferrari,ferrero,fi,fiat,fidelity,fido,film,final,finance,financial,fire,firestone,firmdale,fish,fishing,fit,fitness,fj,fk,flickr,flights,flir,florist,flowers,fly,fm,fo,foo,food,foodnetwork,football,ford,forex,forsale,forum,foundation,fox,fr,free,fresenius,frl,frogans,frontdoor,frontier,ftr,fujitsu,fujixerox,fun,fund,furniture,futbol,fyi,ga,gal,gallery,gallo,gallup,game,games,gap,garden,gb,gbiz,gd,gdn,ge,gea,gent,genting,george,gf,gg,ggee,gh,gi,gift,gifts,gives,giving,gl,glade,glass,gle,global,globo,gm,gmail,gmbh,gmo,gmx,gn,godaddy,gold,goldpoint,golf,goo,goodhands,goodyear,goog,google,gop,got,gov,gp,gq,gr,grainger,graphics,gratis,green,gripe,group,gs,gt,gu,guardian,gucci,guge,guide,guitars,guru,gw,gy,hair,hamburg,hangout,haus,hbo,hdfc,hdfcbank,health,healthcare,help,helsinki,here,hermes,hgtv,hiphop,hisamitsu,hitachi,hiv,hk,hkt,hm,hn,hockey,holdings,holiday,homedepot,homegoods,homes,homesense,honda,honeywell,horse,hospital,host,hosting,hot,hoteles,hotmail,house,how,hr,hsbc,ht,htc,hu,hughes,hyatt,hyundai,ibm,icbc,ice,icu,id,ie,ieee,ifm,ikano,il,im,imamat,imdb,immo,immobilien,in,industries,infiniti,info,ing,ink,institute,insurance,insure,int,intel,international,intuit,investments,io,ipiranga,iq,ir,irish,is,iselect,ismaili,ist,istanbul,it,itau,itv,iveco,iwc,jaguar,java,jcb,jcp,je,jeep,jetzt,jewelry,jio,jlc,jll,jm,jmp,jnj,jo,jobs,joburg,jot,joy,jp,jpmorgan,jprs,juegos,juniper,kaufen,kddi,ke,kerryhotels,kerrylogistics,kerryproperties,kfh,kg,kh,ki,kia,kim,kinder,kindle,kitchen,kiwi,km,kn,koeln,komatsu,kosher,kp,kpmg,kpn,kr,krd,kred,kuokgroup,kw,ky,kyoto,kz,la,lacaixa,ladbrokes,lamborghini,lamer,lancaster,lancia,lancome,land,landrover,lanxess,lasalle,lat,latino,latrobe,law,lawyer,lb,lc,lds,lease,leclerc,lefrak,legal,lego,lexus,lgbt,li,liaison,lidl,life,lifeinsurance,lifestyle,lighting,like,lilly,limited,limo,lincoln,linde,link,lipsy,live,living,lixil,lk,loan,loans,local,locker,locus,loft,lol,london,lotte,lotto,love,lpl,lplfinancial,lr,ls,lt,ltd,ltda,lu,lundbeck,lupin,luxe,luxury,lv,ly,ma,macys,madrid,maif,maison,makeup,man,management,mango,market,marketing,markets,marriott,marshalls,maserati,mattel,mba,mc,mcd,mcdonalds,mckinsey,md,me,med,media,meet,melbourne,meme,memorial,men,menu,meo,metlife,mf,mg,mh,miami,microsoft,mil,mini,mint,mit,mitsubishi,mk,ml,mlb,mls,mm,mma,mn,mo,mobi,mobile,mobily,moda,moe,moi,mom,monash,money,monster,montblanc,mopar,mormon,mortgage,moscow,moto,motorcycles,mov,movie,movistar,mp,mq,mr,ms,msd,mt,mtn,mtpc,mtr,mu,museum,mutual,mv,mw,mx,my,mz,na,nab,nadex,nagoya,name,nationwide,natura,navy,nba,nc,ne,nec,net,netbank,netflix,network,neustar,new,newholland,news,next,nextdirect,nexus,nf,nfl,ng,ngo,nhk,ni,nico,nike,nikon,ninja,nissan,nissay,nl,no,nokia,northwesternmutual,norton,now,nowruz,nowtv,np,nr,nra,nrw,ntt,nu,nyc,nz,obi,observer,off,office,okinawa,olayan,olayangroup,oldnavy,ollo,om,omega,one,ong,onl,online,onyourside,ooo,open,oracle,orange,org,organic,orientexpress,origins,osaka,otsuka,ott,ovh,pa,page,pamperedchef,panasonic,panerai,paris,pars,partners,parts,party,passagens,pay,pccw,pe,pet,pf,pfizer,pg,ph,pharmacy,philips,phone,photo,photography,photos,physio,piaget,pics,pictet,pictures,pid,pin,ping,pink,pioneer,pizza,pk,pl,place,play,playstation,plumbing,plus,pm,pn,pnc,pohl,poker,politie,porn,post,pr,pramerica,praxi,press,prime,pro,prod,productions,prof,progressive,promo,properties,property,protection,pru,prudential,ps,pt,pub,pw,pwc,py,qa,qpon,quebec,quest,qvc,racing,radio,raid,re,read,realestate,realtor,realty,recipes,red,redstone,redumbrella,rehab,reise,reisen,reit,reliance,ren,rent,rentals,repair,report,republican,rest,restaurant,review,reviews,rexroth,rich,richardli,ricoh,rightathome,ril,rio,rip,rmit,ro,rocher,rocks,rodeo,rogers,room,rs,rsvp,ru,ruhr,run,rw,rwe,ryukyu,sa,saarland,safe,safety,sakura,sale,salon,samsclub,samsung,sandvik,sandvikcoromant,sanofi,sap,sapo,sarl,sas,save,saxo,sb,sbi,sbs,sc,sca,scb,schaeffler,schmidt,scholarships,school,schule,schwarz,science,scjohnson,scor,scot,sd,se,seat,secure,security,seek,select,sener,services,ses,seven,sew,sex,sexy,sfr,sg,sh,shangrila,sharp,shaw,shell,shia,shiksha,shoes,shop,shopping,shouji,show,showtime,shriram,si,silk,sina,singles,site,sj,sk,ski,skin,sky,skype,sl,sling,sm,smart,smile,sn,sncf,so,soccer,social,softbank,software,sohu,solar,solutions,song,sony,soy,space,spiegel,spot,spreadbetting,sr,srl,srt,ss,st,stada,staples,star,starhub,statebank,statefarm,statoil,stc,stcgroup,stockholm,storage,store,stream,studio,study,style,su,sucks,supplies,supply,support,surf,surgery,suzuki,sv,swatch,swiftcover,swiss,sx,sy,sydney,symantec,systems,sz,tab,taipei,talk,taobao,target,tatamotors,tatar,tattoo,tax,taxi,tc,tci,td,tdk,team,tech,technology,tel,telecity,telefonica,temasek,tennis,teva,tf,tg,th,thd,theater,theatre,tiaa,tickets,tienda,tiffany,tips,tires,tirol,tj,tjmaxx,tjx,tk,tkmaxx,tl,tm,tmall,tn,to,today,tokyo,tools,top,toray,toshiba,total,tours,town,toyota,toys,tp,tr,trade,trading,training,travel,travelchannel,travelers,travelersinsurance,trust,trv,tt,tube,tui,tunes,tushu,tv,tvs,tw,tz,ua,ubank,ubs,uconnect,ug,uk,um,unicom,university,uno,uol,ups,us,uy,uz,va,vacations,vana,vanguard,vc,ve,vegas,ventures,verisign,vermögensberater,vermögensberatung,versicherung,vet,vg,vi,viajes,video,vig,viking,villas,vin,vip,virgin,visa,vision,vista,vistaprint,viva,vivo,vlaanderen,vn,vodka,volkswagen,volvo,vote,voting,voto,voyage,vu,vuelos,wales,walmart,walter,wang,wanggou,warman,watch,watches,weather,weatherchannel,webcam,weber,website,wed,wedding,weibo,weir,wf,whoswho,wien,wiki,williamhill,win,windows,wine,winners,wme,wolterskluwer,woodside,work,works,world,wow,ws,wtc,wtf,xbox,xerox,xfinity,xihuan,xin,xperia,xxx,xyz,yachts,yahoo,yamaxun,yandex,ye,yodobashi,yoga,yokohama,you,youtube,yt,yu,yun,za,zappos,zara,zero,zip,zippo,zm,zone,zuerich,zw".split(",")),!1),(0,n.__read)("бг,бел,дети,ею,католик,ком,мкд,мон,москва,онлайн,орг,рус,рф,сайт,срб,укр".split(",")),!1),(0,n.__read)("qxam,90ae,90ais,d1acj3b,e1a4c,80aqecdr1a,j1aef,d1alf,l1acc,80adxhks,80asehdb,c1avg,p1acf,p1ai,80aswg,90a3ac,j1amh,80ao21a,y9a3aq,9dbq2a,mgbca7dzdo,mgba3a3ejt,mgbayh7gpa,lgbbat1ad8j,mgberp4a5d4ar,mgba7c0bbn0a,mgbc0a9azcg,mgb2ddes,mgbaam7a8h,mgba3a4f16a,mgbbh1a,mgbab2bd,ngbe9e0a,mgbbh1a71e,pgbs0dh,mgbpl2fh,ogbpf8fl,ngbc5azd,mgbtx2b,mgb9awbf,ygbi2ammx,wgbl6a,mgbi4ecexp,fhbei,wgbh1c,mgbx4cd0ab,mgbb9fbpob,4gbrim,mgbt3dhd,mgbai9azgqp6j,mgbgu82a,11b4c3d,c2br7g,h2brj9c,h2breg3eve,h2brj9c8c,i1b6b1a6a2e,54b7fta0cc,45brj9c,45br5cyl,s9brj9c,gecrj9c,3hcrj9c,xkc2dl3a5ee0h,xkc2al3hye2a,clchc0ea0b2g2a9gcd,fpcrj9c3d,2scrj9c,rvc1e0am3e,fzc2c9e2c,42c2d9a,o3cw4h,node,q9jyb4c,gckr3f0f,qcka1pmc,tckwe,cck2b3b,1ck2e1b,bck1b9a5dre4c,eckvdtc9d,rhqv96g,fiq64b,fiqs8s,fiqz9s,fiq228c5hs,vhquv,1qqw23a,vuq861b,nyqy26a,45q11c,55qx5d,55qw42g,kprw13d,kpry57d,czru2d,czrs0t,czr694b,w4rs40l,w4r85el8fhu5dnra,3ds443g,3oq18vl8pn36a,pssy2u,tiq49xqyj,fjq720a,fct429k,estv75g,xhq521b,9krt00a,30rr7y,6qq986b3xl,kput3i,kpu716f,zfr164b,mxtq1m,yfro4i67o,efvy88h,9et52u,rovu88b,nqv7f,b4w605ferd,unup4y,mix891f,mix082f,3pxu8k,pbt977c,6frz82g,nqv7fs00ema,ses554g,hxt814e,5tzm5g,io0a7i,8y0a063a,jlq61u9w7b,flw351e,g2xx48c,gk3at1e,3bst00m,fzys8d69uvgm,kcrx77d1x4a,jvr189m,imr513n,5su34j936bgsg,j6w193g,t60b56a,mk1bu44c,cg4bki,3e0b707e".split(",").map((function(e){return"xn--"+e}))),!1),i=r.VK_HOST_REGEX_GROUP_UNSAFE.source,o=new RegExp("^([a-zA-Z0-9\\.\\_\\-]+\\.)?("+i+"|vk\\.cc)$"),l=new RegExp("^(?:https?:\\/\\/)?(?:"+r.VK_SITES_REGEX_SOURCE_UNSAFE+")?\\/([a-zA-Z0-9\\._]+)\\??$"),c="((?:[a-z0-9_]*[a-z0-9])?(?:(?:\\.[a-z](?:[a-z0-9_]+[a-z0-9])?)*\\.[a-z][a-z0-9_]{2,40}[a-z0-9])?)"},955686:(e,t,a)=>{"use strict";a.d(t,{EMAIL:()=>r});var n=a(474212),r=new RegExp("([a-zA-Zа-яА-Я\\-_\\.0-9\\+]+@("+n.RE_URL_DOMAIN_NAME+n.RE_URL_DOMAIN_TOP+"))","ig")},166763:(e,t,a)=>{"use strict";a.d(t,{RE_HASHTAG_EXTRACTION_PATTERN:()=>s,HASHTAG_ENTITIES_ALL:()=>i,HASHTAG_ENTITIES_NEW:()=>o,RE_HASHTAG_EXTRACTION_PATTERN_NEW:()=>c});var n=a(859456),r="a-zA-Zа-яА-ЯёіјєїґўЁІЈЄЇҐЎ’",s="(^|[s.,:'\";>)(]?)((#(?:[a-zA-Zа-яА-ЯёіјєїґўЁІЈЄЇҐЎ’_\\d]|(?:&#(?:19[2-9]|(?:[2-9]|1[0-3])[0-9][0-9]);?)){0,100}(?:[a-zA-Zа-яА-ЯёіјєїґўЁІЈЄЇҐЎ’]|(?:&#(?:19[2-9]|(?:[2-9]|1[0-3])[0-9][0-9]);?))(?:[a-zA-Zа-яА-ЯёіјєїґўЁІЈЄЇҐЎ’_\\d]|(?:&#(?:19[2-9]|(?:[2-9]|1[0-3])[0-9][0-9]);?)){0,100}))(@"+n.RE_DOMAIN_PATTERN+")?(?=$|[s.,:'\"&;?<)(]?)",i="&#(\\d{3,5});",o="(?:&#\\d{3,5};)",l="(?:["+r+"_\\d]|"+o+")",c="(^|[s.,:'\";>)(]?)("+("(#"+l+"{0,100}"+("(?:["+r+"]|"+o+")")+l+"{0,100})")+")(@"+n.RE_DOMAIN_PATTERN+")?(?=$|[s.,:'\"&;?<)(]?)"},123265:(e,t,a)=>{"use strict";a.d(t,{MENTION:()=>n});var n=/\[(id|club)(\d+)(?:\:([a-z0-9_\-]+))?\|([^\$]+?)\]/g},474212:(e,t,a)=>{"use strict";a.d(t,{RE_URL_DOMAIN_NAME:()=>n,RE_URL_DOMAIN_TOP:()=>r,RE_URL_PATTERN:()=>s});var n="((?:[\\w\\$А-Яа-яёЁєЄҐґЇїІіЈј\\—\\-\\_]+\\.){1,5})",r="([A-Za-zа-яА-Я\\-\\d]{2,22})",s="(https?:\\/\\/)?"+("("+n+r+"(?:\\:(\\d{2,5}))?)")+"(([\\/?#])(?:\\&amp;|\\&#\\d{2,6};|,[_%]|!|,*[\\wА-Яа-я\\xa8\\xb8\\xc0-\\xffєЄҐґЇїІіЈј\\—\\-\\_@#%?+\\/\\$.~=;:'ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠ-ࢴࢶ-ࢽऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛱ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢄᢇ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲈᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿕ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞮꞰ-ꞷꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭥꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ　-〿＀-￯*]+|(?:\\(|\\[)[\\w\\$А-Яа-яёЁєЄҐґЇїІіЈј\\d&#%;,]+(?:\\)|\\])){0,200})?"},887294:(e,t,a)=>{"use strict";a.d(t,{post:()=>i,plaingetCancelable:()=>o});var n=a(570655),r=a(555030),s=a(638736);function i(e,t,a){return t&&(t.im_v=3),new Promise((function(r,s){window.ajax.post(e,t,{timeout:a,onDone:function(){r.apply(null,[(0,n.__spreadArray)([],(0,n.__read)(arguments),!1)])},onFail:function(){return s.apply(null,(0,n.__spreadArray)([],(0,n.__read)(arguments),!1)),!0}})}))}function o(e,t,a){void 0===a&&(a={});var n=new XMLHttpRequest;return{request:new Promise((function(i,o){var l,c=Date.now(),d=a.timeout||60,u=(0,r.toQueryString)(t);n.onreadystatechange=function(){if(4==n.readyState){if(window.clearInterval(l),(0,s.processWaf)(n))return;n.status>=200&&n.status<300?i([n.responseText,n]):o([n.responseText,n])}};try{n.open("GET",e+"?"+u,!0)}catch(e){return o([e,n])}n.send(),l=window.setInterval((function(){Date.now()-c>1e3*d&&(window.browser.safari&&n.abort(),o(["",{}]),window.clearInterval(l))}),1e3)})),cancel:function(){n.abort()}}}},940441:(e,t,a)=>{"use strict";a.d(t,{customMetricsCollector:()=>r});var n=a(214547),r=new(function(){function e(){this.productionStatCollector=new n.ProductionStatCollector,this.actionStatCollector=new n.ActionStatCollector(this.productionStatCollector)}return e.prototype.logEvent=function(e){return this.actionStatCollector.logEvent({type:"type_ab_custom_metrics_item",type_ab_custom_metrics_item:e})},e}())},724702:(e,t,a)=>{"use strict";a.d(t,{messagingActionItemStatCollector:()=>r});var n=a(214547),r=new(function(){function e(){this.productStatCollector=new n.ProductionStatCollector,this.actionStatCollector=new n.ActionStatCollector(this.productStatCollector)}return e.prototype.logEvent=function(e){var t={type:"type_messaging_action_item",type_messaging_action_item:e};this.actionStatCollector.logEvent(t)},e}())},746133:(e,t,a)=>{"use strict";a.d(t,{audioMessageStatCollector:()=>r});var n=a(214547),r=new(function(){function e(){this.productStatCollector=new n.ProductionStatCollector,this.actionStatCollector=new n.ActionStatCollector(this.productStatCollector)}return e.prototype.logEvent=function(e){var t={type:"type_messaging_audio_message_item",type_messaging_audio_message_item:e};this.actionStatCollector.logEvent(t)},e}())},676554:(e,t,a)=>{"use strict";a.d(t,{ContactRecommendationCollector:()=>s});var n=a(740517),r=a(214547),s=new(function(){function e(){this.productionStatCollector=new r.ProductionStatCollector,this.clickStatCollector=new r.ClickStatCollector(this.productionStatCollector),this.actionStatCollector=new r.ActionStatCollector(this.productionStatCollector)}return e.prototype.logEvent=function(e){switch(e.event_type){case"click":var t={type:"type_messaging_contact_recommendations_item",position:e.position,type_messaging_contact_recommendations_item:e},a={type:n.EventItemType.TYPE_MESSAGING_CONTACT_RECOMMENDATIONS_ITEM};return this.clickStatCollector.logEvent(t,a);case"show":case"hide":t={type:"type_messaging_contact_recommendations_item",type_messaging_contact_recommendations_item:e};return this.actionStatCollector.logEvent(t)}},e}())},832656:(e,t,a)=>{"use strict";a.d(t,{replaceEmailLinks:()=>r});var n=a(955686);function r(e,t){return e.replace(n.EMAIL,t||function(e){return'<a href="mailto:'+e+'">'+e+"</a>"})}},978613:(e,t,a)=>{"use strict";a.d(t,{replaceHashtags:()=>c});var n,r=a(570655),s=a(166763),i=a(506770);var o=[[192,1399],[12352,12543],[19968,40959],[44032,55215]];function l(e){var t,a,n,i=null===(n=e.match(s.HASHTAG_ENTITIES_ALL))||void 0===n?void 0:n[1];if(!i)return!1;var l=parseInt(i);try{for(var c=(0,r.__values)(o),d=c.next();!d.done;d=c.next()){var u=d.value;if(l>=u[0]&&l<=u[1])return!0}}catch(e){t={error:e}}finally{try{d&&!d.done&&(a=c.return)&&a.call(c)}finally{if(t)throw t.error}}return!1}function c(e,t){return e.replace((n||(n=(0,i.partConfigEnabled)("new_hashtags_parser")?new RegExp(s.RE_HASHTAG_EXTRACTION_PATTERN_NEW,"ig"):new RegExp(s.RE_HASHTAG_EXTRACTION_PATTERN,"ig")),n),(function(e,a,n,o,c){var d,u,_="";if((0,i.partConfigEnabled)("new_hashtags_parser")){var g=n.matchAll(new RegExp(s.HASHTAG_ENTITIES_NEW,"ig"));try{for(var m=(0,r.__values)(g),p=m.next();!p.done;p=m.next()){var h=p.value;if(!l((0,r.__read)(h,1)[0])){_=n.slice(h.index),n=n.slice(0,h.index);break}}}catch(e){d={error:e}}finally{try{p&&!p.done&&(u=m.return)&&u.call(m)}finally{if(d)throw d.error}}}return"#"===n?(a||"")+n+(c||"")+_:(a||"")+t(n+(c||""))+_}))}},820929:(e,t,a)=>{"use strict";a.d(t,{replaceHyperLinks:()=>c,linksReplacer:()=>d});var n=a(733164),r=a(474212),s=a(859456);function i(e){if(!e[0]||!e[6])return e;var t=e[0].length-1,a=e[6].length-1;return"."===e[0][t]&&"."===e[6][a]&&(e[0]=e[0].slice(0,t),e[6]=e[6].slice(0,a)),e}function o(e){return{full:e[0],protocol:e[1]||"http://",url:e[2],domain:e[4],query:e[6]||""}}function l(e){return e.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function c(e,t){for(var a,n=new RegExp(r.RE_URL_PATTERN,"ig"),l=s.TOP_DOMAINS.reduce((function(e,t){return Math.max(e,t.length)}),0),c=0,d=e;null!==(a=n.exec(e));){var u=(a=i(a))[0].length,_=a.index+u,g=e[a.index-1],m=e[_-1];if("@"!==e[_]||a[0]&&(!a[0]||a[0].toLowerCase().includes("http"))){var p=void 0!==g&&/([\w\$А-Яа-яёЁєЄҐґЇїІіЈј\—\-\_@;.])/i.test(g),h=void 0!==m&&/([:;$])/i.test(m);if(!p&&!h){var f=o(a),v=f.domain.toLowerCase();if(v.length<=l&&s.TOP_DOMAINS.includes(v)){var b=t(f);d=d.slice(0,a.index+c)+b+d.slice(_+c),c+=b.length-u}}}}return d}function d(e,t){void 0===t&&(t=55);var a=e.full,r=e.url,i=e.protocol,o=e.query;try{a=decodeURIComponent(a)}catch(e){}a.length>t&&(a=a.substr(0,t-2)+".."),a=l(a).replace(/\n/g," ");var c=(0,n.replaceEntities)(r+o);if(s.OUR_DOMAINS.test(r)){var d="",u=a.match(s.VK_DOMAIN);if(u)d=' mention_id="'+u[1]+'" onclick="return mentionClick(this, event)" onmouseover="mentionOver(this)"';return'<a href="'+l(i+r+o)+'" target="_blank" rel="noopener"'+d+">"+a+"</a>"}return'<a href="'+("away.php?utf=1&to="+encodeURIComponent(i+c))+'" target="_blank" rel="noopener" onclick="'+("return goAway('"+(0,n.clean)((i+r+o).replace(/'/g,"\\'"))+"', {}, event);")+'">'+a+"</a>"}},397698:(e,t,a)=>{"use strict";a.d(t,{replaceMassMentions:()=>r});var n=a(722199);function r(e,t){return e.replace(n.MASS_MENTION_REGEXP,(function(e){return t?t(e,"","",e,e):'<span class="mem_pseudolink" data-mention="'+e.slice(1).toLowerCase()+'">'+e+"</span>"}))}},640157:(e,t,a)=>{"use strict";a.d(t,{replaceMentions:()=>s});var n=a(123265),r=a(733164);function s(e,t){return e.replace(n.MENTION,t||function(e,t,a,n,s){return'<a href="/'+(t+a)+'" class="mem_link" mention="'+(0,r.clean)(n||"")+'" mention_id="'+(0,r.clean)(t+a)+'" onclick="return mentionClick(this, event)" onmouseover="mentionOver(this)">'+s+"</a>"})}},610124:(e,t,a)=>{"use strict";a.d(t,{createMutations:()=>i,createModule:()=>c,destroyModule:()=>d});var n=a(570655),r=a(719711),s=a(152278);function i(e){return{callMutations:function(){if("function"==typeof e)throw console.trace(),new Error("Mutations are not initialized");return e},bindMutations:function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];if("function"!=typeof e)throw console.trace(),new Error("Mutations are already initialized");return e=e.apply(void 0,(0,n.__spreadArray)([],(0,n.__read)(t),!1))}}}function o(e,t,a,n){(0,s.addEvent)(t,a,n),e._registeredHandlers.push({handlerType:"bind",elem:t,types:a,handler:n})}function l(e,t,a,n,s,i){(0,r.addDelegateEvent)(t,a,n,s,i),e._registeredHandlers.push({handlerType:"delegate",elem:t,types:a,selector:n,handler:s})}function c(e){var t={_registeredHandlers:[]};return e.handlers((function(){for(var e=[],a=0;a<arguments.length;a++)e[a]=arguments[a];return o.apply(void 0,(0,n.__spreadArray)([t],(0,n.__read)(e),!1))}),(function(){for(var e=[],a=0;a<arguments.length;a++)e[a]=arguments[a];return l.apply(void 0,(0,n.__spreadArray)([t],(0,n.__read)(e),!1))})),t}function d(e){e._registeredHandlers.forEach((function(e){var t=e.handlerType,a=e.elem,n=e.types,i=e.handler;"delegate"===t?(0,r.removeDelegateEvent)(a,n,e.selector,i):(0,s.removeEvent)(a,n,i)})),e._registeredHandlers=[]}},283303:(e,t,a)=>{"use strict";a.d(t,{updateLocation:()=>r,updateLazyLocation:()=>s});var n=a(342269);function r(e){var t=(0,n.extend)({},window.nav.objLoc,e);Object.keys(t).filter((function(e){return""===t[e]})).forEach((function(e){delete t[e]}));var a=window.nav.toStr(t);window.nav.setLoc(a)}function s(){var e={};return{scheduleNav:function(t){e=(0,n.extend)(e,t)},commitNav:function(){r(e),e={}},scheduleNavWithTimeOut:function(t,a){void 0===a&&(a=100),e=(0,n.extend)(e,t),setTimeout((function(){r(e),e={}}),a)}}}},145072:(e,t,a)=>{"use strict";a.d(t,{MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE:()=>d,MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_STYLE:()=>u,MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN:()=>_,MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE:()=>g,MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS:()=>m,MAIL_CHAT_FLAG_SERVICE_CHAT:()=>p,MAIL_CHAT_FLAG_IS_FAKE_CHANNEL:()=>h,MAIL_CHAT_FLAG_IS_BUSINESS_NOTIFY:()=>f,MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE:()=>v,MAIL_CHAT_FLAG_IS_CASPER:()=>b,MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT:()=>C,MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT_DELETED:()=>T,MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_MASS_MENTION:()=>E,MAIL_CHAT_FLAG_ONLY_OWNER_CAN_MASS_MENTION:()=>I,MAIL_CHAT_FLAG_ONLY_OWNER_CAN_INVITE:()=>L,MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_TITLE:()=>y,MAIL_CHAT_FLAG_ONLY_OWNER_CAN_PIN:()=>A,MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_SEE_INVITE_LINK:()=>S,MAIL_CHAT_FLAG_ONLY_OWNER_CAN_SEE_INVITE_LINK:()=>k,MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CALL:()=>M,MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CALL:()=>R,MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_STYLE:()=>w,canSeeInviteLink:()=>O,canMassMention:()=>P,canChangeInviteLink:()=>x,canAddAdmin:()=>D,canInviteUser:()=>F,canKickUser:()=>H,canPinOrUnpin:()=>U,canStartGroupCall:()=>B,canChangeTitle:()=>j,canSeeAllMessages:()=>G,canSeeSettingsItem:()=>q,canCloseChat:()=>V,isUserAdminInChat:()=>K,isUserOwnerInChat:()=>z});var n,r,s=a(570655),i=a(67328),o=a(459554),l=a(993421),c=a(844142),d=1,u=2,_=4,g=8,m=16,p=64,h=1024,f=4096,v=16384,b=32768,C=1<<17,T=1<<18,E=1<<19,I=1<<20,L=1<<21,y=1<<22,A=1<<23,S=1<<24,k=1<<25,M=1<<26,R=1<<27,w=1<<31;!function(e){e.SEE_INVITE_LINK="see_invite_link",e.CHANGE_INVITE_LINK="change_invite_link",e.INVITE_USER="invite_user",e.PIN_OR_UNPIN="pin_unpin",e.CHANGE_TITLE="change_title",e.ADD_ADMIN="add_admin",e.MASS_MENTION="mass_mention",e.START_GROUP_CALL="call",e.CHANGE_STYLE="change_style"}(r||(r={}));var N=((n={})[r.CHANGE_INVITE_LINK]=[32,32],n[r.ADD_ADMIN]=[m,m],n[r.SEE_INVITE_LINK]=[S,k],n[r.INVITE_USER]=[d,L],n[r.PIN_OR_UNPIN]=[_,A],n[r.CHANGE_TITLE]=[g,y],n[r.MASS_MENTION]=[E,I],n[r.START_GROUP_CALL]=[M,R],n[r.CHANGE_STYLE]=[u,w],n);function O(e,t,a){return Y(e,r.SEE_INVITE_LINK,t,a)}function P(e,t,a){return Y(e,r.MASS_MENTION,t,a)}function x(e,t,a){return Y(e,r.CHANGE_INVITE_LINK,t,a)}function D(e,t,a,n){var s=(0,i.unpackStore)(e),l=a||s.peer,c=(0,o.getTab)(s,l);return!(!c||!(0,o.isChatConvo)(c))&&(!z(c,t)&&Y(e,r.ADD_ADMIN,l,n))}function F(e,t,a){return Y(e,r.INVITE_USER,t,a)}function H(e,t,a,n){if(function(e,t){var a=(0,i.unpackStore)(e);return void 0!==a.service&&(a.service&t)>0}(e,1))return!0;var r=(0,i.unpackStore)(e),s=a||r.peer,l=void 0===n?r.viewer_id:n,c=r.gid,d=(0,o.getTab)(r,s);return!(!d||!(0,o.isChatConvoWithDetails)(d))&&(!(d.data.kicked&&!d.data.closed)&&(!(0,o.isChannelPeer)(d)&&(!z(d,t)&&(!!z(d,l)||(!(!c||!z(d,-c))||(K(d,l)||function(e,t){return e.invitedByMe.includes(t)}(d,t))&&!K(d,t))))))}function U(e,t,a){return Y(e,r.PIN_OR_UNPIN,t,a)}function B(e,t,a){return Y(e,r.START_GROUP_CALL,t,a)}function j(e,t,a){return Y(e,r.CHANGE_TITLE,t,a)}function G(e,t,a){var n=(0,i.unpackStore)(e),r=a||n.viewer_id,s=t||(0,l.getPeer)(e);if(!c.Ranges.isGroupId(r))return!0;var d=(0,o.getTab)(e,s);return!(!d||!(0,o.isChatConvoWithDetails)(d))&&!!d.caccess[r]}function q(e,t,a){var n=(0,i.unpackStore)(e),r=a||n.viewer_id,s=t||(0,l.getPeer)(e),c=(0,o.getTab)(e,s);if(!c||!(0,o.isChatConvoWithDetails)(c))return!1;var d=(0,o.isChannelPeer)(c);if(!(0,o.isCommunityChat)(c))return z(c,r)&&!d;var u=(0,o.isChatActive)(c),_=z(c,-n.gid)&&u||K(c,r)&&u,g=(c.allowedUpdateFlags||[]).filter((function(e){return e!==v}));return _&&g.length>0}function V(e,t,a){var n=(0,i.unpackStore)(e),r=a||n.viewer_id,s=t||(0,l.getPeer)(e),c=(0,o.getTab)(e,s);if(!c||!(0,o.isChatConvoWithDetails)(c))return!1;var d=(0,o.isCommunityChat)(c),u=(0,o.isCommunityChatDeleted)(c),_=(0,o.isChatActive)(c),g=z(c,-n.gid)&&_||K(c,r)&&_;return d&&!u&&g&&(c.allowedUpdateFlags||[]).includes(v)}function Y(e,t,a,n){var c,d,u=(0,i.unpackStore)(e),_=(0,l.isCommunityInterface)(e)?u.id:u.viewer_id,g=void 0===n?_:n,m=void 0===a?u.peer:a,p=(0,o.getTab)(u,m);if(!p||!(0,o.isChatConvo)(p))return!1;var h=(0,o.isChatActive)(p),f=(0,s.__read)(N[t],2),v=f[0],b=f[1],C=b|v,T=(0,o.isChannelPeer)(p),E=z(p,g)&&h,I=E||K(p,g)&&h;if(T)switch(t){case r.ADD_ADMIN:case r.INVITE_USER:return!1;case r.SEE_INVITE_LINK:return h;default:return(0,l.isCommunityInterface)(u)}if((0,o.isCommunityChat)(p)){if((0,o.isClosedChat)(p))return!1;switch(t){case r.SEE_INVITE_LINK:return(0,o.isServiceChatTab)(p)?h:(0,o.doesChatTabHaveFlag)(p,C)?(0,o.doesChatTabHaveFlag)(p,b)?h:I:E;case r.CHANGE_INVITE_LINK:return E||I;case r.ADD_ADMIN:return(0,o.doesChatTabHaveFlag)(p,C)?I:E;case r.MASS_MENTION:case r.START_GROUP_CALL:return(0,o.isServiceChatTab)(p)?h:!E&&((0,o.doesChatTabHaveFlag)(p,C)?I:h);case r.INVITE_USER:return(0,o.isServiceChatTab)(p)?h:!(E&&!p.isDonutChat)&&("chats"!==(null===(d=null===(c=window.nav)||void 0===c?void 0:c.objLoc)||void 0===d?void 0:d.act)&&((0,o.doesChatTabHaveFlag)(p,C)?I:h));case r.PIN_OR_UNPIN:case r.CHANGE_TITLE:return(0,o.isServiceChatTab)(p)?h:I;default:return!1}}switch(t){case r.CHANGE_INVITE_LINK:return(0,o.doesChatTabHaveFlag)(p,v)?I:E;case r.ADD_ADMIN:return(0,o.doesChatTabHaveFlag)(p,C)?I:E;case r.SEE_INVITE_LINK:return(0,o.doesChatTabHaveFlag)(p,C)?(0,o.doesChatTabHaveFlag)(p,b)?h:I:E;case r.INVITE_USER:case r.PIN_OR_UNPIN:case r.MASS_MENTION:case r.START_GROUP_CALL:case r.CHANGE_TITLE:return(0,o.doesChatTabHaveFlag)(p,C)?(0,o.doesChatTabHaveFlag)(p,v)?I:E:h}return!1}function K(e,t){return(e.adminIds||[]).includes(t)}function z(e,t){return e.ownerId===t}},459554:(e,t,a)=>{"use strict";a.d(t,{isFullyLoadedTab:()=>m,getTab:()=>p,isUnreadReactions:()=>h,shouldUseReactionsShortPolling:()=>f,isChatConvo:()=>v,isUserConvo:()=>b,isContactConvo:()=>C,isChatConvoWithDetails:()=>T,getTabSafe:()=>E,getCurrentTab:()=>I,isTabMarkedUnread:()=>L,tabIsMessageRequest:()=>y,tabIsBusinessNotification:()=>A,tabIsNotImportantMessageRequest:()=>S,tabIsArchived:()=>k,getLocalSortId:()=>M,isVKAgentPeer:()=>R,isMutedConvo:()=>w,doesChatTabHaveFlag:()=>N,isChannelPeer:()=>O,isCommunityChat:()=>P,isCommunityChatDeleted:()=>x,isCasperChatTab:()=>D,isBusinessNotifyTab:()=>F,isBusinessNotifyPeer:()=>H,isClosedChat:()=>U,isServiceChatTab:()=>B,canArchiveTab:()=>j,isChatActive:()=>G,isPinnedMessageHidden:()=>q,getRecommendedConvoList:()=>V,isRecommendedConvo:()=>Y,isConvoBusinessNotifyEnabled:()=>K,isUserEmptyScreenRich:()=>z,getPinnedMessage:()=>$,canBePinned:()=>W,getConvoInlineMenuActions:()=>Q,getConvoReactedPeerIds:()=>Z});var n=a(570655),r=a(67328),s=a(179288),i=a(993421),o=a(826338),l=a(145072),c=a(923876),d=a(412827),u=a(661711),_=a(844142),g=a(376473);function m(e,t){var a=p(e,t);return!(void 0===(null==a?void 0:a.history)||!(null==a?void 0:a.msgs))}function p(e,t){var a=(0,r.unpackStore)(e);return a.tabs&&a.tabs[t]}function h(e,t){return!!(0,i.getUnreadReactions)(e,t).size}function f(e){return!!e.short_poll_reactions}function v(e){return _.Ranges.isChatOrChannelPeer(e.peerId)}function b(e){return _.Ranges.isUserIdTransitional(e.peerId)&&!_.Ranges.isContactId(e.peerId)}function C(e){return _.Ranges.isContactId(e.peerId)}function T(e){return _.Ranges.isChatOrChannelPeer(e.peerId)&&!!e.notifications}function E(e,t){return p(e,void 0===t?0:t)}function I(e){return p(e,(0,i.getPeer)(e))}function L(e){return!!(e.folders&&e.folders&s.FOLDER_MASKS[s.FOLDER_MARKED_UNREAD])}function y(e){return Boolean(e.is_message_request||e.folders&&e.folders&s.FOLDER_MASKS[s.ConvoListFolder.MR]||e.folders&&e.folders&s.FOLDER_MASKS[s.FOLDER_MESSAGE_REQUEST_REJECTED])}function A(e){return!!(e.folders&&e.folders&s.FOLDER_MASKS[s.FOLDER_BUSINESS_NOTIFY])}function S(e){return Boolean(y(e)&&e.folders&&e.folders&s.FOLDER_MASKS[s.FOLDER_NOT_IMPORTANT_MESSAGE_REQUEST])}function k(e){return!!(e.folders&&e.folders&s.FOLDER_MASKS[s.FOLDER_ARCHIVE])}function M(e,t){var a=e.get().msg_local_ids_sort,n=a&&t.lastmsg&&a[t.lastmsg]||0;return n>0?2e9+n:t.minor_sort_id||0}function R(e){return 333==+e}function w(e,t){return!!e.mutedPeers&&e.mutedPeers.includes(t)}function N(e,t){return((e&&e.data&&e.data.flags||0)&t)>0}function O(e){return v(e)&&N(e,l.MAIL_CHAT_FLAG_IS_FAKE_CHANNEL)}function P(e){return v(e)&&N(e,l.MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT)}function x(e){return v(e)&&N(e,l.MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT_DELETED)}function D(e){return v(e)&&N(e,l.MAIL_CHAT_FLAG_IS_CASPER)}function F(e){return v(e)&&N(e,l.MAIL_CHAT_FLAG_IS_BUSINESS_NOTIFY)}function H(e,t){var a;return!!(null===(a=(0,r.unpackStore)(e).dialog_tabs[s.ConvoListFolder.BUSINESS_NOTIFY])||void 0===a?void 0:a.includes(t))}function U(e){return v(e)&&N(e,l.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE)}function B(e){return v(e)&&N(e,l.MAIL_CHAT_FLAG_SERVICE_CHAT)}function j(e){var t=!!e.offset||!!e.lastmsg;return!(100==+e.peerId||(0,u.isPeerCurrentUser)(e.peerId)||_.Ranges.isContactId(e.peerId)||D(e))&&t&&!y(e)}function G(e){return!e.data.closed&&!e.data.kicked}function q(e){var t=e.pinned&&(0,d.parseMessage)(e.pinned);return!!t&&e.pinHideId===t.chat_local_id}function V(e){return(0,r.unpackStore)(e).recommendationList}function Y(e,t){var a=(0,r.unpackStore)(e).recommendationList;return Boolean(a&&a.item_data[t])}function K(e){return!!e.can_send_business_notify}function z(e,t){var a=(0,r.unpackStore)(e),n=p(a,t);return _.Ranges.isUserIdTransitional(t)&&!_.Ranges.isContactId(t)&&!(0,c.isDialogWithYourself)(a.id,t)&&!(0,i.isCommunityInterface)(a)&&!(n&&function(e){return!!b(e)&&Boolean(e.is_deleted)}(n))}function $(e){return e&&v(e)&&e.pinned?(0,d.parseMessage)(e.pinned):null}function W(e,t){var a=(0,r.unpackStore)(e),n=!!t.offset||!!t.lastmsg;return!(0,i.isCommunityInterface)(a)&&n&&!D(t)&&!y(t)&&!k(t)}function Q(e,t){var a=(0,r.unpackStore)(e),l=a.active_tab,d=(0,c.getConvoInlineMenuActionData)(t,(0,i.isCommunityInterface)(e)),u=[];switch(l){case s.ConvoListFolder.ALL:case s.ConvoListFolder.UNREAD:case s.ConvoListFolder.ARCHIVE:j(t)&&u.push(k(t)?s.ConvoAction.UNARCHIVE:s.ConvoAction.ARCHIVE),W(e,t)&&u.push((0,o.isPinnedSortId)(t.major_sort_id||0)?s.ConvoAction.UNPIN_CONVO:s.ConvoAction.PIN_CONVO),u.push(w(a,t.peerId)?s.ConvoAction.UNMUTE:s.ConvoAction.MUTE),u.push(s.ConvoAction.CLEAR),v(t)&&G(t)&&u.push(s.ConvoAction.LEAVE);break;case s.ConvoListFolder.BUSINESS_NOTIFY:u.push(w(a,t.peerId)?s.ConvoAction.UNMUTE:s.ConvoAction.MUTE),u.push(s.ConvoAction.LEAVE)}return u.map((function(e){return(0,n.__assign)((0,n.__assign)({},d[e]),{action:e})}))}function Z(e,t){var a=(0,r.unpackStore)(e),s=a.tabs[t].msgs||{},i=Object.values(s).reduce((function(e,r){var s=Array.isArray(r)?r[8]:r.chat_local_id,i=(0,g.getMessageReactedPeerIds)(a,t,s);return(0,n.__spreadArray)((0,n.__spreadArray)([],(0,n.__read)(i),!1),(0,n.__read)(e),!1)}),[]);return(0,n.__spreadArray)([],(0,n.__read)(new Set(i)),!1)}},578843:(e,t,a)=>{"use strict";a.d(t,{getEmptyFolderEls:()=>o,isEmptyFolder:()=>l,getConvoListFolderCounterDisplayed:()=>c,getConvoListFolderCounterTotal:()=>d,isConvoListFolderHidden:()=>u,getFolderUnreadCount:()=>_,getFolderMentionsCount:()=>g,getFolderInlineMenuActions:()=>m});var n=a(570655),r=a(712439),s=a(179288),i=a(820696);function o(e){var t=(0,r.unpackStore)(e);if(!t.dialog_tabs_all[t.active_tab])return[];switch(t.active_tab){case s.ConvoListFolder.MR:return[{type:"empty_message_requests"}];case s.ConvoListFolder.BUSINESS_NOTIFY:return[{type:"empty_business_notify"}];case s.ConvoListFolder.ARCHIVE:return[{type:"empty_archives"}];default:return[{type:"empty_dialogs"}]}}function l(e){var t,a=(0,r.unpackStore)(e);return!(null===(t=a.dialog_tabs[a.active_tab])||void 0===t?void 0:t.length)}function c(e,t){var a,n,i,o,l,c,d,u,_,g,m=(0,r.unpackStore)(e);switch(t){case s.ConvoListFolder.PEER_TAGS:g=0;break;case s.ConvoListFolder.BUSINESS_NOTIFY:g=null!==(i=null===(n=null===(a=m.dialog_tab_cts)||void 0===a?void 0:a[t])||void 0===n?void 0:n.unread)&&void 0!==i?i:0;break;case s.ConvoListFolder.ARCHIVE:g=null!==(c=null===(l=null===(o=m.dialog_tab_cts)||void 0===o?void 0:o[t])||void 0===l?void 0:l.unread)&&void 0!==c?c:0;break;default:g=null!==(_=null===(u=null===(d=m.dialog_tab_cts)||void 0===d?void 0:d[t])||void 0===u?void 0:u.total)&&void 0!==_?_:0}return Math.min(g,999)}function d(e,t){var a,n,i,o=(0,r.unpackStore)(e);return t===s.ConvoListFolder.PEER_TAGS?0:null!==(i=null===(n=null===(a=o.dialog_tab_cts)||void 0===a?void 0:a[t])||void 0===n?void 0:n.total)&&void 0!==i?i:0}function u(e,t){var a=(0,r.unpackStore)(e);switch(t){case s.ConvoListFolder.BUSINESS_NOTIFY:return!!a.settings.business_notify_folder_hidden||0===d(a,s.ConvoListFolder.BUSINESS_NOTIFY);case s.ConvoListFolder.ARCHIVE:return!!(a.dialog_tab_cts.archive&&a.dialog_tab_cts.archive.total<=0)||Boolean(a.settings.archives_folder_hidden);default:return!1}}function _(e,t){var a=c(e,t);return a?a<100?a.toString():"99+":""}function g(e,t){var a,n,s;return((null!==(s=null===(n=null===(a=(0,r.unpackStore)(e).dialog_tab_cts)||void 0===a?void 0:a[t])||void 0===n?void 0:n.mentions)&&void 0!==s?s:0)||"").toString()}function m(e,t){var a=(0,i.getFolderInlineMenuActionsData)(t),r=[];switch(t){case s.ConvoListFolder.BUSINESS_NOTIFY:case s.ConvoListFolder.ARCHIVE:d(e,t)>0&&u(e,t)&&r.push(s.FolderAction.SHOW)}return r.map((function(e){return(0,n.__assign)({action:e},a[e])}))}},376473:(e,t,a)=>{"use strict";a.d(t,{getMessage:()=>u,getMessageByCmid:()=>_,isMessageStored:()=>g,isVoiceMessageListened:()=>m,isExistingRid:()=>p,getLastMessage:()=>h,getLastMeta:()=>f,getLocalId:()=>v,isOutbound:()=>b,isServiceMsg:()=>C,getPreviousMessage:()=>T,getMessageUserId:()=>E,getMessageAdminId:()=>I,isAppAction:()=>y,isGraffiti:()=>A,isAudioMsg:()=>S,isSticker:()=>k,isGift:()=>M,isMoney:()=>R,isMoneyRequest:()=>w,isVKPay:()=>N,isCasperMessage:()=>O,isWidgetMessage:()=>P,isCallMessage:()=>x,isActiveGroupCallMessage:()=>D,isUnread:()=>F,wasEdited:()=>H,hasReply:()=>U,hasForwards:()=>B,isImportant:()=>j,canMessageBeEdited:()=>G,shiftDate:()=>q,isNewStack:()=>V,isMessageToBlockedCommunity:()=>Y,isMessageEmpty:()=>K,getMessageTTL:()=>z,isExpiredCasperMessage:()=>$,getMessageReactions:()=>W,getMyReaction:()=>Q,getMessageReactedPeerIds:()=>Z});var n=a(663825),r=a(712439),s=a(459554),i=a(412827),o=a(993421),l=a(679740),c=a(506770),d=a(375053);function u(e,t,a){var n,r=(0,s.getTab)(e,t),o=null===(n=null==r?void 0:r.msgs)||void 0===n?void 0:n[a];return o?(0,i.parseMessage)(o):null}function _(e,t,a){var n=(0,s.getTab)(e,t);if(!(null==n?void 0:n.msgs))return null;var r=Object.values(n.msgs).find((function(e){return(0,i.parseMessage)(e).chat_local_id===a}));return r?(0,i.parseMessage)(r):null}function g(e,t,a){var n,r=(0,s.getTab)(e,t);return!!(null===(n=null==r?void 0:r.msgs)||void 0===n?void 0:n[a])}function m(e){return Boolean(e.flags&n.FLAG_AUDIO_MESSAGE_LISTENED)}function p(e,t,a){var n=(0,s.getTab)(e,t);return!!(null==n?void 0:n.msgs)&&!!Object.keys(n.msgs).find((function(n){var r;return(null===(r=u(e,t,+n))||void 0===r?void 0:r.randomId)===a}))}function h(e,t,a){var r=(0,s.getTab)(e,t);if(r&&r.msgs){var o=a?u(e,t,a):void 0,l=Object.keys(e.msg_local_ids_sort||{}).length>1?Object.values(r.msgs).sort((function(t,a){var n=(0,i.parseMessage)(t).messageId,r=(0,i.parseMessage)(a).messageId;return v(e,n)-v(e,r)})):Object.values(r.msgs);if(!o)return(0,i.parseMessage)(l[l.length-1]);for(var c=o.local,d=l.length-1;d>=0;d--){var _=(0,i.parseMessage)(l[d]),g=_.local&&_.type!==n.EDIT_MESSAGE;if(!(!c&&g))if(c&&!g||v(e,o.messageId)>v(e,_.messageId))return _}}}function f(e,t){var a,n=null===(a=(0,s.getTab)(e,t))||void 0===a?void 0:a.lastmsg_meta;if(n)return Array.isArray(n)?(0,d.getMessageFromTuple)(n):n}function v(e,t){var a=(0,r.unpackStore)(e),n=a.msg_local_ids_sort&&a.msg_local_ids_sort[t];return void 0!==n?2e9+n:t}function b(e){return!!(e.flags&n.FLAG_OUTBOUND)}function C(e){return e.kludges&&void 0!==e.kludges.source_act}function T(e,t,a){var n=(0,s.getTab)(e,t);if(!n||!n.msgs)return null;var r=Object.keys(n.msgs).sort((function(e,t){return+e-+t}));if(!r)return null;var i=r&&r.indexOf(""+a);return-1===i?null:u(e,t,r[i-1])}function E(e,t){return b(t)?e.viewer_id:t.userId}function I(e,t){var a=(0,r.unpackStore)(e);return a.gid&&b(t)?Number(t.kludges.from_admin)||-a.gid:0}function L(e,t,a){var n=e.attaches[0];return!!n&&(n.type===t||void 0!==a&&n.type===a)}function y(e){return L(e,"app_action")}function A(e){return L(e,"doc")&&"graffiti"===e.attaches[0].kind}function S(e){return Boolean(e.attaches.find((function(e){return"doc"===e.type&&("audiomsg"===e.kind||"audio_message"===e.kind)})))}function k(e){return Boolean(e.attaches.find((function(e){return"sticker"===e.type})))}function M(e){return L(e,"gift")}function R(e){return L(e,"money_transfer","money_request")}function w(e){return L(e,"money_request")}function N(e){return L(e,"link","vkpay")&&!!e.kludges.attach1_app_id&&6217559==e.kludges.attach1_app_id}function O(e){return Boolean(e.kludges.is_expired||e.kludges.expire_ttl||e.kludges.ttl&&e.flags&n.FLAG_DELETE_BY_TTL)}function P(e){var t;return null===(t=e.attaches)||void 0===t?void 0:t.some((function(e){return"widget"===e.type}))}function x(e){return e.kludges&&"call"===e.kludges.attach1_type}function D(e){return e&&e.attaches&&e.attaches[0]&&"group_call_in_progress"===e.attaches[0].type}function F(e,t){return"number"!=typeof t.messageId||((0,c.partConfigEnabled)("me_web_read_by_cmid")?b(t)?t.chat_local_id>(e.out_up_to_cmid||0):t.chat_local_id>(e.in_up_to_cmid||0):b(t)?t.messageId>(e.out_up_to||0):t.messageId>(e.in_up_to||0))}function H(e){return e.update_time>0}function U(e){var t=e.attaches.filter((function(e){return"mail"===e.type})).length>0;return!!(e.attaches.filter((function(e){return"reply"===e.type})).length>0||e.flags&n.FLAG_HAS_REPLY&&t)}function B(e){return e.attaches.some((function(e){return"mail"===e.type&&e.object.fwd_count>0}))&&!(e.flags&n.FLAG_HAS_REPLY)}function j(e){return Boolean(e.flags&n.FLAG_IMPORTANT)}function G(e,t){var a=(0,i.parseMessage)(t),n=(0,r.unpackStore)(e),o=(0,s.getTab)(n,a.peerId);if((0,c.partConfigEnabled)("im_message_editable_sync")&&o&&(0,s.isChatConvo)(o)&&!(0,s.isChatActive)(o))return!1;var l=n.viewer_id==a.peerId&&!n.gid,d=n.pinMessageEditSettings,u=d.messageEditAllowedTime,_=d.pinEditDelayTime,g=d.isPinEditEnabled,m=Date.now()/1e3,p=o&&(0,s.getPinnedMessage)(o),h=p&&p.messageId===a.messageId,f=a.kludges&&a.kludges.pinned_at,v=m-a.date>u,T=f&&m-f<_;if((0,s.isVKAgentPeer)(a.peerId))return!1;if(!l&&!b(a))return!1;if(C(a))return!1;if(h&&v&&g){if(T)return!1}else if(v)return!1;return!(M(a)||k(a)||S(a)||A(a)||R(a)||N(a)||x(a)||O(a)||function(e){return L(e,"widget")}(a)||y(a))&&!function(e,t,a){var n=(0,r.unpackStore)(e),i=(0,s.getTab)(n,t);if(i){return(i.deleted||[]).includes(a)}return!1}(e,a.peerId,a.messageId)}function q(e,t){return 1e3*t+1e3*e.timeshift}function V(e,t,a,n,r){if(void 0===r&&(r=!1),E(n,t)!==E(n,a))return!0;var s=q(n,t.date),i=q(n,a.date);if(!(0,l.isSameDate)(s,i))return!0;if((0,o.isCommunityInterface)(n)&&Number(t.kludges.from_admin)!==Number(a.kludges.from_admin))return!0;if(a.date-t.date>300)return!0;if(C(t)||C(a))return!0;var c=O(t),d=O(a);if(c!==d)return!0;var u=t.kludges.is_expired,_=a.kludges.is_expired;if(c&&d&&u!==_)return!0;if(c&&d&&!u&&!_)return!0;if(c&&d&&u&&_)return!1;if(x(a)||x(t))return!0;if(D(a)||D(t))return!0;if(M(t)||M(a))return!0;if(A(t)||A(a))return!0;if(U(a))return!0;var g=!n.gid&&e.peerId===n.viewer_id;return!(F(e,t)===F(e,a)||!r||b(a)||g)}function Y(e,t){return!(!e.blocked_community||!b(t))}function K(e){return e.messageId<=0}function z(e){var t=e.kludges.ttl||e.kludges.expire_ttl;return t?Number(t):void 0}function $(e){return!(!e.kludges||!e.kludges.is_expired)}function W(e,t,a){var n=_(e,t,a);return(null==n?void 0:n.kludges.reactions)||[]}function Q(e,t,a){var n=_(e,t,a);return null==n?void 0:n.kludges.reaction_id}function Z(e,t,a){var n,r=_(e,t,a);return(null===(n=null==r?void 0:r.kludges.reactions)||void 0===n?void 0:n.map((function(e){return e.user_ids||[]})).flat())||[]}},606542:(e,t,a)=>{"use strict";a.d(t,{oCacheExists:()=>r,oCacheGet:()=>s});var n=a(67328);function r(e,t){return t in(0,n.unpackStore)(e).oCache}function s(e,t){var a=(0,n.unpackStore)(e).oCache[t];return a&&!a._n&&(!function(e){if(!e.first_name){var t=e.name.split(" ",2);e.first_name=t[0],e.short_name=t[1]?t[0]+" "+t[1].substr(0,1)+".":t[0]}e.inv_name||(e.inv_name=e.name),e.kick_name||(e.kick_name=e.inv_name)}(a),a._n=1),a}},993421:(e,t,a)=>{"use strict";a.d(t,{isLastMsgDebugEnabled:()=>i,getGroupId:()=>o,isCommunityInterface:()=>l,isReversedConvoOrder:()=>c,getPeer:()=>d,getUnreadCount:()=>u,getUnreadCountNotMuted:()=>_,getUnreadCountWithMuted:()=>g,getPendingReadReactionsCmids:()=>m,getUnreadReactions:()=>p,getTabCmidToMessageIdMap:()=>h,getLocalSettingsValue:()=>f,getPressedButtonState:()=>v,getKeyboardAppHash:()=>b,getActionCallbackTimeout:()=>C,isRecommendationListRerenderNeeded:()=>T,getEmojiOptId:()=>E,isClassicInterface:()=>I,isSearchView:()=>L,isBusinessNotifyEnabled:()=>y,getReactionData:()=>A});var n=a(67328),r=a(179288),s=a(844142);function i(e){return(0,n.unpackStore)(e).isLastMsgFalseDebugger}function o(e){return(0,n.unpackStore)(e).gid}function l(e){return!!o(e)}function c(e){var t=(0,n.unpackStore)(e);return!!l(e)&&((19542789===t.gid||103416369===t.gid)&&(t.active_tab===r.ConvoListFolder.UNRESPOND||t.active_tab===r.ConvoListFolder.UNREAD))}function d(e){return(0,n.unpackStore)(e).peer}function u(e){var t=(0,n.unpackStore)(e);return t.settings.show_only_not_muted_messages?t.unread_counters.countNotMuted:t.unread_counters.count}function _(e){return(0,n.unpackStore)(e).unread_counters.countNotMuted}function g(e){return(0,n.unpackStore)(e).unread_counters.count}function m(e,t){var a=(0,n.unpackStore)(e);return s.Ranges.isZeroOwner(t)?new Set:a.pendingReadReactionsCmids.get(t)||new Set}function p(e,t){var a,r=(0,n.unpackStore)(e);if(s.Ranges.isZeroOwner(t))return new Set;var i=m(r,t),o=((null===(a=r.tabs[t])||void 0===a?void 0:a.unread_reaction_cmids)||[]).filter((function(e){return!i.has(e)}));return new Set(o)}function h(e,t){return(0,n.unpackStore)(e).cmidToMessageIdMap.get(t)||new Map}function f(e,t){return(0,n.unpackStore)(e).settings[t]}function v(e,t){var a=(0,n.unpackStore)(t),r=d(t),s=a.callbackEventButtons.get(r);return s?s.get(e):void 0}function b(e){return(0,n.unpackStore)(e).keyboard_app_hash}function C(e){return(0,n.unpackStore)(e).callbackActionTimeout}function T(e){return(0,n.unpackStore)(e).isRecommendationListRerenderNeeded}function E(e){return(0,n.unpackStore)(e).emojiOptId}function I(e){var t=(0,n.unpackStore)(e);return Boolean(t.gid||t.isClassic)}function L(e){var t=(0,n.unpackStore)(e);return Boolean(t.searchText||t.recentSearch)}function y(e){return!!(0,n.unpackStore)(e).isBusinessNotifyEnabled}function A(e,t){return(0,n.unpackStore)(e).reactions.get(t)}},179203:(e,t,a)=>{"use strict";a.d(t,{addNewMember:()=>l,createChatAction:()=>c,createCommunityChatAction:()=>d,cancelMessageRequestAction:()=>_,kickUserAction:()=>g});var n=a(570655),r=a(653736),s=a(826542),i=a(407381),o=a(827749),l=(0,r.wrapHashAction)((function(e,t,a,n){var r;return(0,s.addChatMembers)(e,t,n.gid,(null===(r=n.tabs[e])||void 0===r?void 0:r.hash)||"",a).then((function(){return n}))})),c=(0,r.wrapHashActionReversed)((function(e,t,a,r,o){var l;return e.creating=!0,null===(l=e.longpoll)||void 0===l||l.pause(),(0,s.multiStart)(e.writeHash,a,r,o).then((function(t){var a,r=(0,n.__read)(t,1)[0];return e.next_peer=r.peerId,e.tabs[r.peerId]=r,(0,i.updateListedConvos)(e,r,!1,(function(e){return[r.peerId].concat(e)})),null===(a=e.longpoll)||void 0===a||a.resume(),e})).then((function(e){return t?u(e,e.next_peer,t):e})).then((function(e){return e.creating=!1,e})).catch((function(t){var a;throw e.creating=!1,null===(a=e.longpoll)||void 0===a||a.resume(),t}))})),d=(0,r.wrapHashActionReversed)((function(e,t,a,r,i){return void 0===i&&(i=!1),e.creating=!0,(0,s.multiStart)(e.writeHash,[],a,void 0,e.gid,!0,i).then((function(a){var s=(0,n.__read)(a,1)[0].peer_id;if(!s)throw new Error("No peer_id");return e.peer=s,(0,o.collectChatCreateStats)(s,r,e.gid),t?u(e,s,t):e})).then((function(e){return e.creating=!1,e})).catch((function(t){throw e.creating=!1,t}))}));function u(e,t,a){return(0,s.ownerPhotoSave)(t,a,e.gid).then((function(){return e}))}var _=(0,r.wrapHashActionReversed)((function(e,t,a){return(0,s.kickUser)(t,a,e.tabs[t].hash||"").then((function(){var n=e.tabs[t];return n&&n.invitedByMessageRequest&&(n.invitedByMessageRequest=n.invitedByMessageRequest.filter((function(e){return e.id!==a}))),e}))})),g=(0,r.wrapHashActionReversed)((function(e,t,a){var n=e.tabs[t];return(0,s.kickUser)(t,a,n.hash||"",e.gid).then((function(){return n.memberIds=n.memberIds.filter((function(e){return e!==a})),n.adminIds=n.adminIds.filter((function(e){return e!==a})),n.membersCount=n.memberIds.length,e}))}))},917791:(e,t,a)=>{"use strict";a.d(t,{loadConversations:()=>L,loadPeer:()=>y,restoreHistoryQueue:()=>A,restoreQueuedMessagesInDom:()=>S,searchHints:()=>k,pinConvoHandler:()=>M,unpinConvoHandler:()=>R,getCustomChatMemberSearch:()=>w,toggleHideFolderHandler:()=>N,toggleHideFolderNoticeHandler:()=>O});var n=a(570655),r=a(653736),s=a(826542),i=a(475234),o=a(653004),l=a(407381),c=a(315882),d=a(240367),u=a(511492),_=a(315720),g=a(993421),m=a(459554),p=a(506770),h=a(923876),f=a(712860),v=a(376473),b=a(419672),C=a(754204),T=a(294378),E=a(606542),I=a(384032),L=(0,r.wrapHashActionReversed)((function(e,t,a,r){return(0,s.getConversations)(e.writeHash,e.gid,t,a,r).then((function(e){return(0,n.__read)(e,1)[0]}))})),y=function(e,t,a,r,l,c){e.tabHistoryNotChanged=!1;var d=(0,m.getTab)(e,t),_=d&&(d.lastmsg||Object.keys(d.msgs||{}).length>0),g=r&&(0,p.partConfigEnabled)("messages_new_empty_dialog_screen")&&!(0,h.getEmptyScreenUserInfo)(e,t)&&!_&&(0,m.isUserEmptyScreenRich)(e,t)?(0,f.loadUserEmptyDialogData)(t).catch((function(){return Promise.resolve()})):Promise.resolve(),v=(0,u.retryFn)(s.start,3,(function(e){return e-1}))(t,a||0,!!r,e.prevPeer,e.gid,l);return Promise.all([v,g]).then((function(r){var s,l=(0,n.__read)(r,2),c=l[0],d=l[1],u=(0,n.__read)(c,6),_=u[0],g=u[1],f=u[2],v=u[3],b=u[4],C=u[5];if(d&&!_.history&&(0,i.addEmptyScreenUserInfo)(t,d,e),g.forEach((function(t){return(0,o.oCacheAdd)(e,t)})),e.tabs||(e.tabs={}),e.dialog_tab_cts=b,e.tabs[t]||(e.tabs[t]=(0,h.normalizeTab)(e,_)),(0,i.updateBlockStates)(v,e).then((function(){})).catch((function(){})),a){if(e.tabs[t]){var T=e.tabs[t].lastmsg,L=e.tabs[t].lastmsg_meta;Object.assign(e.tabs[t],_),e.tabs[t].lastmsg=T,e.tabs[t].lastmsg_meta=L}}else Object.assign(e.tabs[t],_);if(e.admins=(0,n.__assign)((0,n.__assign)({},e.admins),f),C&&(e.tabs[t].peer_profile_info=C),(0,p.partConfigEnabled)("messages_reactions")){var y=(0,m.getConvoReactedPeerIds)(e,t).filter((function(t){return!(0,E.oCacheExists)(e,t)}));y&&(0,I.loadChatMember)(((s={})[t]=y,s),e)}return A(e,t)})).catch((function(e){var t=(0,C.getErrorText)(e,"loadPeer ["+c+"]");return(0,T.dummyCatch)(new Error(t))}))};function A(e,t){if(!e.imQueue||!e.imQueueSet)return Promise.resolve(e);var a=e.imQueue(t,!1),n=(0,m.getTab)(e,t);if(!n)return Promise.resolve(e);var r=a.filter((function(a){return!(0,v.isExistingRid)(e,t,a.rid)}));return n.msgs=r.reduce((function(e,t){return e["rid"+t.rid]=t.mess,e}),n.msgs||{}),e.imQueueSet(t,r).then((function(){})).catch((function(){})),n.history=S(e,r,n.history),Promise.resolve(e)}function S(e,t,a){if(!e.imQueue)return a;var n=Array.isArray(t)?t:e.imQueue(t,!1);return 0===n.length||n.map((function(e){return e.mess.failed=!!e.failed,e.mess})).filter((function(t){return(0,v.isMessageStored)(e,t.peerId,t.messageId)})).forEach((function(t){return(0,b.appendMessageToHistory)(e,t,a)})),a}function k(e,t,a,r,d){return void 0===a&&(a=s.HintsSearchType.ALL),(0,s.hints)(e,r.hidegid?0:d.gid,a,t).then((function(e){var t=(0,n.__read)(e,3),a=t[0],s=t[1],c=t[2];return r.skipStoreUpdate||(s.forEach((function(e){return(0,o.oCacheAdd)(d,e)})),(0,i.updateBlockStates)(c,d).then((function(){}),(function(){})),(0,l.mergeTabs)(d,a).then((function(){}),(function(){}))),a})).then((function(t){if(e){var a=t&&Object.keys(t).length;(0,c.saveSearchAttemptStats)(c.serviceMessages,0,a,e)}return Object.keys(t).sort((function(e,a){return t[+e].order-t[+a].order})).map((function(e){return t[+e]}))}))}var M=(0,r.wrapHashActionReversed)((function(e,t){var a;return(0,s.pinConvo)(t,(null===(a=e.tabs[t])||void 0===a?void 0:a.hash)||"")})),R=(0,r.wrapHashActionReversed)((function(e,t){var a;return(0,s.unpinConvo)(t,(null===(a=e.tabs[t])||void 0===a?void 0:a.hash)||"")})),w=(0,r.wrapHashActionReversed)((function(e,t){var a=(0,m.getTab)(e,t);if(!a||!(0,m.isChatConvo)(a))return Promise.resolve(e);if(a.isDonutChat){function o(e){return e.map((function(e){return{name:e.first_name+" "+e.last_name,id:e.id,photo:e.photo_100,peerId:e.id}}))}var r=a.ownerId,s=(0,g.isCommunityInterface)(e),i="photo_100";return a.customChatMemberServerSearch=(0,u.debouncedPromise)((function(e){var t={q:e,from_list:"donut",group_id:-r,fields:i};return s&&(t=(0,n.__assign)((0,n.__assign)({},t),{from_list:"donut_friends"})),(0,d.search)(t).then((function(e){var t=e.items;return Array.isArray(t)?o(t):[]}))}),400),(s?(0,d.getMembers)({group_id:String(-r),filter:"donut",fields:i}):(0,d.getFriends)({owner_id:r,fields:i})).then((function(t){var n=o(t.items),r=new _.vkIndexer(n,(function(e){return e.name}));return a.customChatMemberSearch=function(e){return Promise.resolve(e?r.search(e):r.list)},e}))}return Promise.resolve(e)})),N=(0,r.wrapHashActionReversed)((function(e,t,a,n){return void 0===n&&(n=!1),(0,s.toggleHideFolder)(t,a,n,e.writeHash)})),O=(0,r.wrapHashActionReversed)((function(e,t,a){return(0,s.toggleHideFolderNotice)(t,a,e.writeHash)}))},407381:(e,t,a)=>{"use strict";a.d(t,{mergeTabs:()=>p,updateListedConvos:()=>h,removeDeletedUnreadMsgsFromTab:()=>f,setFilteredExpiringMessagesData:()=>v,setFilteredMentionsData:()=>b,setActions:()=>C,updateRecommendedListItemOnline:()=>E,removeStoredRecommendedListItem:()=>I,setConvoIsNew:()=>L,setConvoBusinessNotifyEnabled:()=>y,resetFolderList:()=>A});var n=a(570655),r=a(923876),s=a(412827),i=a(993421),o=a(459554),l=a(294378),c=a(179288),d=a(67328),u=a(826338),_=a(506770),g=a(145072),m=a(844142);function p(e,t,a){(0,r.normalizeTabsGotFromServer)(e,t);var o=e.tabs[e.peer];return e.tabs=Object.keys(t).reduce((function(a,r){var o=Number(r),c=e.tabs[o]?e.tabs[o].msgs:{},d=Object.assign({},c||{},t[o].msgs||{});(0,_.partConfigEnabled)("im_clocks_fix")&&Object.keys(t[o].msgs||{}).filter((function(e){return c&&!c[e]})).forEach((function(t){var a=(0,s.parseMessage)(d[t]);a.randomId&&e.imQueueComplete&&(e.imQueueComplete(o,a.randomId),delete d["rid"+a.randomId],(0,_.partConfigEnabled)("im_chasiky_debug")&&window.meBufferLog&&delete window.meBufferLog[a.randomId])}));return a[o]=Object.assign({},e.tabs[o]||{},t[o]),d&&(a[o].msgs=d),t[o].lastmsg||((0,i.isLastMsgDebugEnabled)(e)&&!1!==a[o].lastmsg&&(console.log((0,n.__assign)({},t[o])),(0,l.showDebugAlert)()),a[o].lastmsg=!1),a}),e.tabs),o&&!a&&(e.tabs[e.peer]=o),Promise.resolve(e)}function h(e,t,a,n,s){t.deletedDialog||(e.dialog_tabs=Object.keys(e.dialog_tabs).reduce((function(e,i){var o=e[i];return!a&&!(0,r.getFilterFnForConvoListFolder)(i)(t)||s&&!s(i,o,t)||(e[i]=(0,d.arrayUnique)(n(o,i))),e}),e.dialog_tabs))}function f(e,t,a){var n=(0,o.getTab)(a,e);if(!n)return Promise.resolve(a);if(n.unread=n.unread?n.unread-t.length:0,(0,_.partConfigEnabled)("me_web_read_by_cmid")){var r=t.reduce((function(e,t){return e[t]=!0,e}),{});v(e,(function(e){return!r[e]}),a),b(e,(function(e){return!r[e]}),a)}else{var s=t.reduce((function(e,t){return e[t]=!0,e}),{});v(e,(function(e){return!s[e]}),a),b(e,(function(e){return!s[e]}),a)}return Promise.resolve(a)}function v(e,t,a){var n=(0,o.getTab)(a,e);return n?((0,_.partConfigEnabled)("me_web_read_by_cmid")?n.expiring_cmids&&(n.expiring_cmids=n.expiring_cmids.filter(t),n.expiring_cmids.length||delete n.expiring_cmids):n.expiring_messages&&(n.expiring_messages=n.expiring_messages.filter(t),n.expiring_messages.length||delete n.expiring_messages),a):a}function b(e,t,a){var n=(0,o.getTab)(a,e);return n?((0,_.partConfigEnabled)("me_web_read_by_cmid")?n.mention_cmids&&(n.mention_cmids=n.mention_cmids.filter(t),n.mention_cmids.length||delete n.mention_cmids):n.mentions&&(n.mentions=n.mentions.filter(t),n.mentions.length||delete n.mentions),a):a}function C(e){var t,a,n=e.peer,r=e.id;if(0===n)return Promise.resolve(e);var s=(0,o.getTab)(e,n);if(!s)return Promise.resolve(e);var l=m.Ranges.isChatOrChannelPeer(n),d=(0,o.isChannelPeer)(s),p=(0,o.isCommunityChat)(s),h=(0,o.isBusinessNotifyTab)(s)&&(0,i.isBusinessNotifyEnabled)(e),f=(0,o.tabIsArchived)(s),v=l&&!(0,o.isChatActive)(s),b=!!s.offset,C=[];return(null===(t=s.callInProgress)||void 0===t?void 0:t.can_finish_call)&&(null===(a=s.callInProgress)||void 0===a?void 0:a.call_id)&&C.push(c.ConvoAction.CALL_FINISH),h?(C.push(e.mutedPeers.includes(n)?c.ConvoAction.UNMUTE:c.ConvoAction.MUTE),C.push((0,o.isConvoBusinessNotifyEnabled)(s)?c.ConvoAction.DISABLE_BUSINESS_NOTIFY:c.ConvoAction.ENABLE_BUSINESS_NOTIFY),C.push(c.ConvoAction.CLEAR),Promise.resolve(T(e,s,C))):(b&&C.push(c.ConvoAction.MEDIA),(0,i.isCommunityInterface)(e)||!m.Ranges.isUserIdTransitional(n)||m.Ranges.isContactId(n)||(0,u.isVkAdminPeer)(n)||(0,u.isSupportAgentPeer)(n)||r===n||s.blacklisted||s.blacklisted_by_me||s.block_error||s.is_subscribed||s.is_new||!s.lastmsg||C.push(c.ConvoAction.ADD_FRIEND),b&&C.push(c.ConvoAction.SEARCH),0===s.unread&&b&&C.push(c.ConvoAction.UNREAD),!m.Ranges.isEmailId(n)&&!b||d||C.push(c.ConvoAction.CLEAR),!(0,i.isCommunityInterface)(e)||d||p||C.push(c.ConvoAction.BLOCK),d&&!v&&C.push(c.ConvoAction.SETTINGS),m.Ranges.isGroupId(n)&&(s.can_send_notify?C.push(c.ConvoAction.BLOCK_NOTIFY):C.push(s.blocked_community?c.ConvoAction.ALLOW_COMMUNITY:c.ConvoAction.BLOCK_COMMUNITY)),!((0,_.partConfigEnabled)("fav_dialog_with_yourself")&&r===n)&&!(0,i.isCommunityInterface)(e)&&!m.Ranges.isContactId(n)&&(l||m.Ranges.isUserIdTransitional(n)||m.Ranges.isGroupId(n))&&(!l||!v)&&C.push(e.mutedPeers.includes(n)?c.ConvoAction.UNMUTE:c.ConvoAction.MUTE),l&&!v&&(0,g.canInviteUser)(e,n)&&!(0,i.isCommunityInterface)(e)&&C.push(c.ConvoAction.CHAT_INVITE),!(0,i.isCommunityInterface)(e)&&m.Ranges.isUserIdTransitional(n)&&n!==window.vk.id&&!s.blacklisted&&!s.blacklisted_by_me&&!s.block_error&&s.canBeAddedToChat&&C.push(c.ConvoAction.USER_INVITE),!l||v||(0,i.isCommunityInterface)(e)||C.push(c.ConvoAction.LEAVE),l&&s.data.closed&&!s.data.kicked&&C.push(c.ConvoAction.RETURN),(0,o.canBePinned)(e,s)&&C.push((0,u.isPinnedSortId)(s.major_sort_id||0)?c.ConvoAction.UNPIN_CONVO:c.ConvoAction.PIN_CONVO),l&&s.pinned&&(C.push((0,o.isPinnedMessageHidden)(s)?c.ConvoAction.PIN_UNHIDE:c.ConvoAction.PIN_HIDE),(0,g.canPinOrUnpin)(e)&&!f&&C.push(c.ConvoAction.UNPIN)),(0,o.canArchiveTab)(s)&&!(0,i.isCommunityInterface)(e)&&C.push(f?c.ConvoAction.UNARCHIVE:c.ConvoAction.ARCHIVE),!(0,i.isCommunityInterface)(e)&&m.Ranges.isUserIdTransitional(n)&&n!==window.vk.id&&C.push(s.blacklisted_by_me?c.ConvoAction.UNBLOCK_USER:c.ConvoAction.BLOCK_USER),!(0,i.isCommunityInterface)(e)&&m.Ranges.isUserIdTransitional(n)&&n!==window.vk.id&&C.push(c.ConvoAction.REPORT_USER),Promise.resolve(T(e,s,C)))}function T(e,t,a){var n=(0,r.getConvoActionData)(t,(0,i.isCommunityInterface)(e));return e.curActions=a.reduce((function(e,t){return e[t]=n[t],e}),{}),e}function E(e,t,a,n){var r=e.recommendationList,s=r&&r.item_data[t];return s&&(s.online=a||n?1:0,s.online_info&&(s.online_info.is_online=a,s.online_info.is_mobile=n)),Promise.resolve(e)}function I(e,t){var a=e.recommendationList;if(!a)return Promise.resolve(e);var r=(0,n.__assign)({},a.item_data);return delete r[t],e.recommendationList=(0,n.__assign)((0,n.__assign)({},a),{items:a.items.filter((function(e){return e!==t})),item_data:r}),Promise.resolve(e)}function L(e,t,a){return a.tabs[e]&&(a.tabs[e].is_new=!!t),Promise.resolve(a)}function y(e,t,a){var n=(0,o.getTab)(e,t);return n?(n.can_send_business_notify=a,Promise.resolve(e)):Promise.resolve(e)}function A(e,t){return e.dialog_tabs[t]=[],e.dialog_tabs_all[t]=!1,Promise.resolve(e)}},121074:(e,t,a)=>{"use strict";a.d(t,{loadHashes:()=>r});var n=a(826542);function r(e,t,a){return(0,n.renewHash)(e,t.hidegid?void 0:a.gid)}},588870:(e,t,a)=>{"use strict";a.d(t,{getFullMessage:()=>l,markAudioMessageAsListened:()=>c});var n=a(189798),r=a(240367),s=a(376473),i=a(43229),o=a(712439),l=function(e,t){return(0,n.api)("messages.getByConversationMessageId",{peer_id:e,conversation_message_ids:t,extended:1,fields:"kludges"})},c=function(e,t,a){var n=(0,o.unpackStore)(e),l=(0,s.getMessage)(n,a,t);return!l||(0,i.isOut)(l)||(0,s.isVoiceMessageListened)(l)?Promise.reject():(0,r.markAsListened)(t,n.gid)}},712860:(e,t,a)=>{"use strict";a.d(t,{updateConvoRecommendationList:()=>_,loadUserEmptyDialogData:()=>g,setPeerSubscribedStatus:()=>m,updateCmidToMessageIdMap:()=>p,markReactionsAsRead:()=>h,setUnreadReactions:()=>f,setPeerBanStatus:()=>v,changeMessageReaction:()=>b,updateMessagesReactions:()=>C});var n=a(570655),r=a(240367),s=a(844142),i=a(376473),o=a(993421),l=a(826542),c=a(511492),d=a(475234),u=(0,c.debouncedPromise)(l.getRecommendedContacts,3e3);function _(e){return e.isRecommendationListRerenderNeeded=!1,e.isRecommendationListEnabled?u().then((function(t){var a=(0,n.__read)(t,1)[0];if(!a)return e;var r=!e.recommendationList||e.recommendationList.items.some((function(e,t){return e!==a.items[t]}));return e.recommendationList=a,e.isRecommendationListRerenderNeeded=r,e})).catch((function(t){if("debounce"===t)return e;throw t})):Promise.resolve(e)}function g(e){return(0,r.getMutual)({target_uid:e,order:"random",count:3}).then((function(t){return(0,r.usersGet)({user_ids:(0,n.__spreadArray)([e],(0,n.__read)(t),!1).join(","),fields:"occupation, bdate, city, can_write_private_message, common_count, photo"})}))}function m(e,t,a){var n=a.tabs[e];return n?(t?(0,r.deleteFriend)({user_id:e}):(0,r.addFriend)({user_id:e})).then((function(){return n.is_subscribed=!t,n.is_subscribed&&n.is_subscribed_to_me&&(n.is_friend=1),Promise.resolve(a)})):Promise.resolve(a)}function p(e,t,a,s){return(0,n.__awaiter)(this,void 0,Promise,(function(){var l,c,d;return(0,n.__generator)(this,(function(n){return l=(0,o.getTabCmidToMessageIdMap)(e,t),c=(0,o.getUnreadReactions)(e,t),(d=Array.from(c).filter((function(a){return!l.get(s)&&!(0,i.getMessageByCmid)(e,t,a)&&a!==s})).sort((function(e,t){return e-t})).slice(0,99)).push(s),[2,(0,r.getByConversationMessageId)(d,t,a).then((function(a){var n=a.items.reduce((function(e,t){var a=t.conversation_message_id,n=t.id;return e.set(a,n),e}),new Map),r=new Map;return c.forEach((function(e){var t=l.get(e)||n.get(e);t&&r.set(e,t)})),e.cmidToMessageIdMap.set(t,r),e}))]}))}))}function h(e,t,a){return(0,n.__awaiter)(this,void 0,void 0,(function(){return(0,n.__generator)(this,(function(n){return[2,(0,r.markReactionsAsRead)(e,t,a)]}))}))}function f(e,t,a){return(0,n.__awaiter)(this,void 0,Promise,(function(){return(0,n.__generator)(this,(function(n){return s.Ranges.isZeroOwner(t)?[2,Promise.resolve(e)]:e.tabs[t]?(e.tabs[t].unread_reaction_cmids=a,[2,Promise.resolve(e)]):[2,Promise.resolve(e)]}))}))}function v(e,t,a){var n=a.tabs[e];return n?(t?(0,r.unbanUser)(e):(0,r.banUser)(e)).then((function(){var r;return n.blacklisted_by_me=t?0:1,n.block_error=n.blacklisted_by_me?23:void 0,(0,d.updateBlockStates)(((r={})[e]={free:!0,time:Date.now().valueOf()},r),a)})):Promise.resolve(a)}function b(e,t,a,n){return n!==a?(0,r.sendReaction)(e,t,a):(0,r.deleteReaction)(e,t)}function C(e,t,a){return(0,r.getMessagesReactions)(e,t).then((function(n){var r=n.items,s=t.map((function(t){var n,s,o=(null===(n=r.find((function(e){return e.cmid===t})))||void 0===n?void 0:n.counters)||[];if(0===(0,i.getMessageReactions)(a,e,t).length&&0===o.length)return Promise.resolve(a);var l=Number(null===(s=(0,i.getMessageByCmid)(a,e,t))||void 0===s?void 0:s.messageId);return l?(0,d.setMessageReactions)(a,e,l,o):Promise.resolve(a)}));return Promise.all(s).then((function(){return a}))}))}},475234:(e,t,a)=>{"use strict";a.d(t,{updateBlockStates:()=>l,setChatList:()=>c,setUnreadCounters:()=>d,addToUnreadCounter:()=>u,setLocalSettingsValue:()=>_,setPendingReadReactionsCmids:()=>g,setPressedCallbackButton:()=>m,unsetPressedCallbackButton:()=>p,setActionCallbackTimeout:()=>h,unsetActionCallbackTimeout:()=>f,addEmptyScreenUserInfo:()=>v,setMessageReactions:()=>b,setMyMessageReaction:()=>C});var n=a(570655),r=a(179288),s=a(993421),i=a(376473),o=a(459554);function l(e,t){return t.block_states=(0,n.__assign)((0,n.__assign)({},t.block_states),e),Promise.resolve(t)}function c(e,t){return e.chatList=t,Promise.resolve(e)}function d(e,t){var a,n,i,o,l,c,d=e.count,u=e.countNotMuted,_=e.businessNotifyUnread,g=void 0===_?0:_,m=e.archiveUnreadCount,p=e.archiveUnreadUnmutedCount,h=e.archiveMentionsCount;return t.unread_counters={count:d,countNotMuted:u},t.dialog_tab_cts[r.ConvoListFolder.UNREAD]={total:(0,s.getUnreadCount)(t),unread:d,unreadNotMuted:u},t.dialog_tab_cts[r.ConvoListFolder.BUSINESS_NOTIFY]={total:Math.max(null!==(i=null===(n=null===(a=t.dialog_tab_cts)||void 0===a?void 0:a[r.ConvoListFolder.BUSINESS_NOTIFY])||void 0===n?void 0:n.total)&&void 0!==i?i:0,g),unread:g},t.dialog_tab_cts[r.ConvoListFolder.ARCHIVE]={total:Math.max(null!==(c=null===(l=null===(o=t.dialog_tab_cts)||void 0===o?void 0:o[r.ConvoListFolder.ARCHIVE])||void 0===l?void 0:l.total)&&void 0!==c?c:0,m),unread:m,unreadNotMuted:p,mentions:h},Promise.resolve(t)}function u(e,t,a){var n=Math.max(0,(0,s.getUnreadCountNotMuted)(a)+e),r=Math.max(0,(0,s.getUnreadCountWithMuted)(a)+e);return a.mutedPeers.includes(t)||(a.unread_counters.countNotMuted=n),a.unread_counters.count=r,Promise.resolve(a)}function _(e,t,a){return a.settings[e]=t,Promise.resolve(a)}function g(e,t,a){return t.length?a.pendingReadReactionsCmids.set(e,new Set(t)):a.pendingReadReactionsCmids.delete(e),Promise.resolve(a)}function m(e,t,a){var n=e.peerId,r=e.eventId;a.callbackEventButtons.has(n)||a.callbackEventButtons.set(n,new Map);var s=a.callbackEventButtons.get(n);return s&&s.set(r,t),Promise.resolve(a)}function p(e,t){var a=e.peerId,n=e.eventId,r=t.callbackEventButtons?t.callbackEventButtons.get(a):void 0;if(!r)return Promise.resolve(t);var s=r.get(n);return s&&clearTimeout(s.timeout),r.delete(n),r.size||t.callbackEventButtons.delete(a),Promise.resolve(t)}function h(e,t){return t.callbackActionTimeout=e,Promise.resolve(t)}function f(e){return clearTimeout(e.callbackActionTimeout),e.callbackActionTimeout=void 0,Promise.resolve(e)}function v(e,t,a){var r,s,i;a.emptyScreenUserInfo||(a.emptyScreenUserInfo={});var o=(0,n.__read)(t),l=o[0],c=o.slice(1);if(l){var d=c.map((function(e){return{name:e.first_name||"",photo:e.photo}}));a.emptyScreenUserInfo[e]={bdate:l.bdate,occupation:null===(r=l.occupation)||void 0===r?void 0:r.name,occupationType:null===(s=l.occupation)||void 0===s?void 0:s.type,city:null===(i=l.city)||void 0===i?void 0:i.title,commonCount:l.common_count,canWrite:l.can_write_private_message,mutualFriends:d}}}function b(e,t,a,n){var r,s=(0,i.getMessage)(e,t,a),l=(0,o.getTab)(e,t);if(!s||!(null==l?void 0:l.msgs))return Promise.resolve(e);var c=(null===(r=s.kludges.reactions)||void 0===r?void 0:r.map((function(e){return e.reaction_id})).reverse())||[];return n.sort((function(e,t){return c.indexOf(t.reaction_id)-c.indexOf(e.reaction_id)})),s.kludges.reactions=n,l.msgs[a]=s,Promise.resolve(e)}function C(e,t,a,n){var r=(0,i.getMessage)(e,t,a),s=(0,o.getTab)(e,t);return r&&(null==s?void 0:s.msgs)?(n?r.kludges.reaction_id=n:delete r.kludges.reaction_id,s.msgs[a]=r,Promise.resolve(e)):Promise.resolve(e)}},653004:(e,t,a)=>{"use strict";a.d(t,{oCacheAdd:()=>r});var n=a(67328);function r(e,t){var a=(0,n.unpackStore)(e);a.oCache||(a.oCache={}),t.id&&(a.oCache[t.id]=t)}},179288:(e,t,a)=>{"use strict";a.d(t,{MENTION_RAW:()=>i,CONTROLLER:()=>o,FAVORITES_ICON_URL:()=>l,SENDING_ICON_TIMEOUT:()=>c,ConvoListFolder:()=>r,FOLDER_ALL:()=>g,FOLDER_IMPORTANT:()=>m,FOLDER_MARKED_UNREAD:()=>p,FOLDER_MESSAGE_REQUEST:()=>h,FOLDER_MESSAGE_REQUEST_REJECTED:()=>f,FOLDER_UNREAD:()=>v,FOLDER_UNRESPOND:()=>b,FOLDER_PEER_TAGS:()=>C,FOLDER_NOT_IMPORTANT_MESSAGE_REQUEST:()=>T,FOLDER_BUSINESS_NOTIFY:()=>E,FOLDER_ARCHIVE:()=>I,FOLDER_MASKS:()=>L,ConvoAction:()=>u,FolderAction:()=>_});var n,r,s=a(506770),i=/(^|[\s.,:\'\";>\)\(])(\*|@)([A-Za-z0-9_\.]{2,32})\s*\((.+?)\)/g,o="al_im.php",l="/images/icons/im_favorites_100.png",c=2e3;!function(e){e.ALL="all",e.IMPORTANT="important",e.MR="mr",e.UNREAD="unread",e.UNRESPOND="unrespond",e.AD_TAG="ad_tag",e.BUSINESS_NOTIFY="business_notify",e.ARCHIVE="archive",e.PEER_TAGS="custom_tag"}(r||(r={}));r.AD_TAG;var d,u,_,g=r.ALL,m=r.IMPORTANT,p="marked_unread",h=r.MR,f="mr_rejected",v=r.UNREAD,b=r.UNRESPOND,C="custom_tag",T="mr_not_important",E=r.BUSINESS_NOTIFY,I=r.ARCHIVE,L=((n={})[r.UNRESPOND]=2,n[r.IMPORTANT]=1,n[r.MR]=256,n[r.BUSINESS_NOTIFY]=8192,n[r.ARCHIVE]=1<<23,n[f]=512,n[r.AD_TAG]=32768,n[p]=1<<20,n);(0,s.partConfigEnabled)("test_folder_masks")&&(L[T]=1<<22),function(e){e.USER="user",e.COMMUNITY="community",e.CHAT="chat",e.CHANNEL="channel",e.MR="mr",e.CHAT_MR="chat_mr",e.EMAIL="email",e.CONTACT="contact",e.BUSINESS_NOTIFY="business_notify"}(d||(d={})),function(e){e.SETTINGS="settings",e.BLOCK="block",e.CHAT_INVITE="chat_invite",e.USER_INVITE="user_invite",e.CREATE_CHAT="create_chat",e.MEDIA="media",e.SEARCH="search",e.PIN_HIDE="pin_hide",e.PIN_UNHIDE="pin_unhide",e.UNPIN="unpin",e.MUTE="mute",e.UNMUTE="unmute",e.CLEAR="clear",e.LEAVE="leave",e.RETURN="return",e.BLOCK_COMMUNITY="block_community",e.ALLOW_COMMUNITY="allow_community",e.BLOCK_NOTIFY="block_notify",e.CALL_AUDIO="call_audio",e.CALL_VIDEO="call_video",e.CALL_APP="call_app",e.UNREAD="unread",e.PIN_CONVO="pin_convo",e.UNPIN_CONVO="unpin_convo",e.CALL_BY_NAME="call_by_name",e.ENABLE_BUSINESS_NOTIFY="enable_business_notify",e.DISABLE_BUSINESS_NOTIFY="disable_business_notify",e.BUSINESS_NOTIFY="business_notify",e.ARCHIVE="archive",e.UNARCHIVE="unarchive",e.ADD_FRIEND="add_friend",e.BLOCK_USER="block_user",e.UNBLOCK_USER="unblock_user",e.REPORT_USER="report_user",e.CALL_FINISH="call_finish"}(u||(u={})),function(e){e.SHOW="show"}(_||(_={}))},923876:(e,t,a)=>{"use strict";a.d(t,{mergeConvoLists:()=>L,normalizeTabsGotFromServer:()=>y,normalizeTab:()=>A,getContactPeerId:()=>S,getConvoInfoFromLocalIndex:()=>k,getFilterFnForConvoListFolder:()=>M,getDataForChatMemberGrid:()=>R,sortFn:()=>w,getConvoActionData:()=>N,getConvoInlineMenuActionData:()=>O,isDialogWithYourself:()=>P,getEmptyScreenUserInfo:()=>x});var n=a(570655),r=a(712439),s=a(459554),i=a(993421),o=a(294378),l=a(606542),c=a(179288),d=a(506770),u=a(70162),_=a(270448),g=a(609506),m=a(779633),p=a(545892),h=a(179799),f=a(939474),v=a(656067),b=a(111588),C=a(839323),T=a(318516),E=a(18892),I=a(844142);function L(e,t,a){var r=e.reduce((function(e,t){return e.set(t.peerId,!0),e}),new Map),s=a||function(){return!0};return(0,n.__spreadArray)((0,n.__spreadArray)([],(0,n.__read)(e),!1),(0,n.__read)(t.filter((function(e){return!r.has(e.peerId)&&s(e)}))),!1)}function y(e,t){for(var a in t)t.hasOwnProperty(a)&&A(e,t[a])}function A(e,t){var a,r=(0,l.oCacheGet)(e,t.peerId),c=(0,s.getTab)(e,t.peerId),d=t.lastmsg;if(r&&(t.photo=t.photo||r.photo,t.name=t.name||r.name,t.href=t.href||r.link,t.sex=t.sex||r.sex),t.last_touched=(null==c?void 0:c.last_touched)||0,t.verified=!!t.verified,t.lastmsg=d||t.lastmsg_meta&&t.lastmsg_meta[0]||!1,(0,i.isLastMsgDebugEnabled)(e)&&(d||t.lastmsg_meta&&t.lastmsg_meta[0])&&!1===t.lastmsg&&(console.log((0,n.__assign)({},t)),(0,o.showDebugAlert)()),t.folders=t.folders||null,t.unread=t.unread||0,t.online=t.online||0,t.is_new=!!t.is_new,t.out_up_to=null!=t.out_up_to?t.out_up_to:t.in_up_to||0,t.out_up_to_cmid=null!=t.out_up_to_cmid?t.out_up_to_cmid:t.in_up_to_cmid||0,I.Ranges.isUserIdTransitional(t.peerId)){var u=t.last_seen;t.online=u&&(null==u?void 0:u.platform)||0,t.is_nft_photo=t.is_nft_photo||(null==r?void 0:r.is_nft_photo)||!1,t.last_seen=t.last_seen||{platform:0,time:0,mobile:0,can_see:0}}return I.Ranges.isChatOrChannelPeer(t.peerId)&&(t.memberIds=t.memberIds||(null===(a=c)||void 0===a?void 0:a.memberIds)||null),t}function S(e){return e+19e8}function k(e){var t={peerId:e[0],name:e[1],tab:e[1],photo:e[2],href:e[3],online:e[4],is_friend:e[5],local_index:!0};return e[6]&&(t.data={flags:e[6]}),t}function M(e){switch(e){case c.ConvoListFolder.ALL:return function(e){return!(((0,d.partConfigEnabled)("simplified_start_conversation")?(0,s.tabIsNotImportantMessageRequest)(e):(0,s.tabIsMessageRequest)(e))||(0,s.tabIsBusinessNotification)(e)||(0,s.tabIsArchived)(e))};case c.ConvoListFolder.UNREAD:return function(e){return!(0,s.tabIsMessageRequest)(e)&&!(0,s.tabIsBusinessNotification)(e)&&!(0,s.tabIsArchived)(e)&&(e.unread&&e.unread>0||(0,s.isTabMarkedUnread)(e))};case c.ConvoListFolder.MR:return function(e){return(0,d.partConfigEnabled)("simplified_start_conversation")?(0,s.tabIsNotImportantMessageRequest)(e):(0,s.tabIsMessageRequest)(e)};case c.ConvoListFolder.BUSINESS_NOTIFY:return s.tabIsBusinessNotification;case c.ConvoListFolder.ARCHIVE:return s.tabIsArchived;default:return function(t){return t.folders&&t.folders&c.FOLDER_MASKS[e]}}}function R(e,t,a){var n=t.data.active.slice(0,4).map((function(t){return(0,l.oCacheGet)(e,t)})).filter((function(e){return!!e}));return[n.map((function(e){return e.photo})),a?n.map((function(e){return e.link})):[]]}function w(e,t,a){var n=t.lastmsg&&t.major_sort_id||0,r=a.lastmsg&&a.major_sort_id||0,o=n!==r?r-n:(0,s.getLocalSortId)(e,a)-(0,s.getLocalSortId)(e,t);return(0,i.isReversedConvoOrder)(e)?-o:o}function N(e,t){var a,n=(0,s.isChannelPeer)(e);return(a={})[c.ConvoAction.SEARCH]={icon:"search",name:(0,u.getLang)("mail_im_peer_search")},a[c.ConvoAction.BLOCK_COMMUNITY]={icon:"block",name:(0,u.getLang)("mail_block_comm_messages")},a[c.ConvoAction.BLOCK_NOTIFY]={icon:"block",name:(0,u.getLang)("mail_block_notify_messages")},a[c.ConvoAction.ALLOW_COMMUNITY]={icon:"unblock",name:(0,u.getLang)("mail_allow_comm_messages")},a[c.ConvoAction.CLEAR]={icon:"clear",name:I.Ranges.isEmailId(e.peerId)?(0,u.getLang)("mail_im_delete_email_contact"):(0,u.getLang)("mail_im_delete_all_history")},a[c.ConvoAction.MUTE]={icon:"mute",name:(0,u.getLang)("mail_im_mute")},a[c.ConvoAction.PIN_CONVO]={icon:"pin_convo",name:(0,u.getLang)("mail_pin_chat")},a[c.ConvoAction.UNPIN_CONVO]={icon:"unpin_convo",name:(0,u.getLang)("mail_unpin_chat")},a[c.ConvoAction.UNMUTE]={icon:"unmute",name:(0,u.getLang)("mail_im_unmute")},a[c.ConvoAction.MEDIA]={icon:"media",name:t?(0,u.getLang)("mail_im_show_media_history_group"):(0,u.getLang)("mail_im_show_media_history")},a[c.ConvoAction.BLOCK]={icon:"block",name:(0,u.getLang)("mail_block_user")},a[c.ConvoAction.CHAT_INVITE]={icon:"add",name:(0,u.getLang)("mail_im_create_chat_with")},a[c.ConvoAction.USER_INVITE]={icon:"invite",name:I.Ranges.isUserIdTransitional(e.peerId)&&1===e.canBeAddedToChat?(0,u.getLang)("mail_im_add_to_chat"):(0,u.getLang)("mail_im_invite_to_chat")},a[c.ConvoAction.ADD_FRIEND]={icon:"add_friend",name:e.is_subscribed_to_me?(0,u.getLang)("mail_im_add_to_friends_accept"):(0,u.getLang)("mail_im_add_to_friends")},a[c.ConvoAction.CREATE_CHAT]={icon:"invite",name:(0,u.getLang)("mail_im_create_chat_with")},a[c.ConvoAction.LEAVE]={icon:"leave",name:(0,s.isBusinessNotifyTab)(e)?(0,u.getLang)("mail_delete"):n?(0,u.getLang)("mail_leave_channel"):(0,u.getLang)("mail_leave_chat")},a[c.ConvoAction.RETURN]={icon:"return",name:n?(0,u.getLang)("mail_return_to_vkcomgroup"):(0,u.getLang)("mail_return_to_chat")},a[c.ConvoAction.PIN_HIDE]={icon:"pin_hide",name:(0,u.getLang)("mail_menu_pin_hide")},a[c.ConvoAction.PIN_UNHIDE]={icon:"pin_unhide",name:(0,u.getLang)("mail_menu_pin_show")},a[c.ConvoAction.UNPIN]={icon:"unpin",name:(0,u.getLang)("mail_menu_unpin")},a[c.ConvoAction.SETTINGS]={icon:"settings",name:n?(0,u.getLang)("mail_vkcomgroup_settings"):(0,u.getLang)("mail_settings")},a[c.ConvoAction.CALL_AUDIO]={icon:"call_audio",name:(0,u.getLang)("mail_im_call_audio")},a[c.ConvoAction.CALL_VIDEO]={icon:"call_video",name:(0,u.getLang)("mail_im_call_video")},a[c.ConvoAction.CALL_APP]={icon:"call_app",name:(0,u.getLang)("mail_im_call_app")},a[c.ConvoAction.UNREAD]={icon:"unread",name:(0,u.getLang)("mail_menu_mark_unread")},a[c.ConvoAction.CALL_BY_NAME]={icon:"call_by_name",name:(0,u.getLang)("mail_im_call_by_name")},a[c.ConvoAction.ENABLE_BUSINESS_NOTIFY]={icon:"notify",name:(0,u.getLang)("mail_im_enable_business_notify")},a[c.ConvoAction.DISABLE_BUSINESS_NOTIFY]={icon:"disable",name:(0,u.getLang)("mail_im_disable_business_notify")},a[c.ConvoAction.ARCHIVE]={icon:"archive",name:(0,u.getLang)("mail_im_archive")},a[c.ConvoAction.UNARCHIVE]={icon:"unarchive",name:(0,u.getLang)("mail_im_unarchive")},a[c.ConvoAction.BUSINESS_NOTIFY]={icon:"business_notify",name:(0,u.getLang)("mail_im_business_notify")},a[c.ConvoAction.REPORT_USER]={icon:"spam",name:(0,u.getLang)("mail_report_user")},a[c.ConvoAction.BLOCK_USER]={icon:"block",name:(0,u.getLang)("mail_block_user")},a[c.ConvoAction.UNBLOCK_USER]={icon:"unblacklist",name:(0,u.getLang)("mail_user_unblacklist")},a[c.ConvoAction.CALL_FINISH]={icon:"call_finish",name:(0,u.getLang)("calls_im_call_finish")},a}function O(e,t){var a=N(e,t);return[[c.ConvoAction.ARCHIVE,(0,_.getIcon20ArchiveOutline)().icon],[c.ConvoAction.UNARCHIVE,(0,g.getIcon20UnarchiveOutline)().icon],[c.ConvoAction.UNREAD,(0,m.getIcon20MessageUnreadTopOutline)().icon],[c.ConvoAction.PIN_CONVO,(0,p.getIcon20PinOutline)().icon],[c.ConvoAction.UNPIN_CONVO,(0,h.getIcon20PinSlashOutline)().icon],[c.ConvoAction.MUTE,(0,f.getIcon20MuteOutline)().icon],[c.ConvoAction.UNMUTE,(0,v.getIcon20VolumeOutline)().icon],[c.ConvoAction.LEAVE,(0,b.getIcon20Cancel)().icon],[c.ConvoAction.CLEAR,(0,C.getIcon20DeleteOutline)().icon],[c.ConvoAction.ENABLE_BUSINESS_NOTIFY,(0,T.getIcon20NotificationOutline)().icon],[c.ConvoAction.DISABLE_BUSINESS_NOTIFY,(0,E.getIcon20BlockOutline)().icon]].reduce((function(e,t){var r=(0,n.__read)(t,2),s=r[0],i=r[1];return e[s]=(0,n.__assign)((0,n.__assign)({},a[s]),{icon:i}),e}),{})}function P(e,t){return(0,d.partConfigEnabled)("fav_dialog_with_yourself")&&e===t}function x(e,t){var a=(0,r.unpackStore)(e);return a.emptyScreenUserInfo&&a.emptyScreenUserInfo[t]}},645523:(e,t,a)=>{"use strict";a.d(t,{CHANGE_VOICE_UI:()=>s,editMessageLocallyEvent:()=>i,transitionEvent:()=>o,resetPeer:()=>l,changePeer:()=>c,changeTab:()=>d,changeVoiceTranscriptUI:()=>u,failedMessage:()=>_,resendEvent:()=>g,compactCounterEvents:()=>m});var n=a(570655),r=a(663825),s="change_voice_ui";function i(e){return(0,n.__assign)((0,n.__assign)({},e),{type:r.EDIT_MESSAGE})}function o(e){return{type:r.TRANSITION,state:e}}function l(e,t){return void 0===e&&(e=!1),void 0===t&&(t=!1),{type:r.RESET_PEER,cancelSearch:e,removeActivePeer:t}}function c(e,t,a,n,s){return void 0===t&&(t=!1),void 0===a&&(a=!1),void 0===n&&(n=!1),void 0===s&&(s=""),{type:r.CHANGE_PEER,peerId:e,msgid:t,forward:a,cancelSearch:n,entryPoint:s}}function d(e){return{type:r.CHANGE_TAB,tab:e}}function u(){return{type:s}}function _(e,t,a){return{type:r.FAILED_MESSAGE,message:t,peerId:e,error:a}}function g(e,t){return{type:r.RESEND,message:t,peerId:e}}function m(e){var t=!1;return e.reduceRight((function(e,a){var n=a.type===r.UNREAD_COUNT,s=!t&&n;return n&&!s||e.unshift(a),s&&(t=!0),e}),[])}},820696:(e,t,a)=>{"use strict";a.d(t,{getFolderInlineMenuActionsData:()=>u,getFilteredConvoList:()=>_});var n=a(179288),r=a(564452),s=a(270448),i=a(180805),o=a(70162),l=a(459554),c=a(923876),d=a(712439);function u(e){var t,a,l,c,d,u,_,g=e;return(t={})[n.FolderAction.SHOW]={name:null!==(d=null===(a={},a[n.ConvoListFolder.BUSINESS_NOTIFY]=(0,o.getLang)("mail_folder_action_show_business_notify"),a[n.ConvoListFolder.ARCHIVE]=(0,o.getLang)("mail_folder_action_show_archive"),c=a)||void 0===c?void 0:c[g])&&void 0!==d?d:(0,o.getLang)("mail_folder_action_show_default"),icon:null!==(_=null===(l={},l[n.ConvoListFolder.BUSINESS_NOTIFY]=(0,r.getIcon20WorkOutline)().icon,l[n.ConvoListFolder.ARCHIVE]=(0,s.getIcon20ArchiveOutline)().icon,u=l)||void 0===u?void 0:u[g])&&void 0!==_?_:(0,i.getIcon20Add)().icon},t}function _(e,t,a){var n=(0,d.unpackStore)(e),r=(0,c.getFilterFnForConvoListFolder)(a);return t.reduce((function(e,t){var a=(0,l.getTab)(n,t);return a&&r(a)&&e.push(a.peerId),e}),[])}},653736:(e,t,a)=>{"use strict";a.d(t,{wrapHashAction:()=>i,wrapHashActionReversed:()=>o});var n=a(570655),r=a(459554),s=a(121074);function i(e){return function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];var r=t[t.length-1];return e.apply(void 0,(0,n.__spreadArray)([],(0,n.__read)(t),!1)).catch((function(a){if(a&&a.match&&a.match(/1001;/))return l(r,e,t);throw a}))}}function o(e){return function(t){for(var a=[],r=1;r<arguments.length;r++)a[r-1]=arguments[r];return e.apply(void 0,(0,n.__spreadArray)([t],(0,n.__read)(a),!1)).catch((function(n){if(n&&n.match&&n.match(/1001;/))return l(t,e,[t].concat(a));throw n}))}}function l(e,t,a){return function(e){return e.resync_in_process?e.resync_in_process:Promise.resolve(!1)}(e).then((function(i){return i?t.apply(void 0,(0,n.__spreadArray)([],(0,n.__read)(a),!1)):function(e){if(!e.renew_hashes){var t=e.last_hashes_update||0;if(Date.now()-t<1e4)return Promise.resolve();var a=Object.keys(e.tabs).filter((function(t){return(0,r.isFullyLoadedTab)(e,+t)}));e.renew_hashes=(0,s.loadHashes)(a,{},e).then((function(t){var r=(0,n.__read)(t,3),s=r[0],i=r[1],o=r[2];return a.forEach((function(t){var a=+t;e.tabs[a].hash=s[a]})),e.writeHash=i,e.manageTagsHash=o,delete e.renew_hashes,e.last_hashes_update=Date.now(),e}))}return e.renew_hashes}(e).then((function(){return t.apply(void 0,(0,n.__spreadArray)([],(0,n.__read)(a),!1))}))}))}},412827:(e,t,a)=>{"use strict";a.d(t,{parseMessage:()=>r});var n=a(375053);function r(e){return e&&Array.isArray(e)?(0,n.getMessageFromTuple)(e):e}},222131:(e,t,a)=>{"use strict";a.d(t,{makeUserFromUserConvo:()=>l,getUserInitials:()=>c,prepareContactName:()=>d});var n=a(659397),r=a(596238),s=a(965002),i=a(733164),o=a(342269);function l(e){return{id:e.peerId,link:e.href,name:e.name,first_name:"",short_name:"",first_name_gen:"",inv_name:"",kick_name:"",sex:e.sex,photo:e.photo||""}}function c(e){var t=(0,n.decodeHTMLEntities)(e),a=(0,r.emojiRegex)().exec(t);return a?0===a.index?(0,s.emojiReplace)(a[0]):t[0]:t.split(/\s/).reduce((function(e,t){return e+t.slice(0,1)}),"").slice(0,2)}function d(e){var t=(0,i.replaceEntities)(e);return(0,s.emojiToHTML)((0,o.clean)(t),!0)}},442347:(e,t,a)=>{"use strict";a.d(t,{replaceSpecialSymbols:()=>s,secondsToHuman:()=>i,formatDate:()=>o});var n=a(179288),r=a(608021);function s(e){return e.replace(/&lt;&lt;/g,"&laquo;").replace(/&gt;&gt;/g,"&raquo;").replace(/ \-\-/g," &mdash;").replace(/\-\- /g,"&mdash; ").replace(n.MENTION_RAW,"$1$4")}function i(e){var t=Math.floor(e/3600),a=Math.floor(e/60)-60*t,n=!1,r=!1;return[t,a,e-3600*t-60*a].reduce((function(e,t){if(0===t&&!r)return r=!0,e;var a=n&&t<10?"0"+t:t.toString();return n=!0,r=!0,e+(""!==e?":":"")+a}),"")}function o(e,t){return(0,r.langDate)(1e3*e,"{hour}:{minute} {am_pm}",1e3*t,[],!0)}},826542:(e,t,a)=>{"use strict";a.d(t,{addChatMembers:()=>i,getConversations:()=>o,renewHash:()=>l,HintsSearchType:()=>n,hints:()=>c,ownerPhoto:()=>d,multiStart:()=>u,ownerPhotoSave:()=>_,kickUser:()=>g,pinConvo:()=>m,unpinConvo:()=>p,getRecommendedContacts:()=>h,toggleHideFolder:()=>f,toggleHideFolderNotice:()=>v,start:()=>b});var n,r=a(887294),s=a(179288),i=function(e,t,a,n,i){return(0,r.post)(s.CONTROLLER,{act:"a_add_chat_members",peer:e,new_peer:t.join(","),gid:a,hash:n,show_history:i?1:0})},o=function(e,t,a,n,i){return(0,r.post)(s.CONTROLLER,{act:"a_get_conversations",offset:i,count:n,filter:a,gid:t,hash:e})},l=function(e,t){return(0,r.post)(s.CONTROLLER,{act:"a_renew_hash",peers:e.join(","),gid:t})};!function(e){e.FRIENDS="friends",e.FRIENDS_AND_CONTACTS="friends_and_contacts",e.ALL="all"}(n||(n={}));var c=function(e,t,a,n){return(0,r.post)(s.CONTROLLER,{act:"a_hints",str:e,gid:t,query:a,peerIds:n.join(",")})},d=function(e,t){return(0,r.post)(s.CONTROLLER,{act:"a_owner_photo",photo:e,peer:t})},u=function(e,t,a,n,i,o,l){return void 0===o&&(o=!1),void 0===l&&(l=!1),(0,r.post)(s.CONTROLLER,{act:"a_multi_start",hash:e,peers:t.join(","),title:a,flags:n,gid:i,is_community_chat:Number(o),is_donut_chat:Number(l)})},_=function(e,t,a){return(0,r.post)("al_page.php",{act:"owner_photo_save",peer:e,_query:t,gid:a})},g=function(e,t,a,n){return(0,r.post)(s.CONTROLLER,{act:"a_kick_user",chat:e,hash:a,mid:t,gid:n})},m=function(e,t){return(0,r.post)(s.CONTROLLER,{act:"a_pin_convo",peer_id:e,hash:t})},p=function(e,t){return(0,r.post)(s.CONTROLLER,{act:"a_unpin_convo",peer_id:e,hash:t})},h=function(){return(0,r.post)(s.CONTROLLER,{act:"a_recommend_contacts"})},f=function(e,t,a,n){return(0,r.post)(s.CONTROLLER,{act:"a_toggle_hide_folder",folder:e,hash:n,hide:t?1:0,reset:a?1:0})},v=function(e,t,a){return(0,r.post)(s.CONTROLLER,{act:"a_toggle_hide_folder_notice",notice:e,hide:t,hash:a})},b=function(e,t,a,n,i,o){return(0,r.post)(s.CONTROLLER,{act:"a_start",peer:e,msgid:t,history:Number(a),prevpeer:n,gid:i,block:o})}},240367:(e,t,a)=>{"use strict";a.d(t,{setInfo:()=>r,getInfo:()=>s,sendMessageEvent:()=>i,getFriends:()=>o,getMembers:()=>l,search:()=>c,addFriend:()=>d,deleteFriend:()=>u,getMutual:()=>_,usersGet:()=>g,denyMessagesFromGroup:()=>m,allowMessagesFromGroup:()=>p,hideSuggestedContact:()=>h,archiveConversation:()=>f,unarchiveConversation:()=>v,recogniseAudioMessage:()=>b,getByConversationMessageId:()=>C,markReactionsAsRead:()=>T,getMessagesReactions:()=>E,markAsListened:()=>I,hideHelpHint:()=>L,banUser:()=>y,unbanUser:()=>A,forceCallFinish:()=>S,sendReaction:()=>k,deleteReaction:()=>M});var n=a(189798);function r(e,t){return(0,n.api)("account.setInfo",{name:e,value:t})}function s(){return(0,n.api)("account.getInfo",{})}function i(e){return(0,n.api)("messages.sendMessageEvent",e)}function o(e){return(0,n.api)("donut.getFriends",e)}function l(e){return(0,n.api)("groups.getMembers",e)}function c(e){return(0,n.api)("users.search",e)}function d(e){return(0,n.api)("friends.add",e)}function u(e){return(0,n.api)("friends.delete",e)}function _(e){return(0,n.api)("friends.getMutual",e)}function g(e){return(0,n.api)("users.get",e)}function m(e){return(0,n.api)("messages.denyMessagesFromGroup",e)}function p(e){return(0,n.api)("messages.allowMessagesFromGroup",e)}function h(e){return(0,n.api)("messages.hideSuggestedContact",e)}function f(e){return(0,n.api)("messages.archiveConversation",e)}function v(e){return(0,n.api)("messages.unarchiveConversation",e)}function b(e,t){return(0,n.api)("messages.recogniseAudioMessage",{message_id:e,audio_message_id:t})}function C(e,t,a){return(0,n.api)("messages.getByConversationMessageId",{conversation_message_ids:e.join(","),peer_id:t,group_id:a})}function T(e,t,a){return(0,n.api)("messages.markReactionsAsRead",{peer_id:t,group_id:a,cmids:e.join(",")})}function E(e,t){return(0,n.api)("messages.getMessagesReactions",{peer_id:e,cmids:t.join(",")})}function I(e,t){return(0,n.api)("messages.markAsListened",{message_id:e,group_id:t})}function L(e){return(0,n.api)("account.hideHelpHint",{hint_id:e})}function y(e){return(0,n.api)("account.ban",{owner_id:e})}function A(e){return(0,n.api)("account.unban",{owner_id:e})}var S=function(e){return(0,n.api)("messages.forceCallFinish",{call_id:e})},k=function(e,t,a){return(0,n.api)("messages.sendReaction",{peer_id:e,reaction_id:a,cmid:t})},M=function(e,t){return(0,n.api)("messages.deleteReaction",{peer_id:e,cmid:t})}},309756:(e,t,a)=>{"use strict";a.d(t,{showNotification:()=>r});var n=a(342269);function r(e){var t=e.text,a=e.type,r=e.title,s=e.photo;window.Notifier&&window.Notifier.showEvent({text:(0,n.clean)(t),type:a,title:r,author_photo:s})}},827749:(e,t,a)=>{"use strict";a.d(t,{ConvoInviteEntryPoint:()=>n,collectConvoInviteStats:()=>d,collectOnboardingFindFriendsShowStats:()=>u,collectOnboardingFindFriendsClickStats:()=>_,collectConversationSuggestionItemStats:()=>g,collectOpenMessageRequestStats:()=>m,collectChatCreateStats:()=>p,collectVoiceStat:()=>h});var n,r=a(171516),s=a(940441),i=a(724702),o=a(676554),l=a(506770),c=a(746133);!function(e){e.DIALOG_ACTIONS="dialog_actions",e.PROFILE_SCREEN="profile_screen",e.CONTACT_SCREEN="contact_screen"}(n||(n={}));var d=function(e,t){(0,r.saveStatlogEvents)({name:"convo_invite",value:e,keys:[t]})},u=function(e){s.customMetricsCollector.logEvent({experiment_id:1285,service:"messages",metric_name:"open_vk_service_chat",metric_value:3,unit_id:e,unit_type_id:1})},_=function(e){s.customMetricsCollector.logEvent({experiment_id:1285,service:"messages",metric_name:"push_find_friends_button",metric_value:3,unit_id:e,unit_type_id:1})},g=function(e,t,a){o.ContactRecommendationCollector.logEvent({event_type:a,track_code:e,position:t})},m=function(e){i.messagingActionItemStatCollector.logEvent({peer_id:e,action_type:"OPEN_MR"})},p=function(e,t,a){(0,l.partConfigEnabled)("me_web_log_create_chat")&&i.messagingActionItemStatCollector.logEvent({peer_id:e,action_type:"CREATE_CHAT",entry_point:t,group_id:a})},h=function(e,t,a,n,r,s){c.audioMessageStatCollector.logEvent({action_type:e,peer_id:t,cmid:a,audio_message_id:n,action_source:"msg_list_attach",playback_rate:"play"===e?100:void 0,transcription_show:void 0!==r?r?1:0:void 0,actor:s})}},419672:(e,t,a)=>{"use strict";a.d(t,{unpackHistory:()=>m,appendMessageToHistory:()=>p,ensureDomHasActions:()=>h,removeMessagesWithStack:()=>f,removeNewUnreadBarAndMerge:()=>v});var n=a(459554),r=a(873589),s=a(376473),i=a(342269),o=a(608021),l=a(67328),c=a(163612),d=a(917791),u=a(179288),_=a(659397),g=a(844142);function m(e){return"string"==typeof e?(0,r.se)("<div>"+e+"</div>"):e}function p(e,t,a,p,b){void 0===p&&(p=!0),void 0===b&&(b=!0);var C=(0,n.getTab)(e,t.peerId);if(C&&a){var T=m(a);if(!a||T.querySelector("._im_mess")||T.querySelector("._im_bar_date")||(T.innerHTML=""),C.skipped&&C.skipped>0)return T;var E=[];if(!t.local&&e.imQueue&&(E=e.imQueue(t.peerId,p)),E.length>0)f(E.reduce((function(e,t){var a=T.querySelector("._im_mess_rid"+t.rid);return a&&e.push(a),e}),[]),T);var I=(0,c.renderMessage)(e,t),L=(0,r.domLC)(T);L&&!L.classList.contains("_im_mess_stack")&&(L=(0,r.domClosestSibling)(L,"._im_mess_stack",-1));for(var y=(0,s.getLastMessage)(e,t.peerId,t.messageId);t.peerId===e.peer&&y&&!T.querySelector("._im_mess_"+y.messageId);)y=(0,s.getLastMessage)(e,t.peerId,y.messageId);var A=T.querySelector("._im_unread_bar_row"),S=y?(0,s.shiftDate)(e,y.date):0,k=g.Ranges.isChatOrChannelPeer(t.peerId)&&(0,n.isCasperChatTab)(C);if(!y||(0,s.isNewStack)(C,y,t,e,b)){var M="",R=!1;if(A&&(0,s.isOutbound)(t)&&v(e,T,t.peerId),1===C.unread&&!(0,s.isOutbound)(t)&&b&&(M+=(0,i.getTemplate)("im_mess_bar",{}),R=!0,v(e,T,t.peerId)),!(0,_.isDateToday)(new Date(S))&&!k){var w=new Date,N=R?"im-page--history-new-bar_hide _im_invisible_bar":"";M+=(0,i.getTemplate)("im_day_bar",{day:(0,o.getShortDate)(t.date,e.timeshift,!0,(0,o.getLang)("months_of","raw"),!0),date:t.date,day_class:w.getDate()+w.getMonth()+w.getFullYear()+" "+N})}if((0,s.isServiceMsg)(t))M+=(0,i.getTemplate)("im_service_row",{text:(0,c.renderServiceMsg)(e,t,C.peerId),type:"",date:t.date,from_id:"",message_id:t.messageId});else{var O=(0,c.getStackDataFromMessage)(e,t);M+=(0,i.getTemplate)(O.is_nft_photo?"im_mess_stack_nft":"im_mess_stack_no_nft",Object.assign(O,{messages:I,peer_id:O.peerId}))}(0,l.toArray)((0,r.sech)(M)).forEach((function(e){return T&&T.appendChild(e)}))}else A&&e.peer===t.peerId&&!C.inplaceSearch&&(0,s.isOutbound)(t)&&v(e,T,t.peerId),L.querySelector("._im_stack_messages").appendChild((0,r.se)(I));var P=Date.now()-1e3*t.date>u.SENDING_ICON_TIMEOUT;return(0,s.isOutbound)(t)&&!P&&setTimeout((function(){var e=T.querySelector("._im_mess_"+t.messageId);e&&e.classList.contains(c.SENDING_CLASS)&&e.classList.add("im-mess_sending")}),u.SENDING_ICON_TIMEOUT),E=E.filter((function(e){return e.rid!==t.randomId})),h(T),(0,d.restoreQueuedMessagesInDom)(e,E,T)}}function h(e){for(var t=e.querySelectorAll("._im_mess_noa:not(._im_mess_callsnippet):not(._im_mess_srv)"),a=t.length;a--;)t[a].classList.contains("im-mess_fwd")||t[a].insertAdjacentHTML("afterbegin",(0,i.getTemplate)("sImHistoryRowActions")),t[a].classList.remove("_im_mess_noa")}function f(e,t){var a=e.filter((function(e){return!e.classList.contains("im-mess_srv")})).map((function(e){return e.parentElement}));return e.forEach((function(e){var t=e.parentNode;if(t)if(e.classList.contains("im-mess_srv")){var a=t.parentNode;a&&a.removeChild(t)}else t.removeChild(e)})),a.filter((function(e){return 0===(0,r.domChildren)(e).length})).map((function(e){return e?e.closest("._im_mess_stack"):void 0})).forEach((function(e){var t,a;(null===(t=(0,r.domPS)(e))||void 0===t?void 0:t.classList.contains("_im_bar_date"))&&(0,r.re)((0,r.domPS)(e)),(null===(a=(0,r.domPS)(e))||void 0===a?void 0:a.classList.contains("_im_unread_bar_row"))&&(0,r.re)((0,r.domPS)(e)),(0,r.re)(e)})),t}function v(e,t,a){var n=t.querySelector("._im_unread_bar_row");if(!n)return t;var i=(0,r.domClosestSibling)(n,"._im_mess_stack",-1),o=(0,r.domClosestSibling)(n,"._im_mess_stack"),c=i?Array.from(i.querySelectorAll("._im_mess")).pop():null,d=o?o.querySelector("._im_mess"):null;if((0,r.re)(n),function(e){var t=e.querySelector("._im_invisible_bar");t&&t.classList.remove("_im_invisible_bar","im-page--history-new-bar_hide")}(t),!d||!c)return t;var u=d.dataset.msgid,_=(0,s.getPreviousMessage)(e,a,u),g=(0,s.getMessage)(e,a,u);if(!_||!g||(0,s.isNewStack)(e.tabs[a],_,g,e))return t;var m=i.querySelector("._im_stack_messages"),p=o.querySelector("._im_stack_messages").children;return(0,l.toArray)(p).forEach((function(e){(0,r.re)(e),m.appendChild(e)})),(0,r.re)(o),t}},163612:(e,t,a)=>{"use strict";a.d(t,{SENDING_CLASS:()=>k,FAILED_CLASS:()=>M,renderMessage:()=>R,parseMessageText:()=>w,renderMessageMedia:()=>O,renderCallUserList:()=>P,getStackDataFromMessage:()=>x,renderServiceMsg:()=>D,getServiceLinkTemplate:()=>F,renderReactionsPanel:()=>H,renderMessageReactions:()=>U});var n=a(570655),r=a(459554),s=a(376473),i=a(342269),o=a(608021),l=a(70162),c=a(820929),d=a(832656),u=a(978613),_=a(397698),g=a(640157),m=a(993421),p=a(75560),h=a(873589),f=a(442347),v=a(712439),b=a(606542),C=a(592380),T=a(659397),E=a(506770),I=a(179288),L=a(668742),y=a(511417),A=a(66433),S=a(844142),k="_im_mess_sending",M="_im_mess_failed";function R(e,t){var a=[],n=(0,r.getTab)(e,t.peerId),d=n&&(0,s.isUnread)(n,t),u=(0,s.isCallMessage)(t)||(0,s.isActiveGroupCallMessage)(t),_=n&&(0,r.getPinnedMessage)(n),g=(null==n?void 0:n.block_error)&&n.block_error>0,h=(0,s.hasReply)(t)?(0,i.getTemplate)("im_message_media",{type:"reply",messageId:t.messageId,attaches:N("reply"),text:""}):"";u||a.push("_im_mess"),(0,s.isOutbound)(t)&&d&&!u&&a.push("im-mess_unread _im_mess_unread"),(0,s.isOutbound)(t)&&!u&&a.push("im-mess_out"),(0,s.wasEdited)(t)&&a.push("im-mess_was_edited"),(0,s.canMessageBeEdited)(e,t)&&a.push("im-mess_editable"),(0,s.isImportant)(t)&&a.push("im-mess_fav"),(e.selectedMessages||[]).includes(t.messageId)&&a.push("im-mess_selected"),_&&_.messageId===t.messageId&&a.push("_im_mess_pinned");var b=Date.now()-1e3*t.date>I.SENDING_ICON_TIMEOUT;t.local&&b&&a.push("im-mess_sending"),t.local&&a.push(""+k),t.local&&(0,s.wasEdited)(t)&&!d&&a.push("im-mess_unread im-mess_nobg"),t.failed&&a.push("im-mess_failed "+M),(0,s.isGift)(t)&&a.push("im-mess_gift"),u&&a.push("_im_mess_callsnippet"),(0,s.isCasperMessage)(t)&&a.push("im-mess_casper"),(0,s.isWidgetMessage)(t)&&a.push("im-mess_widget"),!g&&(0,E.partConfigEnabled)("messages_reactions")&&a.push("im-mess_reactions");var C=O(e,t).concat(function(e){if(e.kludges.keyboard&&e.kludges.keyboard.inline){var t=e.kludges.keyboard.buttons,a=0;return[].concat((0,i.getTemplate)("sImMessageKeyboard",{content:t.map((function(e){return(0,i.getTemplate)("sImMessageKeyboardRow",{content:e.map((function(e){return(0,i.getTemplate)("sImMessageKeyboardButton",{label:(0,p.getButtonLabel)(e),appearance:(0,p.getButtonAppearance)(e),modifier:e.action.type.replace("_","-"),attributes:(0,p.getAttributesFromActionObject)(e.action,a++),tagName:e.action.type===p.BUTTON_TYPE_OPEN_LINK||e.action.type===p.BUTTON_TYPE_OPEN_MODAL_VIEW?"a":"button"})})).join("")})})).join("")}))}return[]}(t)),T=function(e,t){var a="",n=(0,v.unpackStore)(e).sourceEnabled&&t.kludges&&t.kludges.from_widget&&t.kludges.ref_source;(0,s.wasEdited)(t)&&(a+=(0,i.getTemplate)("sImLblWasEdited",{update_time:t.update_time}));if((0,m.isCommunityInterface)(e)&&n){var r=t.kludges.ref_source,d=void 0;try{if((d=JSON.parse((0,i.unclean)(r||""))).link&&d.info){d.link=(0,c.replaceHyperLinks)((0,i.clean)(d.link),(function(e){return(0,c.linksReplacer)(e)}));var u=(0,i.clean)((0,o.langStr)((0,l.getLang)("mail_source_info"),"link",d.link,"info",(0,i.clean)(d.info)));a+=(0,i.getTemplate)("sImLblWasSourceInfo",{source:u})}}catch(e){}}return a}(e,t),y=(0,E.partConfigEnabled)("messenger_make_away_link_useful")?1e3:55,A=h+w(e,t.text,t.kludges,t.peerId,y);t.subject&&"..."!==t.subject.trim()&&!S.Ranges.isChatOrChannelPeer(t.peerId)&&(A=(0,i.getTemplate)("im_topic",{topic:t.subject})+A);var R=C.length>0?(0,i.getTemplate)("im_message_media",{type:"media",messageId:t.messageId,attaches:C.join(""),text:""}):"",x=t.kludges.has_template?function(e){return'<div class="bot-carousel-placeholder _im_bot_carousel_'+e.messageId+'"></div>'}(t):"";return(0,s.isGift)(t)||(R=A+x+R),(0,s.isCallMessage)(t)&&(R+=function(e,t,a){var n=e.viewer_id,r=t.attaches[0],s=r.initiatorId,o=r.state,c=n===s,d=Boolean(t.kludges.attach1_call_video),u=t.kludges.attach1_call_participants&&JSON.parse(t.kludges.attach1_call_participants)||[],_="group_call"===t.kludges.attach1_kind,g={title:"",description:"",modifier:"",button:"",user_list:""},m=d?(0,l.getLang)("mail_call_snippet_outgoing_video"):(0,l.getLang)("mail_call_snippet_outgoing"),p=d?(0,l.getLang)("mail_call_snippet_incoming_video"):(0,l.getLang)("mail_call_snippet_incoming");switch(o){case"reached":var h=a?"":(0,f.secondsToHuman)(r.duration);g.title=c?m:p,g.description=(0,l.getLang)("mail_call_snippet_finished")+" · "+h;break;case"canceled_by_initiator":c?(g.title=m,g.description=(0,l.getLang)("mail_call_snippet_canceled")):(g.title=p,g.description=(0,l.getLang)("mail_call_snippet_missed"));break;case"canceled_by_receiver":if(c){if(a)return(0,l.getLang)("mail_call_declined");g.title=m,g.description=(0,l.getLang)("mail_call_snippet_declined")}else g.title=p,g.description=(0,l.getLang)("mail_call_snippet_canceled");break;default:g.title=(0,l.getLang)("mail_added_call")}_&&(g.title=(0,l.getLang)("mail_call_snippet_group"));var v=u.map(Number);return g.user_list=P(e,v)||(0,L.getIcon24Phone)().icon,g.classes="im-mess--call-snippet CallSnippet--interactive _im-call-snippet",g.attributes='data-participants="'+v.join(",")+'"',(0,i.getTemplate)("sImCallSnippet",g)}(e,t)),R||(R=(0,i.getTemplate)("im_attachment_deleted",{text:(0,l.getLang)("mail_attach_deleted")})),R+=T,(0,i.getTemplate)("im_msg_row",{msg_id:t.messageId,cmid:t.chat_local_id,from_id:t.peerId,aria_hidden:t.local&&!t.failed?"true":"false",ts:t.date,marker_params:t.failed?'aria-label="'+(0,l.getLang)("mail_send_message_error")+'" role="link"':"",unread_params:d?'aria-label="'+(0,l.getLang)("mail_unread_message")+'"':"",cls:a.join(" "),reactions:""}).replace("%text%",(function(){return R}))}function w(e,t,a,n,r){var s=Math.round(1e9*Math.random()).toString(16),i={},o=0,l=(0,c.replaceHyperLinks)(t||"",(function(e){var t="!link_"+o+"_"+s+"!";return i[t]=(0,c.linksReplacer)(e,r),o++,t}));return l=(0,g.replaceMentions)(l),e.isMassMentionsMessageAllowed&&(l=(0,_.replaceMassMentions)(l)),l=(0,d.replaceEmailLinks)(l),l=(0,u.replaceHashtags)(l,(function(t){var a=(0,m.getGroupId)(e);return'<a href="/'+(a?"gim"+a:"im")+"?sel="+(n||(0,m.getPeer)(e))+"&st="+encodeURIComponent(t)+'">'+t+"</a>"})),Object.keys(i).forEach((function(e){l=l.replace(e,(function(){return i[e]}))})),a.emoji&&(l=window.Emoji.emojiToHTML(l,!0)),l}function N(e){return(0,i.getTemplate)("im_preloader",{preloader:(0,h.rs)(window.vk.pr_tpl,{id:""}),cls:"im-preloader_attach im-preloader_visible im-preloader_"+e})}function O(e,t){return t.attaches.reduce((function(a,n){return!(0,s.hasReply)(t)||"mail"!==n.type&&"reply"!==n.type?("call"===n.type||("sticker"===n.type?a.push(function(e,t,a,n,r){var o,l,c,d,u,_=r.messageId,g=window.devicePixelRatio>=2?256:128,m=_&&"animation"===a,p="im_gift";m&&(p+=" sticker_img");var h,f={};try{h=(null===(o=r.kludges)||void 0===o?void 0:o.attachments)&&JSON.parse(null===(l=r.kludges)||void 0===l?void 0:l.attachments)}catch(e){}if(h){var v=null===(c=h.find((function(e){return"sticker"===e.type})))||void 0===c?void 0:c.sticker;if(v){var b=y.colorScheme.isDarkScheme()?v.images_with_background:v.images;if(b&&(b.sort((function(e,t){return e.width-t.width})),u=null===(d=b.find((function(e){return e.width>=g})))||void 0===d?void 0:d.url),v.vmoji){var C=(0,s.getMessageAdminId)(n,r)||(0,s.getMessageUserId)(n,r);f.vmoji={avatarOwnerId:S.Ranges.isUserIdTransitional(C)?C:null,avatarCharacterId:v.vmoji.character_id}}}}u||(u=window.Stickers.getStickerUrl(Number(e),g));var T='<img height="128" class="'+p+'" src="'+u+'"/>';if(_&&m){var E="animatedSticker"+_;T='<div id="'+E+'" data-loop-count=3 data-animation-path="'+("/stickers.php?act=proxy_animation&product_id="+t+"&sticker_id="+e)+'" onmouseenter="StickersAnimation.loadAndPlaySticker(this);"\n     data-uniq-id="'+_+'" data-sticker-id="'+Number(e)+'" class="sticker_animation sticker_animation_128 im_gift">'+T+"</div>",Number.isInteger(_)&&window.StickersSettings.getAutoplay()&&window.StickersAnimation&&window.StickersAnimation.loadAndPlayStickerWithTimer(E,10)}t&&(T='<a onmouseover="return Emoji.stickerOver('+Number(e)+', this);"\n        onclick="return Emoji.clickSticker('+Number(t)+", this, event, "+(0,i.escapeAttr)(JSON.stringify(f))+');">'+T+"</a>");return T='<div class="im_sticker_row">'+T+"</div>"}(n.id,n.productId,n.kind,e,t)):a.push(N(n.type))),a):a}),[])}function P(e,t){if(!t.length)return"";var a=t.slice(0,3).reduce((function(t,a){var n=(0,b.oCacheGet)(e,a);return n&&(t+=(0,i.getTemplate)("sImCallUser",{url:n.photo,name:n.name})),t}),"");return(0,i.getTemplate)("sImCallUsers",{users:a})}function x(e,t){var a,c=(0,v.unpackStore)(e),d=t.peerId,u=t.messageId,_=(0,r.getTab)(e,d),g=(0,s.getMessageUserId)(c,t),p=(0,s.getMessageAdminId)(e,t),h=(0,b.oCacheGet)(c,p?-c.gid:g),E={name:(null==h?void 0:h.name)||(null==_?void 0:_.name)||"",first_name:(null==h?void 0:h.first_name)||(null==_?void 0:_.name)||"",href:(null==h?void 0:h.link)||(null==_?void 0:_.href)||"",sex:(null==h?void 0:h.sex)||(null==_?void 0:_.sex)||0,photo:(null==h?void 0:h.photo)||(null==_?void 0:_.photo)||"",image_status:(null==h?void 0:h.image_status)||""},I=S.Ranges.isChatOrChannelPeer(d)?E.name:E.first_name,L=E.href,y=S.Ranges.isChatOrChannelPeer(d)&&E.image_status?E.image_status:"",A=(0,i.getTemplate)("im_mess_stack_name",{name:I+y,link:L,class:(0,s.isMoney)(t)?" im-mess-stack--lnk-money-transfer":""});if((0,s.isGift)(t)&&(A+=(0,i.getTemplate)("sImGiftLabel",{content:(0,o.langSex)(E.sex||0,(0,l.getLang)("mail_gift_message_sent","raw"))})),(0,s.isMoney)(t)){var k=(0,s.isMoneyRequest)(t)?(0,l.getLang)("mail_money_request_message_sent","raw"):(0,l.getLang)("mail_money_tranfer_message_sent","raw");A+=(0,i.getTemplate)("sImMoneyTransferLabel",{content:(0,o.langSex)(E.sex||0,k)})}var M=function(e,t){var a=(0,v.unpackStore)(e),o=t.peerId,c=t.messageId,d=(0,r.getTab)(a,o),u=d&&S.Ranges.isChatOrChannelPeer(o)&&(0,r.isCasperChatTab)(d),_=(0,s.getMessageAdminId)(e,t),g=(0,m.isCommunityInterface)(e)?"/gim"+a.gid:"/im",p=u?"":(0,i.getTemplate)("im_stack_date",{date:(0,f.formatDate)(t.date,a.timeshift),link:g+"?sel="+o+"&msgid="+c});if(_&&a.admins[_]){var h=a.admins[_],b=_===a.viewer_id?(0,l.getLang)("mail_by_you"):h[0];p+=" "+(0,i.getTemplate)("im_admin_link",{name:b,href:h[1]})}return p+function(e,t){if(!(0,s.isCasperMessage)(t))return"";var a=(0,r.getTab)(e,t.peerId),o=(0,n.__read)(C.casperMessagesStore.getTimings(t.chat_local_id),3),l=o[0],c=o[1],d=o[2],u=Math.max(l+c-d,0);return(0,i.getTemplate)("sImBomb",{classnames:(0,T.classNames)({"im-mess-stack--bomb_hidden":a&&(0,r.isCasperChatTab)(a),"im-mess-stack--bomb_expiring":u<=C.EXPIRING_TIME,"im-mess-stack--bomb_expiring-soon":u<=C.EXPIRING_SOON_TIME})})}(a,t)}(e,t);return{photo:E.photo,is_nft_photo:(null===(a=(0,r.getTab)(e,g))||void 0===a?void 0:a.is_nft_photo)||S.Ranges.isChatOrChannelPeer(d)&&(null==h?void 0:h.is_nft_photo),href:L,cls:"",date_attr:"",link:"/im?sel="+d+"&msgid="+u,name:(0,i.stripHTML)(A),stack_name:A,peerId:g,messageMeta:M,admin:p}}function D(e,t,a,n){void 0===n&&(n=!0);var r=(0,v.unpackStore)(e),c=t.kludges,d=c.source_act,u=Number(c.source_mid),_=Number(S.Ranges.isChatOrChannelPeer(a)?c.from:(0,s.isOutbound)(t)?r.id:t.userId),g=_===u,m=(0,b.oCacheGet)(e,_),p="raw",h=("conversation_style_update"===d||"conversation_style_update_action"===d)&&c.source_style&&(r.conversationStylesEasterEggs===c.source_style||"all"===r.conversationStylesEasterEggs),C="";switch(d){case"chat_create":C=(0,l.getLang)("mail_im_chat_created",p);break;case"chat_title_update":C=c.source_is_channel?(0,l.getLang)("mail_im_title_updated_channel",p):(0,l.getLang)("mail_im_title_updated_dot",p);break;case"chat_invite_user":C=g?(0,l.getLang)("mail_im_returned_to_chat",p):(0,l.getLang)("mail_im_invited",p);break;case"chat_kick_user":C=g?(0,l.getLang)("mail_im_left",p):(0,l.getLang)("mail_im_kicked_from_chat",p);break;case"chat_photo_update":C=(0,l.getLang)("mail_im_photo_set",p);break;case"chat_photo_remove":C=c.source_is_channel?(0,l.getLang)("mail_im_photo_removed_channel",p):(0,l.getLang)("mail_im_photo_removed",p);break;case"chat_pin_message":C=c.source_message?(0,l.getLang)("mail_im_pin_message",p):(0,l.getLang)("mail_im_pin_message_empty2",p);break;case"chat_unpin_message":C=c.source_message?(0,l.getLang)("mail_im_unpin_message",p):(0,l.getLang)("mail_im_unpin_message_empty2",p);break;case"chat_invite_user_by_link":C=(0,l.getLang)("mail_im_invite_by_link",p);break;case"chat_invite_user_by_message_request":C=(0,l.getLang)("mail_im_invite_by_message_request",p);break;case"chat_screenshot":C=r.id===u?(0,l.getLang)("mail_im_chat_own_screenshot",p):(0,l.getLang)("mail_im_chat_screenshot",p);break;case"chat_group_call_started":C=(0,l.getLang)("mail_im_start_group_call",p);break;case"chat_invite_user_by_call":C=(0,l.getLang)("mail_im_invited_to_call",p);break;case"chat_invite_user_by_call_join_link":C=(0,l.getLang)("mail_im_invite_by_call_link",p);break;case"sent_message_requests_count":p=Number(c.count_mr),C=(0,l.getLang)("mail_creation_count_mr_service_msg",p);break;case"accepted_message_request":C=(null==m?void 0:m.contact_name)?(0,l.getLang)("mail_im_accepted_message_request",p):(0,l.getLang)("mail_im_accepted_message_request_no_name",p);break;case"chat_kick_user_call_block":C=(0,l.getLang)("mail_im_kick_user_call_block",p);break;case"chat_kick_don":C=(0,l.getLang)("mail_im_chat_kick_don",p);break;case"conversation_style_update":case"conversation_style_update_action":C=c.source_style?h?(0,l.getLang)("mail_im_change_chat_theme_easter_egg",p):(0,l.getLang)("mail_im_change_chat_theme",p):(0,l.getLang)("mail_im_reset_chat_theme",p);break;default:return(0,l.getLang)("mail_no_support")}var T=(0,b.oCacheGet)(e,u),E=T?function(e,t,a){return"chat_invite_user_by_message_request"===e?a:t}(d,(null==m?void 0:m.sex)||0,T.sex):null==m?void 0:m.sex;if(C=(0,o.langSex)(E||0,C),!n&&(C=C.replace(/<br\s*\/?>/g," ")),C=C.replace("{from}",F((null==m?void 0:m.link)||"",m?function(e,t){return"chat_invite_user_by_message_request"===t?e.inv_name:e.name}(m,d):"",n)),C=C.replace("{contact}",(null==m?void 0:m.contact_name)||""),u&&!g){var I=c.source_email,L=I?F("/im?email="+encodeURIComponent(I),"email",n):F((null==T?void 0:T.link)||"",T?function(e,t){if("chat_invite_user_by_message_request"===t)return e.name;return"chat_kick_user"===t?e.inv_name:e.kick_name}(T,d):"",n);C=C.replace("{user}",L)}if(c.source_text&&c.source_text.length>0){var y=c.source_old_text?'«<b class="im_srv_lnk">'+c.source_old_text+"</b>» &rarr; ":"";C=C.replace("{title}",y+'«<b class="im_srv_lnk">'+c.source_text+"</b>»")}if("chat_pin_message"===d||"chat_unpin_message"===d)if(c.source_message){var k=F("",(0,f.replaceSpecialSymbols)(window.Emoji.emojiToHTML((0,i.stripHTML)(c.source_message.replace(/<br\s?\/?>/gi," ")),!0)),!1,"im_srv_mess_link");C=C.replace("{msg}",k)}else C=C.replace(/{link}(.+){\/link}/i,(function(e,t){return F("",t,!1,"im_srv_mess_link")}));if("conversation_style_update"===d||"conversation_style_update_action"===d){if(c.source_style){var M=h?(0,l.getLang)("mail_conversation_style_easter_egg"):function(e){var t="";switch(e){case"candy":t=(0,l.getLang)("mail_conversation_style_candy");break;case"crimson":t=(0,l.getLang)("mail_conversation_style_crimson");break;case"default":t=(0,l.getLang)("mail_conversation_style_default");break;case"disco":t=(0,l.getLang)("mail_conversation_style_disco");break;case"emerald":t=(0,l.getLang)("mail_conversation_style_emerald");break;case"frost":t=(0,l.getLang)("mail_conversation_style_frost");break;case"lagoon":t=(0,l.getLang)("mail_conversation_style_lagoon");break;case"marine":t=(0,l.getLang)("mail_conversation_style_marine");break;case"sunset":t=(0,l.getLang)("mail_conversation_style_sunset");break;case"unicorn":t=(0,l.getLang)("mail_conversation_style_unicorn");break;case"valentine":t=(0,l.getLang)("mail_conversation_style_valentine");break;case"warm_valentine":t=(0,l.getLang)("mail_conversation_style_warm_valentine");break;case"new_year":t=(0,l.getLang)("mail_conversation_style_new_year");break;case"halloween_violet":t=(0,l.getLang)("mail_conversation_style_halloween_violet");break;case"halloween_orange":t=(0,l.getLang)("mail_conversation_style_halloween_orange");break;case"easter_egg":t=(0,l.getLang)("mail_conversation_style_easter_egg");break;case"midnight":t=(0,l.getLang)("mail_conversation_style_midnight");break;case"retrowave":t=(0,l.getLang)("mail_conversation_style_retrowave");break;case"twilight":t=(0,l.getLang)("mail_conversation_style_twilight")}t||(0,A.logError)(new Error("Wrong conversation style"));return t}(c.source_style);C=C.replace("{style}",M)}var R=r.conversationStylesLongreadLink;C=C.replace(/{link}(.+){\/link}/i,(function(e,t){return F(R,t,!0)}))}return C}function F(e,t,a,n){return void 0===n&&(n=""),a?'<a class="im_srv_lnk '+n+'" target="_blank" rel="noopener" href="'+e+'">'+t+"</a>":'<span class="'+n+'">'+t+"</span>"}function H(e,t){var a=e.map((function(e){var a=e.id,n=e.icon,r=e.name,s=e.color,o=t===a?"MessageReactionsPanel__reaction--selected":"",l=t===a?'style="--reaction-bg: var(--'+s+')"':"";return(0,i.getTemplate)("sImReactionsPanelItem",{id:a,icon:n,name:r,style:l,selected:o})}));return(0,i.getTemplate)("sImReactionsPanel",{reactions:a.join("")})}function U(e,t,a){var n=(0,s.getMessageReactions)(a,e,t),r=(0,s.getMyReaction)(a,e,t);return n.map((function(e){var t=e.reaction_id,n=e.user_ids,s=e.count,o=(0,m.getReactionData)(a,t),l=r===t?"MessageReactions--selected":"",c=s<=3&&n?n.map((function(e){return(0,b.oCacheGet)(a,e)})).filter(Boolean):[],d=c.map((function(e){return e?(0,i.getTemplate)("sImMessageReactionsPeer",{src:e.photo,name:e.name,peer_id:e.id}):""})).join("");return o?(0,i.getTemplate)("sImMessageReactions",{id:t,count:s,icon:o.icon,name:o.name,peers:d,selected:l}):""})).join("")}},352111:(e,t,a)=>{"use strict";a.d(t,{updateUnreadCounter:()=>i});var n=a(712439),r=a(101178),s=a(993421);function i(e){var t=(0,s.getGroupId)(e),a=(0,s.getUnreadCount)(e),i=t?"mgid"+t:"msg",o=(0,n.unpackStore)(e);(0,r.handlePageCount)(i,a,"","",o.unread_counters.countNotMuted>0)}}}]);try{stManager.done("dist/35d053fb74a91cc3aa6498043e8c4a09.6232627959684e29f1c9.js")}catch(e){}